import{dD as Wn,j as e,dE as ve,dF as Ys,dG as Js,dH as Ae,aC as te,aD as se,ax as ce,dI as zn,dJ as qn,dK as va,dL as Ca,dM as Ot,dN as wa,x as Hn,dO as Ta,s as h,bR as ka,e as K,bc as H,bt as Ce,r as u,cT as $t,bK as ke,dP as Vn,dQ as ks,h as V,dR as Ie,A as Yn,l as X,C as w,dS as Jn,ba as _t,b9 as ne,dT as Ea,dU as Kn,bb as ue,dV as Fe,de as f,dW as re,dX as ge,F as Nt,u as xe,dY as Ke,V as J,I as Ra,S as Da,M as Ge,i as q,aY as Q,T as D,dZ as Zn,ch as Ee,L as ae,B as F,c1 as xt,dy as Es,d_ as Ze,d$ as Aa,cW as Qe,cX as N,e0 as Qn,E as Mt,e1 as Xe,e2 as Xn,e3 as ft,e4 as eo,e5 as to,e6 as Ia,e7 as Pa,d as Rs,e8 as Ba,e9 as Ds,ea as La,N as gt,eb as Ua,ac as G,ad as fe,ak as oe,ae as Oa,af as $a,ag as As,ah as jt,ai as _a,ay as de,ec as je,D as Oe,ed as Na,bd as Ma,ee,bs as so,ef as Fa,eg as no,eh as oo,ei as le,bv as ao,dh as Ks,ej as io,ek as ro,G as Ft,H as Gt,J as lo,y as we,a_ as co,a$ as uo,b0 as ls,b1 as yt,b2 as Pt,b3 as Pe,bm as Ga,bn as Wa,b4 as Wt,el as za,em as Is,b8 as Zs,en as Bt,eo as qa,ep as Ha,eq as Va,er as Ya,es as Ja,et as cs,m as zt,n as Ka,o as Za,eu as ze,an as Se,ap as ye,bC as ho,cY as qt,ev as po,at as mo,al as me,dd as Be,ew as Ps,bh as Ht,ex as Qa,az as Ne,w as qe,ey as Xa,t as ei,ez as ti,eA as si,eB as Ye,eC as ni,eD as oi,aQ as Vt,eE as Bs,aE as Ls,ar as ai,b as bt,eF as _e,eG as ii,aw as et,cB as Le,eH as ri,eI as li,eJ as ci,eK as di,d7 as Qs,eL as xo,v as ui,as as Us,eM as hi,dg as tt,dv as go,dw as jo,av as fo,eN as Xs,eO as Ue,eP as Je,eQ as en,bZ as pi,cF as yo,eR as bo,bp as So,cG as vo,eS as mi,eT as Co,eU as xi,eV as wo,eW as gi,eX as ji,c_ as fi,eY as yi,eZ as bi,e_ as Si,e$ as To,aj as ko,f0 as vi,ao as St,f1 as tn,f2 as Ci,f3 as Eo,f4 as Lt,f5 as Ro,f6 as wi,c0 as Os,f7 as Ti,f8 as sn,f9 as Yt,fa as ds,fb as ki,fc as Ei,fd as Ri,aT as Do,b5 as Di,fe as Ai,ff as Jt,fg as Ao,fh as Ii,fi as Pi,fj as Bi,fk as Li,au as Kt,fl as Ui,fm as Oi,fn as $i,fo as _i,fp as Ni,fq as Mi,cJ as Fi,fr as Io,K as Po,fs as Bo,aq as Gi,dj as Wi,aA as zi,dl as nn,ft as Lo,fu as Uo,fv as qi,fw as Hi,fx as Vi,fy as Oo,fz as Yi,fA as Ji,fB as Ki,fC as Zi}from"./index-CBxzHo9v.js";import{u as Qi,C as Xi,A as er,a as tr,R as sr,S as nr,T as or,b as ar,c as ir,d as rr,e as lr,E as cr,f as dr,m as ur,g as vt,h as Zt,i as $s}from"./RoleCell-C2bUEPUX.js";import{u as Qt}from"./useApiTokens-CUb6SDEP.js";const hr=()=>{const{tokens:t,loading:s,refetch:n}=Qt(),{deleteToken:o}=Wn(),{headerGroups:a,rows:i,prepareRow:r,state:{globalFilter:c},setGlobalFilter:l,setHiddenColumns:m,columns:p}=Qi(t,d=>{const g=d.row.original.type==="client"?Ys:d.row.original.type==="frontend"?Js:Ae,x=d.row.original.type==="client"?va:d.row.original.type==="frontend"?Ca:Ae;return e.jsxs(Ot,{children:[e.jsx(tr,{token:d.row.original,permission:g}),e.jsx(sr,{token:d.row.original,permission:x,onRemove:async()=>{await o(d.row.original.secret),n()}})]})});return e.jsx(ve,{permissions:[Ys,Js,Ae],children:e.jsx(te,{header:e.jsx(se,{title:`API access (${i.length})`,actions:e.jsxs(e.Fragment,{children:[e.jsx(ce,{initialValue:c,onChange:l}),e.jsx(se.Divider,{}),e.jsx(Xi,{permission:[zn,qn,Ae],path:"/admin/api/create-token"})]})}),children:e.jsx(er,{loading:s,headerGroups:a,setHiddenColumns:m,prepareRow:r,rows:i,columns:p,globalFilter:c})})})},pr=({type:t,projects:s,setProjects:n,errors:o,clearErrors:a})=>{const i=wa("projectId"),{projects:r}=Hn(),c=r.map(l=>({value:l.id,label:l.name}));return i?null:e.jsxs(e.Fragment,{children:[e.jsx(nr,{children:"Which project do you want to give access to?"}),e.jsx(Ta,{disabled:t===or.ADMIN,options:c,defaultValue:s,onChange:n,error:o==null?void 0:o.projects,onFocus:()=>a("projects")})]})},on="Create API token",mr=h(ka)(({theme:t})=>({margin:t.spacing(2,0,4)})),xr=()=>{const{tokens:t,loading:s}=Qt(),{uiConfig:n,loading:o}=H(),a=n.resourceLimits.apiTokens;return{limit:a,currentValue:t.length,limitReached:t.length>=a,loading:o||s}},gr=({modal:t=!1})=>{const{setToastApiError:s}=K(),{uiConfig:n}=H(),o=Ce(),[a,i]=u.useState(!1),[r,c]=u.useState(""),{limit:l,currentValue:m,limitReached:p,loading:d}=xr(),{getApiTokenPayload:g,tokenName:x,type:j,projects:b,environment:y,setTokenName:S,setTokenType:k,setProjects:E,setEnvironment:A,isValid:v,errors:B,clearErrors:L,apiTokenTypes:C}=ar(),{createToken:W,loading:P}=Wn(),{refetch:O}=Qt();$t(on);const T="api/admin/api-tokens",R=async U=>{if(U.preventDefault(),!!v())try{const _=g();await W(_).then(M=>M.json()).then(M=>{ks(),c(M.secret),i(!0),O()})}catch(_){s(V(_))}},I=()=>{i(!1),o(Ie)},$=()=>`curl --location --request POST '${n.unleashUrl}/${T}' \\
--header 'Authorization: INSERT_API_KEY' \\
--header 'Content-Type: application/json' \\
--data-raw '${JSON.stringify(g(),void 0,2)}'`,Y=()=>{o(Ie)};return e.jsxs(ke,{loading:P,title:on,modal:t,description:"Unleash SDKs use API tokens to authenticate to the Unleash API. Client SDKs need a token with 'client privileges', which allows them to fetch feature flag configurations and post usage metrics.",documentationLink:"https://docs.getunleash.io/reference/api-tokens-and-client-keys",documentationLinkLabel:"API tokens documentation",formatApiCode:$,children:[e.jsxs(ir,{handleSubmit:R,handleCancel:Y,mode:"Create",actions:e.jsx(Vn,{name:"token",permission:[Ae,qn,zn],disabled:p||d||P}),children:[e.jsx(rr,{tokenName:x,setTokenName:S,errors:B,clearErrors:L}),e.jsx(lr,{type:j,setType:k,apiTokenTypes:C}),e.jsx(pr,{type:j,projects:b,setProjects:E,errors:B,clearErrors:L}),e.jsx(cr,{type:j,environment:y,setEnvironment:A}),e.jsx(mr,{name:"API tokens",shortName:"tokens",currentValue:m,limit:l})]}),e.jsx(dr,{open:a,setOpen:i,closeConfirm:I,token:r,type:j})]})},jr=h("div")(({theme:t})=>({display:"flex",flexDirection:"column","& > span:last-of-type":{fontSize:t.fontSizes.smallerBody,color:t.palette.text.secondary}})),Xt=({roles:t,value:s,setValue:n,required:o,hideDescription:a,...i})=>{const r=(c,l)=>e.jsx("li",{...c,children:e.jsxs(jr,{children:[e.jsx("span",{children:l.name}),e.jsx("span",{children:l.description})]})});return e.jsxs(e.Fragment,{children:[e.jsx(Yn,{openOnFocus:!0,size:"small",value:s,onChange:(c,l)=>n(l||null),options:t,renderOption:r,getOptionLabel:c=>c.name,renderInput:c=>e.jsx(X,{...c,label:"Role",required:o}),...i}),e.jsx(w,{condition:!!s&&!a,show:()=>e.jsx(Jn,{sx:{marginTop:1},roleId:s.id})})]})},Ct=()=>{const{isEnterprise:t}=H(),{data:s,error:n,mutate:o}=_t(t(),{roles:[],projectRoles:[]},ne("api/admin/roles"),fr);return u.useMemo(()=>({roles:(s==null?void 0:s.roles.filter(({type:a})=>Ea.includes(a)).sort(an))??[],projectRoles:(s==null?void 0:s.roles.filter(({type:a})=>Kn.includes(a)).sort(an))??[],loading:!n&&!s,refetch:()=>o(),error:n}),[s,n,o])},fr=t=>fetch(t).then(ue("Roles")).then(s=>s.json()),an=(t,s)=>Fe.includes(t.type)&&!Fe.includes(s.type)?-1:!Fe.includes(t.type)&&Fe.includes(s.type)?1:t.name.localeCompare(s.name),$o=({data:t={enabled:!1,autoCreate:!1},setValue:s,onUpdateRole:n,disabled:o=!1})=>{const{roles:a}=Ct(),i=()=>{s("autoCreate",!t.autoCreate)},r=l=>{s(l.target.name,l.target.value)},c=({defaultRootRole:l,defaultRootRoleId:m})=>m?a.find(({id:p})=>p===m)||null:a.find(({name:p})=>p===l)||null;return e.jsxs(u.Fragment,{children:[e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Auto-create users"}),e.jsx("p",{children:"Enable automatic creation of new users when signing in."})]}),e.jsx(f,{item:!0,md:6,style:{padding:"20px"},children:e.jsx(re,{control:e.jsx(ge,{onChange:i,name:"enabled",checked:t.autoCreate,disabled:!t.enabled||o}),label:"Auto-create users"})})]}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Default Root Role"}),e.jsx("p",{children:"Choose which root role the user should get when no explicit role mapping exists."})]}),e.jsx(f,{item:!0,md:6,children:e.jsx(Nt,{style:{width:"400px"},children:e.jsx(Xt,{roles:a,value:c(t),setValue:n,disabled:!t.autoCreate||!t.enabled||o,required:!0,hideDescription:!0})})})]}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Email domains"}),e.jsx("p",{children:"Comma separated list of email domains that should be allowed to sign in."})]}),e.jsx(f,{item:!0,md:6,children:e.jsx(X,{onChange:r,label:"Email domains",name:"emailDomains",disabled:!t.autoCreate||!t.enabled||o,required:!!t.autoCreate,value:t.emailDomains||"",placeholder:"@company.com, @anotherCompany.com",style:{width:"400px"},rows:2,variant:"outlined",size:"small"})})]})]})},yr=async(t,s)=>{var n,o;if(t){if(s){const a=await s.json(),i=((o=(n=a.details)==null?void 0:n[0])==null?void 0:o.message)??a.message;throw t({message:i}),new Error(i)}throw new Error}},es=t=>{const{makeRequest:s,createRequest:n,errors:o,loading:a}=xe({propagateErrors:!0,handleBadRequest:yr});return{updateSettings:async r=>{const c=`api/admin/auth/${t}/settings`,l=n(c,{method:"POST",body:JSON.stringify(r)});await s(l.caller,l.id)},errors:o,loading:a}},_s=t=>{const n=Object.entries(t).filter(([,o])=>o!=="");return Object.fromEntries(n)},_o=({ssoType:t,data:s={enabled:!1,enableGroupSyncing:!1,groupJsonPath:"",addGroupsScope:!1},setValue:n,disabled:o=!1})=>{const a=()=>{n("enableGroupSyncing",!s.enableGroupSyncing)},i=c=>{n(c.target.name,c.target.value)},r=()=>{n("addGroupsScope",!s.addGroupsScope)};return e.jsxs(e.Fragment,{children:[e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Enable Group Syncing"}),e.jsxs("p",{children:["Enables automatically syncing of users from the"," ",t," provider when a user logs in."]})]}),e.jsx(f,{item:!0,md:6,style:{padding:"20px"},children:e.jsx(re,{control:e.jsx(ge,{onChange:a,value:s.enableGroupSyncing,name:"enableGroupSyncing",checked:s.enableGroupSyncing,disabled:!s.enabled||o}),label:s.enableGroupSyncing?"Enabled":"Disabled"})})]}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Group Field JSON Path"}),e.jsxs("p",{children:["Specifies the path in the ",t," token response from which to read the groups the user belongs to."]})]}),e.jsx(f,{item:!0,md:6,children:e.jsx(X,{onChange:i,label:"Group JSON Path",name:"groupJsonPath",value:s.groupJsonPath,disabled:!s.enableGroupSyncing||o,style:{width:"400px"},variant:"outlined",size:"small",required:!0})})]}),e.jsx(w,{condition:t==="OIDC",show:e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Request 'groups' Scope"}),e.jsx("p",{children:"When enabled Unleash will also request the 'groups' scope as part of the login request."})]}),e.jsx(f,{item:!0,md:6,style:{padding:"20px"},children:e.jsx(re,{control:e.jsx(ge,{onChange:r,value:s.addGroupsScope,disabled:!s.enableGroupSyncing||o,name:"addGroupsScope",checked:s.addGroupsScope}),label:s.addGroupsScope?"Enabled":"Disabled"})})]})})]})},br={enabled:!1,enableSingleSignOut:!1,addGroupsScope:!1,enableGroupSyncing:!1,autoCreate:!1,unleashHostname:location.hostname,groupJsonPath:"",clientId:"",discoverUrl:"",secret:"",acrValues:"",idTokenSigningAlgorithm:"RS256"},Sr=()=>{const{setToastData:t,setToastApiError:s}=K(),{uiConfig:n}=H(),{oidcConfiguredThroughEnv:o}=n,[a,i]=u.useState(br),{config:r}=Ke("oidc"),{updateSettings:c,errors:l,loading:m}=es("oidc");u.useEffect(()=>{r.discoverUrl&&i(r)},[r]);const p=S=>{j(S.target.name,S.target.value)},d=S=>{j(S.target.name,S.target.value.trim())},g=()=>{i({...a,enabled:!a.enabled})},x=()=>{i({...a,enableSingleSignOut:!a.enableSingleSignOut})},j=(S,k)=>{i({...a,[S]:k})},b=S=>{i({...a,defaultRootRole:void 0,defaultRootRoleId:S==null?void 0:S.id})},y=async S=>{S.preventDefault();try{await c(_s(a)),t({text:"Settings stored",type:"success"})}catch(k){s(V(k))}};return e.jsxs(e.Fragment,{children:[e.jsx(f,{container:!0,sx:{mb:3},children:e.jsxs(f,{item:!0,md:12,children:[e.jsx(w,{condition:!!o,show:e.jsxs(J,{sx:{mb:2},severity:"warning",children:["OIDC is currently configured via environment variables. Please refer to the"," ",e.jsx("a",{href:"https://www.unleash-hosted.com/docs/enterprise-authentication",target:"_blank",rel:"noreferrer",children:"documentation"})," ","for detailed instructions on how to set up OIDC using these variables."]})}),e.jsxs(J,{severity:"info",children:["Please read the"," ",e.jsx("a",{href:"https://www.unleash-hosted.com/docs/enterprise-authentication",target:"_blank",rel:"noreferrer",children:"documentation"})," ","to learn how to integrate with specific OpenID Connect providers (such as Okta and Keycloak). ",e.jsx("br",{}),"Callback URL:"," ",e.jsxs("code",{children:[n.unleashUrl,"/auth/oidc/callback"]})]})]})}),e.jsxs("form",{onSubmit:y,children:[e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Enable"}),e.jsx("p",{children:"Enable Open Id Connect Authentication."})]}),e.jsx(f,{item:!0,md:6,style:{padding:"20px"},children:e.jsx(re,{control:e.jsx(ge,{onChange:g,value:a.enabled,name:"enabled",checked:a.enabled}),label:a.enabled?"Enabled":"Disabled",disabled:o})})]}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Discover URL"}),e.jsx("p",{children:"(Required) Issuer discover metadata URL"})]}),e.jsx(f,{item:!0,md:6,children:e.jsx(X,{onChange:d,label:"Discover URL",name:"discoverUrl",value:a.discoverUrl,disabled:!a.enabled||o,style:{width:"400px"},variant:"outlined",size:"small"})})]}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Client ID"}),e.jsx("p",{children:"(Required) Client ID of your OpenID application"})]}),e.jsx(f,{item:!0,md:6,children:e.jsx(X,{onChange:d,label:"Client ID",name:"clientId",value:a.clientId,disabled:!a.enabled||o,style:{width:"400px"},variant:"outlined",size:"small",required:!0})})]}),e.jsxs(f,{container:!0,spacing:3,mb:4,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Client secret"}),e.jsxs("p",{children:["(Required) Client secret of your OpenID application."," "]})]}),e.jsx(f,{item:!0,md:6,children:e.jsx(X,{onChange:d,label:"Client Secret",name:"secret",value:a.secret,disabled:!a.enabled||o,style:{width:"400px"},variant:"outlined",size:"small",required:!0})})]}),e.jsx("h3",{children:"Optional Configuration"}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Enable Single Sign-Out"}),e.jsx("p",{children:"If you enable Single Sign-Out Unleash will redirect the user to the IDP as part of the Sign-out process."})]}),e.jsx(f,{item:!0,md:6,style:{padding:"20px"},children:e.jsx(re,{control:e.jsx(ge,{onChange:x,value:a.enableSingleSignOut,disabled:!a.enabled||o,name:"enableSingleSignOut",checked:a.enableSingleSignOut}),label:a.enableSingleSignOut?"Enabled":"Disabled"})})]}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"ACR Values"}),e.jsx("p",{children:'Requested Authentication Context Class Reference values. If multiple values are specified they should be "space" separated. Will be sent as "acr_values" as part of the authentication request. Unleash will validate the acr value in the id token claims against the list of acr values.'})]}),e.jsx(f,{item:!0,md:6,children:e.jsx(X,{onChange:p,label:"ACR Values",name:"acrValues",value:a.acrValues,disabled:!a.enabled||o,style:{width:"400px"},variant:"outlined",size:"small"})})]}),e.jsx(_o,{ssoType:"OIDC",data:a,setValue:j,disabled:o}),e.jsx($o,{data:a,setValue:j,onUpdateRole:b,disabled:o}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"ID Signing algorithm"}),e.jsxs("p",{children:["Which signing algorithm to use. ",e.jsx("br",{}),' Leave this alone unless you see errors that look like "unexpected JWT alg received, expected RS256, got: RS512" in your logs.']})]}),e.jsx(f,{item:!0,md:6,children:e.jsxs(Nt,{style:{minWidth:"200px"},children:[e.jsx(Ra,{id:"defaultRootRole-label",children:"Signing algorithm"}),e.jsxs(Da,{label:"Signing algorithm",labelId:"idTokenSigningAlgorithm-label",id:"idTokenSigningAlgorithm",name:"idTokenSigningAlgorithm",value:a.idTokenSigningAlgorithm||"RS256",onChange:S=>j("idTokenSigningAlgorithm",S.target.value),disabled:o,children:[e.jsx(Ge,{value:"RS256",children:"RS256"}),e.jsx(Ge,{value:"RS384",children:"RS384"}),e.jsx(Ge,{value:"RS512",children:"RS512"})]})]})})]}),e.jsx(f,{container:!0,spacing:3,children:e.jsxs(f,{item:!0,md:12,children:[e.jsx(q,{variant:"contained",color:"primary",type:"submit",disabled:m||o,children:"Save"})," ",e.jsx("p",{children:e.jsx("small",{style:{color:"red"},children:l==null?void 0:l.message})})]})})]})]})},vr={enabled:!1,autoCreate:!1,enableGroupSyncing:!1,addGroupsScope:!1,unleashHostname:location.hostname,entityId:"",signOnUrl:"",certificate:"",signOutUrl:"",spCertificate:"",groupJsonPath:""},Cr=()=>{const{setToastData:t,setToastApiError:s}=K(),{uiConfig:n}=H(),{samlConfiguredThroughEnv:o}=n,[a,i]=u.useState(vr),{config:r}=Ke("saml"),{updateSettings:c,errors:l,loading:m}=es("saml");u.useEffect(()=>{r.entityId&&i(r)},[r]);const p=y=>{x(y.target.name,y.target.value)},d=y=>{x(y.target.name,y.target.value.trim())},g=()=>{i({...a,enabled:!a.enabled})},x=(y,S)=>{i({...a,[y]:S})},j=y=>{i({...a,defaultRootRole:void 0,defaultRootRoleId:y==null?void 0:y.id})},b=async y=>{y.preventDefault();try{await c(_s(a)),t({text:"Settings stored",type:"success"})}catch(S){s(V(S))}};return e.jsxs(e.Fragment,{children:[e.jsx(f,{container:!0,sx:{mb:3},children:e.jsxs(f,{item:!0,md:12,children:[e.jsx(w,{condition:!!o,show:e.jsxs(J,{sx:{mb:2},severity:"warning",children:["SAML is currently configured via environment variables. Please refer to the"," ",e.jsx("a",{href:"https://www.unleash-hosted.com/docs/enterprise-authentication",target:"_blank",rel:"noreferrer",children:"documentation"})," ","for detailed instructions on how to set up SAML using these variables."]})}),e.jsxs(J,{severity:"info",children:["Please read the"," ",e.jsx("a",{href:"https://www.unleash-hosted.com/docs/enterprise-authentication",target:"_blank",rel:"noreferrer",children:"documentation"})," ","to learn how to integrate with specific SAML 2.0 providers (such as Okta, Keycloak, and Microsoft Entra ID). ",e.jsx("br",{}),"Callback URL:"," ",e.jsxs("code",{children:[n.unleashUrl,"/auth/saml/callback"]})]})]})}),e.jsxs("form",{onSubmit:b,children:[e.jsxs(f,{container:!0,spacing:3,children:[e.jsxs(f,{item:!0,md:5,mb:2,children:[e.jsx("strong",{children:"Enable"}),e.jsx("p",{children:"Enable SAML 2.0 Authentication."})]}),e.jsx(f,{item:!0,md:6,children:e.jsx(re,{control:e.jsx(ge,{onChange:g,value:a.enabled,name:"enabled",checked:a.enabled,disabled:o}),label:a.enabled?"Enabled":"Disabled"})})]}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Entity ID"}),e.jsx("p",{children:"(Required) The Entity Identity provider issuer."})]}),e.jsx(f,{item:!0,md:6,children:e.jsx(X,{onChange:d,label:"Entity ID",name:"entityId",value:a.entityId,disabled:!a.enabled||o,style:{width:"400px"},variant:"outlined",size:"small",required:!0})})]}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Single Sign-On URL"}),e.jsx("p",{children:"(Required) The url to redirect the user to for signing in."})]}),e.jsx(f,{item:!0,md:6,children:e.jsx(X,{onChange:d,label:"Single Sign-On URL",name:"signOnUrl",value:a.signOnUrl,disabled:!a.enabled||o,style:{width:"400px"},variant:"outlined",size:"small",required:!0})})]}),e.jsxs(f,{container:!0,spacing:3,mb:4,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"X.509 Certificate"}),e.jsx("p",{children:"(Required) The certificate used to sign the SAML 2.0 request."})]}),e.jsx(f,{item:!0,md:7,children:e.jsx(X,{onChange:p,label:"X.509 Certificate",name:"certificate",value:a.certificate,disabled:!a.enabled||o,style:{width:"100%"},InputProps:{style:{fontSize:"0.6em",fontFamily:"monospace"}},multiline:!0,rows:14,maxRows:14,variant:"outlined",size:"small",required:!0})})]}),e.jsx("h3",{children:"Optional Configuration"}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Single Sign-out URL"}),e.jsx("p",{children:"(Optional) The url to redirect the user to for signing out of the IDP."})]}),e.jsx(f,{item:!0,md:6,children:e.jsx(X,{onChange:d,label:"Single Sign-out URL",name:"signOutUrl",value:a.signOutUrl,disabled:!a.enabled||o,style:{width:"400px"},variant:"outlined",size:"small"})})]}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Service Provider X.509 Certificate"}),e.jsx("p",{children:"(Optional) The private certificate used by the Service Provider used to sign the SAML 2.0 request towards the IDP. E.g. used to sign single logout requests (SLO)."})]}),e.jsx(f,{item:!0,md:7,children:e.jsx(X,{onChange:p,label:"X.509 Certificate",name:"spCertificate",value:a.spCertificate,disabled:!a.enabled||o,style:{width:"100%"},InputProps:{style:{fontSize:"0.6em",fontFamily:"monospace"}},multiline:!0,rows:14,maxRows:14,variant:"outlined",size:"small"})})]}),e.jsx(_o,{ssoType:"SAML",data:a,setValue:x,disabled:o}),e.jsx($o,{data:a,setValue:x,onUpdateRole:j,disabled:o}),e.jsx(f,{container:!0,spacing:3,children:e.jsxs(f,{item:!0,md:5,children:[e.jsx(q,{variant:"contained",color:"primary",type:"submit",disabled:m||o,children:"Save"})," ",e.jsx("p",{children:e.jsx("small",{style:{color:"red"},children:l==null?void 0:l.message})})]})})]})]})},wr=h(J)(({theme:t})=>({marginBottom:t.spacing(3)})),Tr=({open:t,setOpen:s,onConfirm:n})=>e.jsx(Q,{open:t,secondaryButtonText:"Close",onClose:(o,a)=>{a||s(!1)},primaryButtonText:"Generate new token",onClick:n,title:"Generate new SCIM API token?",children:e.jsxs(wr,{severity:"error",children:["Generating a new token will ",e.jsx("strong",{children:"immediately revoke"})," the current one, which may break any existing provision integrations currently using it."]})}),kr=h(J)(({theme:t})=>({marginBottom:t.spacing(3)})),Er=({open:t,setOpen:s,token:n})=>e.jsxs(Q,{open:t,secondaryButtonText:"Close",onClose:(o,a)=>{a||s(!1)},title:"SCIM API token created",children:[e.jsx(kr,{severity:"info",children:"Make sure to copy your SCIM API token now. You won't be able to see it again!"}),e.jsx(D,{variant:"body1",children:"Your token:"}),e.jsx(Zn,{token:n||""})]}),rn="api/admin/scim-settings",Rr=()=>{const{loading:t,makeRequest:s,createRequest:n,errors:o}=xe({propagateErrors:!0});return{saveSettings:async r=>{const l=n(rn,{method:"POST",body:JSON.stringify(r)},"saveSettings");await s(l.caller,l.id)},generateNewToken:async()=>{const c=n(`${rn}/generate-new-token`,{method:"POST"},"generateNewToken"),l=await s(c.caller,c.id),{token:m}=await l.json();return m},errors:o,loading:t}},Dr="api/admin/scim-settings",ln={enabled:!1,hasToken:!1},wt=()=>{const{isEnterprise:t}=H(),{data:s,error:n,mutate:o}=_t(t(),ln,ne(Dr),Ar);return u.useMemo(()=>({settings:s??ln,loading:!n&&!s,refetch:()=>o(),error:n}),[s,n,o])},Ar=t=>fetch(t).then(ue("SCIM settings")).then(s=>s.json());h(J)(({theme:t})=>({marginBottom:t.spacing(3)}));const cn=({open:t,closeDialog:s,deleteEntities:n,entityType:o})=>e.jsx(Q,{open:t,primaryButtonText:`Delete SCIM ${o}`,secondaryButtonText:"Cancel",title:`Do you really want to delete ALL SCIM ${o}?`,onClose:s,onClick:n,children:e.jsxs(D,{variant:"body1",children:["This will delete all ",o.toLocaleLowerCase()," created or managed by SCIM."]})}),Ut="removeUser",He=()=>{const{loading:t,makeRequest:s,createRequest:n,errors:o}=xe({propagateErrors:!0});return{addUser:async d=>{const x=n("api/admin/user-admin",{method:"POST",body:JSON.stringify(d)},"addUser");return s(x.caller,x.id)},updateUser:async d=>{const x=n(`api/admin/user-admin/${d.id}`,{method:"PUT",body:JSON.stringify(d)},"updateUser");return s(x.caller,x.id)},removeUser:async d=>{const x=n(`api/admin/user-admin/${d}`,{method:"DELETE"},"removeUser");return s(x.caller,x.id)},changePassword:async(d,g)=>{const j=n(`api/admin/user-admin/${d}/change-password`,{method:"POST",body:JSON.stringify({password:g})},"changePassword");return s(j.caller,j.id)},validatePassword:async d=>{const x=n("api/admin/user-admin/validate-password",{method:"POST",body:JSON.stringify({password:d})},"validatePassword");return s(x.caller,x.id)},resetPassword:async d=>{const x=n("api/admin/user-admin/reset-password",{method:"POST",body:JSON.stringify({id:d})},"resetPassword");return s(x.caller,x.id)},deleteScimUsers:async()=>{const g=n("api/admin/user-admin/scim-users",{method:"DELETE"},"deleteScimUsers");return s(g.caller,g.id)},userApiErrors:o,userLoading:t}},st=()=>{const{makeRequest:t,createRequest:s,errors:n,loading:o}=xe({propagateErrors:!0});return{createGroup:async l=>{const p=s("api/admin/groups",{method:"POST",body:JSON.stringify(l)});return(await t(p.caller,p.id)).json()},updateGroup:async(l,m)=>{const p=`api/admin/groups/${l}`,d=s(p,{method:"PUT",body:JSON.stringify(m)});await t(d.caller,d.id)},removeGroup:async l=>{const m=`api/admin/groups/${l}`,p=s(m,{method:"DELETE"});await t(p.caller,p.id)},deleteScimGroups:async()=>{const m=s("api/admin/groups/scim-groups",{method:"DELETE"});await t(m.caller,m.id)},errors:n,loading:o}},Ir=h("div")(({theme:t})=>({padding:t.spacing(3),border:`1px solid ${t.palette.divider}`,borderRadius:t.shape.borderRadiusLarge})),us=h("div")(({theme:t})=>({marginBottom:t.spacing(1)})),Pr=()=>{const{uiConfig:t}=H(),{setToastData:s,setToastApiError:n}=K(),[o,a]=u.useState(""),[i,r]=u.useState(!1),[c,l]=u.useState(!1),[m,p]=u.useState(!1),[d,g]=u.useState(!1),{settings:x,refetch:j}=wt(),{deleteScimUsers:b}=He(),{deleteScimGroups:y}=st(),[S,k]=u.useState(x.enabled??!0);u.useEffect(()=>{k(x.enabled??!1)},[x]);const{saveSettings:E,generateNewToken:A,errors:v,loading:B}=Rr(),L=async()=>{r(!0)},C=async()=>{try{await y(),s({text:"Scim Groups have been deleted",type:"success"}),l(!1),j()}catch(T){n(V(T))}},W=async()=>{try{await b(),s({text:"Scim Users have been deleted",type:"success"}),p(!1),j()}catch(T){n(V(T))}},P=async()=>{r(!1);const T=await A();a(T),g(!0)},O=async T=>{try{if(k(T),await E({enabled:T}),T&&!x.hasToken){const R=await A();a(R),g(!0)}s({text:"Settings stored",type:"success"}),await j()}catch(R){n(V(R))}};return e.jsxs(e.Fragment,{children:[e.jsx(f,{container:!0,sx:{mb:3},children:e.jsx(f,{item:!0,md:12,children:e.jsxs(J,{severity:"info",children:["Please read the"," ",e.jsx("a",{href:"https://docs.getunleash.io/reference/scim",target:"_blank",rel:"noreferrer",children:"documentation"})," ","to learn how to integrate with specific SCIM clients (Microsoft Entra, Okta, etc). ",e.jsx("br",{}),"SCIM API URL: ",e.jsxs("code",{children:[t.unleashUrl,"/scim"]})]})})}),e.jsxs(Ir,{children:[e.jsxs(f,{container:!0,spacing:3,children:[e.jsxs(f,{item:!0,md:10.5,mb:2,children:[e.jsx(us,{children:e.jsx("strong",{children:"SCIM provisioning"})}),e.jsx("p",{children:"Enables SCIM provisioning. If SCIM provisioning has not previously been enabled here this will also set up a new auth token to use with your SCIM client, and display it to the user. After the dialog has been closed, this token will not be displayed again. If you need a new token you can click the Generate new token button below which will replace the old token with a new token, and similarly display the new token one time to the user."})]}),e.jsx(f,{item:!0,md:1.5,children:e.jsx(re,{control:e.jsx(ge,{onChange:(T,R)=>{O(R)},value:S,name:"enabled",checked:S}),label:S?"Enabled":"Disabled"})})]}),e.jsx(f,{container:!0,spacing:3,children:e.jsx(f,{item:!0,md:5,mb:2,children:e.jsx(w,{condition:!!x.hasToken,show:e.jsx(q,{variant:"outlined",color:"error",disabled:B,onClick:L,children:"Generate new token"})})})}),e.jsxs(f,{container:!0,spacing:3,children:[e.jsxs(f,{item:!0,md:10.5,mb:2,children:[e.jsx(us,{children:e.jsx("strong",{children:"Delete SCIM Users"})}),e.jsx("p",{children:"This will remove all SCIM users from the Unleash database. This action cannot be undone through Unleash but the upstream SCIM provider may re sync these users."})]}),e.jsx(f,{item:!0,md:1.5,children:e.jsx(q,{variant:"outlined",color:"error",disabled:B,onClick:()=>{p(!0)},children:"Delete Users"})}),e.jsxs(f,{item:!0,md:10.5,mb:2,children:[e.jsx(us,{children:e.jsx("strong",{children:"Delete SCIM Groups"})}),e.jsx("p",{children:"This will remove all SCIM groups from the Unleash database. This action cannot be undone through Unleash but the upstream SCIM provider may re sync these groups. Note that this may affect the permissions of users present in those groups."})]}),e.jsx(f,{item:!0,md:1.5,children:e.jsx(q,{variant:"outlined",color:"error",disabled:B,onClick:()=>{l(!0)},children:"Delete Groups"})})]}),e.jsx(Tr,{open:i,setOpen:r,onConfirm:P}),e.jsx(Er,{open:d,setOpen:g,token:o}),e.jsx(cn,{open:m,closeDialog:()=>p(!1),deleteEntities:W,entityType:"Users"}),e.jsx(cn,{open:c,closeDialog:()=>l(!1),deleteEntities:C,entityType:"Groups"})]})]})},Br=()=>{const{data:t,error:s,mutate:n}=Ee(ne("api/admin/user-admin/admin-count"),Lr);return{data:t,loading:!s&&!t,refetch:()=>n(),error:s}},Lr=t=>fetch(t).then(ue("Admin count")).then(s=>s.json()),Ur=({open:t,setOpen:s,onClick:n,adminCount:o,tokens:a})=>e.jsxs(Q,{open:t,onClose:()=>{s(!1)},onClick:n,title:"Disable password based login?",primaryButtonText:"Disable password based login",secondaryButtonText:"Cancel",children:[e.jsxs(J,{severity:"warning",children:[e.jsx("strong",{children:"Warning!"})," Disabling password based login may lock you out of the system permanently if you do not have any alternative admin credentials (such as an admin SSO account or admin API token) secured beforehand.",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"Password based administrators: "})," ",o==null?void 0:o.password,e.jsx("br",{}),e.jsx("strong",{children:"Other administrators: "})," ",o==null?void 0:o.noPassword,e.jsx("br",{}),e.jsx("strong",{children:"Admin service accounts: "})," ",o==null?void 0:o.service,e.jsx("br",{}),e.jsx("strong",{children:"Admin API tokens: "})," ",a.filter(({type:i})=>i==="admin").length]}),e.jsx(D,{sx:{mt:3},children:"You are about to disable password based login. Are you sure you want to proceed?"})]}),Or=()=>{const{setToastData:t,setToastApiError:s}=K(),{config:n,refetch:o}=Ke("simple"),[a,i]=u.useState(!1),{updateSettings:r,errors:c,loading:l}=es("simple"),[m,p]=u.useState(!1),{data:d}=Br(),{tokens:g}=Qt();u.useEffect(()=>{i(!!n.disabled)},[n.disabled]);const x=()=>{i(!a)},j=async y=>{y.preventDefault(),!n.disabled&&a?p(!0):b()},b=async()=>{try{await r({disabled:a}),o(),t({text:"Password authentication settings stored",autoHideDuration:4e3,type:"success",show:!0})}catch(y){s(V(y)),i(n.disabled)}};return e.jsx(e.Fragment,{children:e.jsxs("form",{onSubmit:j,children:[e.jsxs(J,{severity:"info",sx:{mb:3},children:["Overview of administrators on your Unleash instance:",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"Password based administrators: "})," ",e.jsx(ae,{to:"/admin/users",children:d==null?void 0:d.password}),e.jsx("br",{}),e.jsx("strong",{children:"Other administrators: "})," ",e.jsx(ae,{to:"/admin/users",children:d==null?void 0:d.noPassword}),e.jsx("br",{}),e.jsx("strong",{children:"Admin service accounts: "})," ",e.jsx(ae,{to:"/admin/service-accounts",children:d==null?void 0:d.service}),e.jsx("br",{}),e.jsx("strong",{children:"Admin API tokens: "})," ",e.jsx(ae,{to:"/admin/api",children:g.filter(({type:y})=>y==="admin").length})]}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Password based login"}),e.jsx("p",{children:"Allow users to login with username & password"})]}),e.jsx(f,{item:!0,md:6,style:{padding:"20px"},children:e.jsx(re,{control:e.jsx(ge,{onChange:x,value:!a,name:"disabled",checked:!a}),label:a?"Disabled":"Enabled"})})]}),e.jsx(f,{container:!0,spacing:3,children:e.jsxs(f,{item:!0,md:12,children:[e.jsx(q,{variant:"contained",color:"primary",type:"submit",disabled:l,children:"Save"})," ",e.jsx("p",{children:e.jsx("small",{style:{color:"red"},children:c==null?void 0:c.message})})]})}),e.jsx(Ur,{open:m,setOpen:p,onClick:()=>{p(!1),b()},adminCount:d,tokens:g})]})})},$r={enabled:!1,autoCreate:!1,unleashHostname:location.hostname,clientId:"",clientSecret:"",emailDomains:""},_r=()=>{const{setToastData:t,setToastApiError:s}=K(),{uiConfig:n}=H(),[o,a]=u.useState($r),{config:i}=Ke("google"),{updateSettings:r,errors:c,loading:l}=es("google");u.useEffect(()=>{i.clientId&&a(i)},[i]);const m=x=>{a({...o,[x.target.name]:x.target.value})},p=()=>{a({...o,enabled:!o.enabled})},d=()=>{a({...o,autoCreate:!o.autoCreate})},g=async x=>{x.preventDefault();try{await r(_s(o)),t({text:"Settings stored",type:"success"})}catch(j){s(V(j))}};return e.jsxs(e.Fragment,{children:[e.jsxs(F,{children:[e.jsxs(J,{severity:"error",sx:{mb:2},children:["This integration is deprecated and will be removed in next major version. Please use ",e.jsx("strong",{children:"OpenID Connect"})," to enable Google SSO."]}),e.jsxs(J,{severity:"info",sx:{mb:3},children:["Read the"," ",e.jsx("a",{href:"https://www.unleash-hosted.com/docs/enterprise-authentication/google",target:"_blank",rel:"noreferrer",children:"documentation"})," ","to learn how to integrate with Google OAuth 2.0. ",e.jsx("br",{}),"Callback URL:"," ",e.jsxs("code",{children:[n.unleashUrl,"/auth/google/callback"]})]})]}),e.jsxs("form",{onSubmit:g,children:[e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,xs:5,children:[e.jsx("strong",{children:"Enable"}),e.jsx("p",{children:"Enable Google users to login. Value is ignored if Client ID and Client Secret are not defined."})]}),e.jsx(f,{item:!0,xs:6,style:{padding:"20px"},children:e.jsx(re,{control:e.jsx(ge,{onChange:p,value:o.enabled,name:"enabled",checked:o.enabled}),label:o.enabled?"Enabled":"Disabled"})})]}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,xs:5,children:[e.jsx("strong",{children:"Client ID"}),e.jsx("p",{children:"(Required) The Client ID provided by Google when registering the application."})]}),e.jsx(f,{item:!0,xs:6,children:e.jsx(X,{onChange:m,label:"Client ID",name:"clientId",placeholder:"",value:o.clientId,style:{width:"400px"},variant:"outlined",size:"small",required:!0})})]}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Client Secret"}),e.jsx("p",{children:"(Required) Client Secret provided by Google when registering the application."})]}),e.jsx(f,{item:!0,md:6,children:e.jsx(X,{onChange:m,label:"Client Secret",name:"clientSecret",value:o.clientSecret,placeholder:"",style:{width:"400px"},variant:"outlined",size:"small",required:!0})})]}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Unleash hostname"}),e.jsxs("p",{children:["(Required) The hostname you are running Unleash on that Google should send the user back to. The final callback URL will be"," ",e.jsx("small",{children:e.jsx("code",{children:"https://[unleash.hostname.com]/auth/google/callback"})})]})]}),e.jsx(f,{item:!0,md:6,children:e.jsx(X,{onChange:m,label:"Unleash Hostname",name:"unleashHostname",placeholder:"",value:o.unleashHostname||"",style:{width:"400px"},variant:"outlined",size:"small"})})]}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Auto-create users"}),e.jsx("p",{children:"Enable automatic creation of new users when signing in with Google."})]}),e.jsx(f,{item:!0,md:6,style:{padding:"20px"},children:e.jsx(ge,{onChange:d,name:"enabled",checked:o.autoCreate})})]}),e.jsxs(f,{container:!0,spacing:3,mb:2,children:[e.jsxs(f,{item:!0,md:5,children:[e.jsx("strong",{children:"Email domains"}),e.jsx("p",{children:"(Optional) Comma separated list of email domains that should be allowed to sign in."})]}),e.jsx(f,{item:!0,md:6,children:e.jsx(X,{onChange:m,label:"Email domains",name:"emailDomains",value:o.emailDomains,placeholder:"@company.com, @anotherCompany.com",style:{width:"400px"},rows:2,multiline:!0,variant:"outlined",size:"small"})})]}),e.jsx(f,{container:!0,spacing:3,children:e.jsxs(f,{item:!0,md:5,children:[e.jsx(q,{variant:"contained",color:"primary",type:"submit",disabled:l,children:"Save"})," ",e.jsx("p",{children:e.jsx("small",{style:{color:"error.dark"},children:c==null?void 0:c.message})})]})})]})]})},Nr=()=>{var i;const{isEnterprise:t}=H(),s=xt("googleAuthEnabled"),n=[{label:"Single sign-on: OpenID Connect",path:"/admin/auth/oidc"},{label:"Single sign-on: SAML 2.0",path:"/admin/auth/saml"},{label:"Password login",path:"/admin/auth/password"},{label:"Single sign-on: Google",path:"/admin/auth/google"},{label:"Single sign-on: SCIM",path:"/admin/auth/scim"}],{pathname:o}=Es(),a=((i=n.find(r=>o===r.path))==null?void 0:i.label)||"Single sign-on: OpenID Connect";return $t(a),t()?e.jsx("div",{children:e.jsx(ve,{permissions:[Ae,Aa],children:e.jsx(te,{header:a,children:e.jsxs(Qe,{children:[e.jsx(N,{path:"/",index:!0,element:e.jsx(Qn,{to:"/admin/auth/oidc"})}),e.jsx(N,{path:"/oidc",index:!0,element:e.jsx(Sr,{})}),e.jsx(N,{path:"/saml",element:e.jsx(Cr,{})}),e.jsx(N,{path:"/password",element:e.jsx(Or,{})}),s&&e.jsx(N,{path:"/google",element:e.jsx(_r,{})}),e.jsx(N,{path:"/scim",element:e.jsx(Pr,{})})]})})})}):e.jsx(Ze,{feature:"sso",page:!0})},Mr=ne("api/admin/invoices"),Fr=h(q)(({theme:t})=>({width:"100%",marginBottom:t.spacing(1.5)})),Gr=({update:t})=>e.jsx(Fr,{href:`${Mr}/${t?"portal":"checkout"}`,variant:t?"outlined":"contained",children:t?"Update billing information":"Add billing information"}),dn=h("aside")(({theme:t})=>({padding:t.spacing(4),height:"100%",borderRadius:t.shape.borderRadiusLarge,backgroundColor:t.palette.background.elevation2})),Wr=h(D)(({theme:t})=>({marginBottom:t.spacing(4)})),zr=h(J)(({theme:t})=>({marginBottom:t.spacing(4)})),hs=h(D)(({theme:t})=>({fontSize:t.fontSizes.smallBody,color:t.palette.text.secondary})),qr=h(Mt)(({theme:t})=>({margin:`${t.spacing(2.5)} 0`,borderColor:t.palette.divider})),Hr=()=>{const{instanceStatus:t}=Xe(),{uiConfig:{billing:s}}=H(),n=s==="pay-as-you-go";if(!t)return e.jsx(f,{item:!0,xs:12,md:5,children:e.jsx(dn,{"data-loading":!0,sx:{flex:1,height:"400px"}})});const o=`${t.plan}${n?" Pay-as-You-Go":""}`,a=t.state!==Xn.ACTIVE,{isCustomBilling:i}=t;return e.jsx(f,{item:!0,xs:12,md:5,children:e.jsxs(dn,{children:[e.jsx(Wr,{variant:"body1",children:"Billing information"}),e.jsx(w,{condition:!!i,show:e.jsx(hs,{children:"Your billing is managed by Unleash"}),elseShow:e.jsxs(e.Fragment,{children:[e.jsx(w,{condition:a,show:e.jsxs(zr,{severity:"warning",children:["In order to"," ",e.jsx("strong",{children:"Upgrade trial"})," you need to provide us your billing information."]})}),e.jsx(Gr,{update:!a}),e.jsx(hs,{children:a?"Once we have received your billing information we will upgrade your trial within 1 business day":"Update your credit card and business information and change which email address we send invoices to"})]})}),e.jsx(qr,{}),e.jsxs(hs,{children:[e.jsx("a",{href:`mailto:support@getunleash.io?subject=${o} plan clarifications`,children:"Get in touch with us"})," ","for any clarification"]})]})})},Vr=h(f)(({theme:t})=>({flexWrap:"nowrap",gap:t.spacing(1)})),Te=({sx:t,children:s})=>e.jsx(Vr,{container:!0,item:!0,justifyContent:"space-between",alignItems:"center",sx:t,children:s}),ie=({children:t,vertical:s=!1})=>e.jsx(f,{container:s,item:!0,display:"flex",alignItems:s?"start":"center",direction:s?"column":void 0,children:t}),Yr=h("span")(({theme:t})=>({fontSize:t.fontSizes.smallBody,marginLeft:t.spacing(1)})),pt=({children:t})=>e.jsxs(Yr,{children:["(",t,")"]}),be=()=>{const{data:t,error:s,mutate:n}=Ee(ne("api/admin/user-admin"),Jr);return u.useMemo(()=>({users:(t==null?void 0:t.users)??[],roles:(t==null?void 0:t.rootRoles)??[],loading:!s&&!t,refetch:()=>n(),error:s}),[t,s,n])},Jr=t=>fetch(t).then(ue("Users")).then(s=>s.json()),No=new Date,am=ft(No,"yyyy-MM");eo(No);const im=t=>ft(t,"yyyy-MM"),rm=t=>ft(t,"yyyy-MM-dd"),lm=t=>to(t,"yyyy-MM",new Date),Kr=t=>to(t,"yyyy-MM-dd",new Date),Ns=5,Ms=1e6,Zr=Kr("2024-05-01"),Qr=["/api/admin","/api/frontend","/api/client"],Xr=t=>{const{apiData:s,...n}=t;return{apiData:s.filter(a=>Qr.includes(a.apiPath)).map(a=>(a.dataPoints=a.dataPoints.filter(({period:i})=>new Date(i)>=Zr),a)),...n}},el=(t,s)=>t.reduce((n,o)=>{const a=o.dataPoints.find(({period:r})=>r===s),i=(a==null?void 0:a.trafficTypes.reduce((r,c)=>r+c.count,0))??0;return n+i},0),Mo=t=>t.flatMap(s=>s.dataPoints.flatMap(n=>n.trafficTypes.map(o=>o.count))).reduce((s,n)=>s+n,0),tl=t=>{const{grouping:s,apiData:n}=t;if(s==="monthly"){const o=ft(new Date(t.dateRange.to),"yyyy-MM");return el(n,o)}else return Mo(n)},sl=(t,s=Ns,n=Ms)=>Math.ceil(t/n)*s,Fo=(t,s,n=Ns,o=Ms)=>{if(t===0)return 0;const a=Math.floor((t-s)/o)*o;return a>0?sl(a,n,o):0},nl=({dayOfMonth:t,daysInMonth:s,trafficData:n})=>{if(t<5)return 0;const o=n.map(i=>({...i,dataPoints:i.dataPoints.filter(r=>Number(r.period.slice(-2))<t)}));return Mo(o)/(t-1)*s},cm=(t,s,n,o=Ns,a=Ms)=>{if(!t)return 0;const i=n.getDate(),r=eo(n),c=nl({dayOfMonth:i,daysInMonth:r,trafficData:t});return Fo(c,s,o,a)},ol=(t,{from:s,to:n})=>{const o=`api/admin/metrics/traffic?grouping=${t}&from=${s}&to=${n}`,{data:a,error:i,mutate:r}=Ee(ne(o),al);return u.useMemo(()=>{const c=a?{state:"success",data:Xr(a)}:i?{state:"error",error:i}:{state:"loading"};return{refetch:()=>r(),result:c}},[a,i,r])},al=t=>fetch(t).then(ue("Instance Metrics")).then(s=>s.json()),Go=t=>{var m,p;const s=new Date,n=d=>ft(d,"yyyy-MM-dd"),o=n(Ia(s)),a=n(Pa(s)),{instanceStatus:i}=Xe(),r=((p=(m=i==null?void 0:i.prices)==null?void 0:m[(i==null?void 0:i.billing)==="pay-as-you-go"?"payg":"pro"])==null?void 0:p.traffic)??Fs,{result:c}=ol("daily",{from:o,to:a});return u.useMemo(()=>{if(c.state!=="success")return 0;const d=tl(c.data);return Fo(d,t,r)},[t,JSON.stringify(c),r])},ps=h(D)(({theme:t})=>({fontSize:t.fontSizes.smallBody,color:t.palette.text.secondary})),il=h(Rs)(({theme:t})=>({fontSize:"1rem",marginRight:t.spacing(1)})),rl=h(Mt)(({theme:t})=>({margin:`${t.spacing(3)} 0`})),ll=({instanceStatus:t})=>{var x,j,b,y,S,k;const{users:s,loading:n}=be(),o=s.filter(E=>E.email),a=((j=(x=t.prices)==null?void 0:x.pro)==null?void 0:j.base)??Wo,i=((y=(b=t.prices)==null?void 0:b.pro)==null?void 0:y.seat)??zo,r=((k=(S=t.prices)==null?void 0:S.pro)==null?void 0:k.traffic)??Fs,c=qo,l=Math.min(o.length,c),m=o.length-l,p=i*m,d=Go(Ho),g=a+p+d;return n?null:e.jsxs(e.Fragment,{children:[e.jsxs(f,{container:!0,children:[e.jsxs(Te,{sx:E=>({marginBottom:E.spacing(1.5)}),children:[e.jsxs(ie,{vertical:!0,children:[e.jsxs(D,{children:[e.jsx("strong",{children:"Included members"}),e.jsx(pt,{children:e.jsxs(ae,{to:"/admin/users",children:[l," of ",c," assigned"]})})]}),e.jsxs(ps,{children:["You have ",c," team members included in your PRO plan"]})]}),e.jsxs(ie,{children:[e.jsx(il,{}),e.jsx(D,{variant:"body2",children:"included"})]})]}),e.jsxs(Te,{sx:E=>({marginBottom:E.spacing(1.5)}),children:[e.jsxs(ie,{vertical:!0,children:[e.jsxs(D,{children:[e.jsx("strong",{children:"Paid members"}),e.jsx(pt,{children:e.jsxs(ae,{to:"/admin/users",children:[m," assigned"]})})]}),e.jsxs(ps,{children:["$",i,"/month per paid member"]})]}),e.jsx(ie,{children:e.jsxs(D,{sx:E=>({fontSize:E.fontSizes.mainHeader}),children:["$",p.toFixed(2)]})})]}),e.jsx(w,{condition:d>0,show:e.jsxs(Te,{children:[e.jsxs(ie,{vertical:!0,children:[e.jsxs(D,{children:[e.jsx("strong",{children:"Accrued traffic charges"}),e.jsx(pt,{children:e.jsx(ae,{to:"/admin/network/data-usage",children:"view details"})})]}),e.jsxs(ps,{children:["$",r," per 1 million started above included data"]})]}),e.jsx(ie,{children:e.jsxs(D,{sx:E=>({fontSize:E.fontSizes.mainHeader}),children:["$",d.toFixed(2)]})})]})})]}),e.jsx(rl,{}),e.jsx(f,{container:!0,children:e.jsxs(Te,{children:[e.jsx(ie,{children:e.jsx(D,{sx:E=>({fontWeight:E.fontWeight.bold,fontSize:E.fontSizes.mainHeader}),children:"Total"})}),e.jsx(ie,{children:e.jsxs(D,{sx:E=>({fontWeight:E.fontWeight.bold,fontSize:"2rem"}),children:["$",g.toFixed(2)]})})]})})]})},un=h(D)(({theme:t})=>({fontSize:t.fontSizes.smallBody,color:t.palette.text.secondary})),cl=h(Mt)(({theme:t})=>({margin:`${t.spacing(3)} 0`})),dl=({instanceStatus:t})=>{var d,g,x,j;const{users:s,loading:n}=be(),o=s.filter(b=>b.email),a=((g=(d=t.prices)==null?void 0:d.payg)==null?void 0:g.seat)??ml,i=((j=(x=t.prices)==null?void 0:x.payg)==null?void 0:j.traffic)??Fs,r=t.minSeats??xl,c=Math.max(o.length,r),l=a*c,m=Go(Ho),p=l+m;return n?null:e.jsxs(e.Fragment,{children:[e.jsxs(f,{container:!0,children:[e.jsxs(Te,{sx:b=>({marginBottom:b.spacing(1.5)}),children:[e.jsxs(ie,{vertical:!0,children:[e.jsxs(D,{children:[e.jsx("strong",{children:"Paid members"}),e.jsx(pt,{children:e.jsxs(ae,{to:"/admin/users",children:[o.length," assigned of"," ",r," minimum"]})})]}),e.jsxs(un,{children:["$",a,"/month per paid member"]})]}),e.jsx(ie,{children:e.jsxs(D,{sx:b=>({fontSize:b.fontSizes.mainHeader}),children:["$",l.toFixed(2)]})})]}),e.jsx(w,{condition:m>0,show:e.jsxs(Te,{children:[e.jsxs(ie,{vertical:!0,children:[e.jsxs(D,{children:[e.jsx("strong",{children:"Accrued traffic charges"}),e.jsx(pt,{children:e.jsx(ae,{to:"/admin/network/data-usage",children:"view details"})})]}),e.jsxs(un,{children:["$",i," per 1 million started above included data"]})]}),e.jsx(ie,{children:e.jsxs(D,{sx:b=>({fontSize:b.fontSizes.mainHeader}),children:["$",m.toFixed(2)]})})]})})]}),e.jsx(cl,{}),e.jsx(f,{container:!0,children:e.jsxs(Te,{children:[e.jsx(ie,{children:e.jsx(D,{sx:b=>({fontWeight:b.fontWeight.bold,fontSize:b.fontSizes.mainHeader}),children:"Total"})}),e.jsx(ie,{children:e.jsxs(D,{sx:b=>({fontWeight:b.fontWeight.bold,fontSize:"2rem"}),children:["$",p.toFixed(2)]})})]})})]})};h(D)(({theme:t})=>({fontSize:t.fontSizes.smallerBody,color:t.palette.text.secondary}));const ul=h(q)(({theme:t})=>({marginTop:t.spacing(1),display:"inline-flex",alignItems:"center"})),hl=()=>{const t=ne("api/admin/invoices/portal");return e.jsx(e.Fragment,{children:e.jsx(f,{container:!0,children:e.jsx(Te,{sx:s=>({marginBottom:s.spacing(3)}),children:e.jsx(ie,{vertical:!0,children:e.jsx(ul,{href:t,variant:"outlined",endIcon:e.jsx(Ba,{}),children:"View usage charges"})})})})})},pl=({instanceStatus:t,isPAYG:s,isEnterpriseConsumption:n})=>s?e.jsx(dl,{instanceStatus:t}):t.plan===Ds.PRO?e.jsx(ll,{instanceStatus:t}):n?e.jsx(hl,{}):null,Wo=80,zo=15,ml=75,Fs=5,xl=5,qo=5,Ho=53e6,hn=h("aside")(({theme:t})=>({padding:t.spacing(2.5),height:"100%",borderRadius:t.shape.borderRadiusLarge,boxShadow:t.boxShadows.elevated,[t.breakpoints.up("md")]:{padding:t.spacing(6.5)}})),gl=h("span")(({theme:t})=>({fontSize:"3.25rem",lineHeight:1,color:t.palette.primary.main,fontWeight:800,marginRight:t.spacing(1.5)})),jl=h("span")(({theme:t})=>({fontWeight:t.fontWeight.bold})),fl=h("span")(({theme:t})=>({fontWeight:t.fontWeight.bold})),yl=h("span")(({theme:t})=>({color:t.palette.primary.main,fontSize:t.fontSizes.mainHeader,fontWeight:t.fontWeight.bold})),bl=h(J)(({theme:t})=>({fontSize:t.fontSizes.smallerBody,marginBottom:t.spacing(3),marginTop:t.spacing(-1.5),[t.breakpoints.up("md")]:{marginTop:t.spacing(-4.5)}})),Sl=()=>{var m,p;const{uiConfig:{billing:t}}=H(),{instanceStatus:s}=Xe(),n=(s==null?void 0:s.plan)&&(s==null?void 0:s.plan)===Ds.PRO,o=t==="pay-as-you-go",a=t==="enterprise-consumption";if(!s)return e.jsx(f,{item:!0,xs:12,md:7,children:e.jsx(hn,{"data-loading":!0,sx:{flex:1,height:"400px"}})});const i=La(s),r=((p=(m=s.prices)==null?void 0:m.pro)==null?void 0:p.base)??Wo,c=`${s.plan}${o?" Pay-as-You-Go":""}`,l=s.state!==Xn.ACTIVE;return e.jsx(f,{item:!0,xs:12,md:7,children:e.jsxs(hn,{children:[e.jsx(w,{condition:l,show:e.jsxs(bl,{severity:"info",children:["After you have sent your billing information, your instance will be upgraded - you don't have to do anything."," ",e.jsx("a",{href:`mailto:support@getunleash.io?subject=${c} plan clarifications`,children:"Get in touch with us"})," ","for any clarification"]})}),e.jsx(gt,{color:"success",children:"Current plan"}),e.jsxs(f,{container:!0,sx:d=>({marginBottom:d.spacing(3)}),children:[e.jsxs(Te,{children:[e.jsxs(ie,{children:[e.jsx(gl,{children:s.plan}),e.jsx(w,{condition:Ua(s),show:e.jsx(fl,{sx:d=>({color:i?d.palette.error.dark:d.palette.warning.dark}),children:i?"Trial expired":s.trialExtended?"Extended Trial":"Trial"})})]}),e.jsx(ie,{children:e.jsx(w,{condition:!!n,show:e.jsxs(yl,{children:["$",r.toFixed(2)]})})})]}),e.jsx(Te,{children:e.jsx(w,{condition:o||a,show:e.jsxs(jl,{children:["Pay-as-You-Go"," ",a?"Consumption":""]})})})]}),e.jsx(pl,{instanceStatus:s,isPAYG:o,isEnterpriseConsumption:a})]})})},vl=()=>e.jsxs(f,{container:!0,spacing:4,children:[e.jsx(Hr,{}),e.jsx(Sl,{})]}),Cl=h(D)(({theme:t})=>({marginTop:t.spacing(6),marginBottom:t.spacing(2.5),fontSize:t.fontSizes.mainHeader})),wl=[{Header:"Amount",accessor:"amountFormatted"},{Header:"Status",accessor:"status",disableGlobalFilter:!0},{Header:"Created date",accessor:"created",Cell:je,disableGlobalFilter:!0},{Header:"Due date",accessor:"dueDate",Cell:je,disableGlobalFilter:!0},{Header:"Download",accessor:"invoicePDF",align:"center",Cell:({value:t})=>e.jsx(F,{sx:{display:"flex",justifyContent:"center"},"data-loading":!0,children:e.jsx(Oe,{href:t,children:e.jsx(Na,{})})}),width:100,disableGlobalFilter:!0,disableSortBy:!0}],Tl=({data:t,isLoading:s=!1})=>{const n=u.useMemo(()=>({sortBy:[{id:"created",desc:!0}]}),[]),{getTableProps:o,getTableBodyProps:a,headerGroups:i,rows:r,prepareRow:c}=G.useTable({columns:wl,data:t,initialState:n,sortTypes:fe,autoResetGlobalFilter:!1,disableSortRemove:!0,defaultColumn:{Cell:oe}},G.useGlobalFilter,G.useSortBy);return e.jsxs(te,{isLoading:s,disablePadding:!0,children:[e.jsx(Cl,{children:"Payment history"}),e.jsxs(Oa,{...o(),children:[e.jsx($a,{headerGroups:i}),e.jsx(As,{...a(),children:r.map(l=>{c(l);const{key:m,...p}=l.getRowProps();return e.jsx(jt,{hover:!0,...p,children:l.cells.map(d=>{const{key:g,...x}=d.getCellProps();return e.jsx(_a,{...x,children:d.render("Cell")},g)})},m)})})]}),e.jsx(w,{condition:r.length===0,show:e.jsx(de,{children:"No invoices to show."})})]})},Ts="api/admin/invoices",kl=ne(Ts),Vo=(t={})=>{const s=()=>fetch(kl,{method:"GET"}).then(ue("Invoices")).then(c=>c.json()),{data:n,error:o}=Ee(Ts,s,t),[a,i]=u.useState(!o&&!n),r=()=>{Ma(Ts)};return u.useEffect(()=>{i(!o&&!n)},[n,o]),{invoices:(n==null?void 0:n.invoices)||[],error:o,loading:a,refetchInvoices:r}},El=()=>{const{isBilling:t,refetchInstanceStatus:s,refresh:n,loading:o}=Xe(),{invoices:a}=Vo();return u.useEffect(()=>{(async()=>{await n(),s()})()},[s,n]),e.jsx("div",{children:e.jsx(te,{header:"Billing",isLoading:o,children:e.jsx(w,{condition:t,show:e.jsx(ve,{permissions:ee,children:e.jsxs(e.Fragment,{children:[e.jsx(vl,{}),e.jsx(Tl,{data:a})]})}),elseShow:e.jsx(J,{severity:"error",children:"Billing is not enabled for this instance."})})})})},Rl=ne("api/admin/invoices/portal"),Dl=()=>{const{refetchInvoices:t,invoices:s}=Vo(),[n,o]=u.useState(!1),{locationSettings:a}=so();return u.useEffect(()=>{t(),o(!0)},[]),e.jsx(w,{condition:s.length>0,show:e.jsx(te,{header:e.jsx(se,{title:"Invoices",actions:e.jsx(q,{href:Rl,rel:"noreferrer",target:"_blank",endIcon:e.jsx(Fa,{}),children:"Billing portal"})}),children:e.jsx("div",{children:e.jsxs(no,{children:[e.jsx(oo,{children:e.jsxs(jt,{children:[e.jsx(le,{children:"Amount"}),e.jsx(le,{children:"Status"}),e.jsx(le,{children:"Due date"}),e.jsx(le,{children:"PDF"}),e.jsx(le,{children:"Link"})]})}),e.jsx(As,{children:s.map(i=>e.jsxs(jt,{style:{backgroundColor:i.status==="past-due"?"error.dark":"inherit"},children:[e.jsx(le,{style:{textAlign:"left"},children:i.amountFormatted}),e.jsx(le,{style:{textAlign:"left"},children:i.status}),e.jsx(le,{style:{textAlign:"left"},children:i.dueDate&&ao(i.dueDate,a.locale)}),e.jsx(le,{style:{textAlign:"left"},children:e.jsx("a",{href:i.invoicePDF,children:"PDF"})}),e.jsx(le,{style:{textAlign:"left"},children:e.jsx("a",{href:i.invoiceURL,target:"_blank",rel:"noreferrer",children:"Payment link"})})]},i.invoiceURL))})]})})}),elseShow:e.jsx(te,{children:n&&"No invoices to show."})})},Al=()=>e.jsx("div",{children:e.jsx(ve,{permissions:ee,children:e.jsx(Dl,{})})}),Il=()=>{const{uiConfig:t,loading:s}=H();return s?null:t.flags.UNLEASH_CLOUD?e.jsx(Qn,{to:"/admin/billing",replace:!0}):e.jsx(Al,{})},Pl=()=>e.jsxs(J,{severity:"info",children:[e.jsxs("p",{children:["Use this page to configure allowed CORS origins for the Frontend API (",e.jsx("code",{children:"/api/frontend"}),")."]}),e.jsxs("p",{children:["This configuration will not affect the Admin API (",e.jsx("code",{children:"/api/admin"}),") nor the Client API (",e.jsx("code",{children:"/api/client"}),")."]}),e.jsxs("p",{children:["An asterisk (",e.jsx("code",{children:"*"}),") may be used to allow API calls from any origin."]}),e.jsx("br",{}),e.jsx("p",{children:"Be aware that changes here will take up to two minutes to be updated. In addition, there is a maxAge on the Access-Control-Allow-Origin header that will instruct browsers to cache this header for some time. The cache period is set to the maxium that the browser allows (2h for Chrome, 24h for Firefox)."})]}),Bl=()=>{const{makeRequest:t,createRequest:s,errors:n,loading:o}=xe({propagateErrors:!0});return{setCors:async i=>{const r=s("api/admin/ui-config/cors",{method:"POST",body:JSON.stringify({frontendApiOrigins:i})},"setCors");await t(r.caller,r.id)},loading:o,errors:n}},Ll=({frontendApiOrigins:t})=>{const{setCors:s}=Bl(),{setToastData:n,setToastApiError:o}=K(),[a,i]=u.useState(pn(t)),r=Ks(),c=Ks(),l=async m=>{try{const p=Ul(a);m.preventDefault(),await s(p),i(pn(p)),n({text:"Settings saved",type:"success"})}catch(p){o(V(p))}};return e.jsx("form",{onSubmit:l,children:e.jsxs(F,{sx:{display:"grid",gap:1},children:[e.jsxs("label",{htmlFor:r,children:["Which origins should be allowed to call the Frontend API? Add only one origin per line. The CORS specification does not support wildcard for subdomains, it needs to be a fully qualified domain, including the protocol.",e.jsx("br",{}),e.jsx("br",{}),'If you specify "*" it will be the chosen origin.',e.jsx("br",{}),e.jsx("br",{}),"Example:"]}),e.jsxs("code",{style:{fontSize:"0.7em"},children:["https://www.example.com",e.jsx("br",{}),"https://www.example2.com"]}),e.jsx(X,{id:r,"aria-describedby":c,placeholder:Ol,value:a,onChange:m=>i(m.target.value),multiline:!0,rows:12,variant:"outlined",fullWidth:!0,InputProps:{style:{fontFamily:"monospace",fontSize:"0.8em"}}}),e.jsx(io,{permission:[Ae,ro]})]})})},Ul=t=>t.split(/[,\n\s]+/).map(s=>s.replace(/\/$/,"")).filter(Boolean),pn=t=>(t==null?void 0:t.join(`
`))??"",Ol=["https://example.com","https://example.org"].join(`
`),$l=()=>e.jsx("div",{children:e.jsx(ve,{permissions:[Ae,ro],children:e.jsx(_l,{})})}),_l=()=>{const{uiConfig:t,loading:s}=H();return s?null:e.jsx(te,{header:e.jsx(se,{title:"CORS origins"}),children:e.jsxs(F,{sx:{display:"grid",gap:4},children:[e.jsx(Pl,{}),e.jsx(Ll,{frontendApiOrigins:t.frontendApiOrigins})]})})},We=()=>{const{data:t,error:s,mutate:n}=Ee(ne("api/admin/groups"),Nl);return u.useMemo(()=>({groups:(t==null?void 0:t.groups.map(o=>({...o,users:ur(o.users??[])})))??[],loading:!s&&!t,refetchGroups:()=>n(),error:s}),[t,s,n])},Nl=t=>fetch(t).then(ue("Groups")).then(s=>s.json());var Gs={},Ml=Gt;Object.defineProperty(Gs,"__esModule",{value:!0});var Yo=Gs.default=void 0,Fl=Ml(Ft()),Gl=e,Wl=(0,Fl.default)((0,Gl.jsx)("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V18c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-1.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05.02.01.03.03.04.04 1.14.83 1.93 1.94 1.93 3.41V18c0 .35-.07.69-.18 1H22c.55 0 1-.45 1-1v-1.5c0-2.33-4.67-3.5-7-3.5z"}),"GroupRounded");Yo=Gs.default=Wl;const mt="This group is managed by your SCIM provider, only the role and description can be changed manually",zl=h("div")(({theme:t})=>({margin:t.spacing(-1),marginLeft:t.spacing(-.5),display:"flex",justifyContent:"center",alignItems:"center"})),ql=h(lo)(({theme:t})=>({borderRadius:t.shape.borderRadiusLarge,padding:t.spacing(1,1.5)})),Hl=({groupId:t,onEditUsers:s,onRemove:n,isScimGroup:o})=>{const[a,i]=u.useState(null),r=!!a,c=d=>{i(d.currentTarget)},l=()=>{i(null)},m=`group-${t}-actions`,p=`${m}-menu`;return e.jsxs(zl,{onClick:d=>{d.preventDefault(),d.stopPropagation()},children:[e.jsx(we,{title:o?mt:"Group actions",arrow:!0,describeChild:!0,children:e.jsx("div",{children:e.jsx(Oe,{id:m,"aria-controls":r?p:void 0,"aria-haspopup":"true","aria-expanded":r?"true":void 0,onClick:c,type:"button",size:"small",children:e.jsx(co,{})})})}),e.jsx(ql,{id:p,anchorEl:a,open:r,onClose:l,transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},disableScrollLock:!0,children:e.jsxs(uo,{"aria-labelledby":m,children:[e.jsxs(Ge,{onClick:l,component:ae,to:`/admin/groups/${t}/edit`,children:[e.jsx(ls,{children:e.jsx(yt,{})}),e.jsx(Pt,{children:e.jsx(D,{variant:"body2",children:"Edit group"})})]}),e.jsxs(Ge,{disabled:o,onClick:()=>{s(),l()},children:[e.jsx(ls,{children:e.jsx(Yo,{})}),e.jsx(Pt,{children:e.jsx(D,{variant:"body2",children:"Edit group users"})})]}),e.jsxs(Ge,{onClick:()=>{n(),l()},children:[e.jsx(ls,{children:e.jsx(Pe,{})}),e.jsx(Pt,{children:e.jsx(D,{variant:"body2",children:"Delete group"})})]})]})})]})},Vl=h(Ga)(({theme:t})=>({height:t.spacing(2.5),width:t.spacing(2.5),marginLeft:t.spacing(-.75)})),Yl=h(F)(({theme:t})=>({display:"flex",flexDirection:"column",gap:t.spacing(1),maxWidth:t.spacing(25)})),Jl=h(gt)({cursor:"pointer",overflowWrap:"anywhere"}),Kl=({group:t})=>{const s=Ce();return e.jsxs(e.Fragment,{children:[t.users.length>0?e.jsx(Wa,{users:t.users,AvatarComponent:Vl}):e.jsx("span",{children:"This group has no users"}),t.projects.length>0&&e.jsx(Wt,{component:"span",tooltip:e.jsx(Yl,{children:t.projects.map(n=>e.jsx(Jl,{onClick:o=>{o.preventDefault(),s(`/projects/${n}/settings/access`)},color:"secondary",icon:e.jsx(za,{}),children:n},n))}),children:e.jsxs("span",{children:[t.projects.length," project",t.projects.length!==1&&"s"]})})]})},Zl=h(ae)(({theme:t})=>({color:"inherit",textDecoration:"none",border:"none",padding:"0",background:"transparent",fontFamily:t.typography.fontFamily,pointer:"cursor"})),Ql=h("h3")(({theme:t})=>({margin:0,marginRight:"auto",fontWeight:t.typography.fontWeightRegular,fontSize:t.typography.body1.fontSize,lineHeight:"1.2"})),Xl=({group:t,onEditUsers:s,onRemoveGroup:n})=>{const{searchQuery:o}=Is(),{settings:{enabled:a}}=wt(),i=a&&!!t.scimId,r=e.jsx(Zs,{title:t.name,arrow:!0,component:Ql,children:e.jsx(Bt,{search:o,children:t.name})}),c=e.jsxs(e.Fragment,{children:[t.rootRole&&e.jsx(qa,{roleId:t.rootRole,hideIcon:!0}),e.jsx(Hl,{groupId:t.id,onEditUsers:()=>s(t),onRemove:()=>n(t),isScimGroup:i})]}),l=t.description&&e.jsx(Zs,{lines:2,title:t.description,arrow:!0,children:e.jsx(Bt,{search:o,children:t.description})});return e.jsx(Zl,{to:`/admin/groups/${t.id}`,children:e.jsx(Ha,{title:r,icon:e.jsx(Va,{}),headerActions:c,footer:e.jsx(Kl,{group:t}),children:l})})},ec=()=>{const t=h("div")(({theme:n})=>({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",margin:n.spacing(6),marginLeft:"auto",marginRight:"auto"})),s=h(D)(({theme:n})=>({fontSize:n.fontSizes.bodySize,marginBottom:n.spacing(2.5)}));return e.jsxs(t,{children:[e.jsx(s,{children:"No groups available. Get started by adding a new group."}),e.jsx(q,{to:"/admin/groups/create-group",component:ae,variant:"outlined",color:"primary",children:"Create your first group"})]})},tc=h("div")(({theme:t})=>({display:"flex",flexDirection:"column","& > span:first-of-type":{color:t.palette.text.secondary}})),sc=h("div")(({theme:t})=>({paddingLeft:t.spacing(1)})),nc=h("div")(({theme:t})=>({display:"flex",marginBottom:t.spacing(3),"& > div:first-of-type":{width:"100%",maxWidth:t.spacing(50),marginRight:t.spacing(1)}})),oc=h("li")({width:"100%"}),ac=(t,s,{selected:n})=>u.createElement(oc,{...t,key:s.id},e.jsx(zt,{icon:e.jsx(Ka,{fontSize:"small"}),checkedIcon:e.jsx(Za,{fontSize:"small"}),style:{marginRight:8},checked:n}),e.jsxs(tc,{children:[e.jsx("span",{children:s.name||s.username}),e.jsx("span",{children:s.name&&s.username?s.username:s.email})]})),ic=t=>e.jsx(sc,{children:t.length>1?`${t.length} users selected`:t[0].name||t[0].username||t[0].email}),Jo=({users:t,setUsers:s})=>{const{users:n,loading:o}=be(),{serviceAccounts:a,loading:i}=vt(),r=o||i,c=r?[]:[...n.map(l=>({...l,type:"USERS"})).sort((l,m)=>{const p=l.name||l.username||"",d=m.name||m.username||"";return p.localeCompare(d)}),...a.map(l=>({...l,type:"SERVICE ACCOUNTS"})).sort((l,m)=>{const p=l.name||l.username||"",d=m.name||m.username||"";return p.localeCompare(d)})];return c.length>200,e.jsx(nc,{children:e.jsx(Ya,{"data-testid":Ja,size:"small",limitTags:1,openOnFocus:!0,multiple:!0,disableCloseOnSelect:!0,value:t,onChange:(l,m,p)=>{l.type==="keydown"&&l.key==="Backspace"&&p==="removeOption"||s(m)},options:c,groupBy:l=>l.type,renderOption:ac,filterOptions:(l,{inputValue:m})=>l.filter(({name:p,username:d,email:g})=>cs(m,g)||cs(m,p)||cs(m,d)),isOptionEqualToValue:(l,m)=>l.id===m.id,getOptionLabel:l=>l.email||l.name||l.username||"",renderInput:l=>e.jsx(X,{...l,label:"Select users"}),renderTags:l=>ic(l),noOptionsText:r?"Loading…":"No options"})})},Ko=({users:t,setUsers:s})=>{const n=u.useMemo(()=>[{Header:"Avatar",accessor:"imageUrl",Cell:({row:{original:c}})=>e.jsx(oe,{children:e.jsx(ze,{user:c})}),maxWidth:85,disableSortBy:!0},{id:"name",Header:"Name",accessor:c=>c.name||"",Cell:({value:c,row:{original:l}})=>e.jsx(Se,{value:c,subtitle:l.email||l.username}),minWidth:100,searchable:!0},{Header:"Action",id:"Action",align:"center",Cell:({row:{original:c}})=>e.jsx(Ot,{children:e.jsx(we,{title:"Remove user from group",arrow:!0,describeChild:!0,children:e.jsx(Oe,{onClick:()=>s(l=>l.filter(m=>m.id!==c.id)),children:e.jsx(Pe,{})})})}),maxWidth:100,disableSortBy:!0},{accessor:c=>c.username||"",Header:"Username",searchable:!0},{accessor:c=>c.email||"",Header:"Email",searchable:!0}],[s]),[o]=u.useState(()=>({hiddenColumns:["Username","Email"]})),{headerGroups:a,rows:i,prepareRow:r}=G.useTable({columns:n,data:t,initialState:o,sortTypes:fe,autoResetHiddenColumns:!1,autoResetSortBy:!1,disableSortRemove:!0,disableMultiSort:!0},G.useSortBy,G.useFlexLayout);return e.jsx(w,{condition:i.length>0,show:e.jsx(ye,{rows:i,headerGroups:a,prepareRow:r})})},Ws=(t="",s="",n=[],o=[],a=null)=>{const r=ho().get("name"),[c,l]=u.useState(r||t),[m,p]=u.useState(s),[d,g]=u.useState(n),[x,j]=u.useState(o),[b,y]=u.useState(a),[S,k]=u.useState({});return{name:c,setName:l,description:m,setDescription:p,mappingsSSO:d,setMappingsSSO:g,users:x,setUsers:j,getGroupPayload:()=>({name:c,description:m,mappingsSSO:d,users:x.map(({id:v})=>({user:{id:v}})),rootRole:b||void 0}),clearErrors:()=>{k({})},errors:S,setErrors:k,rootRole:b,setRootRole:y}},rc=h("form")(()=>({display:"flex",flexDirection:"column",height:"100%"})),lc=h("p")(({theme:t})=>({color:t.palette.text.secondary,marginBottom:t.spacing(1)})),cc=h("div")(()=>({marginTop:"auto",display:"flex",justifyContent:"flex-end"})),dc=h(q)(({theme:t})=>({marginLeft:t.spacing(3)})),uc=h(F)(({theme:t})=>({marginTop:t.spacing(2)})),Zo=({open:t,setOpen:s,group:n})=>{const{refetchGroup:o}=Zt(n.id),{refetchGroups:a}=We(),{updateGroup:i,loading:r}=st(),{setToastData:c,setToastApiError:l}=K(),{uiConfig:m}=H(),{users:p,setUsers:d,getGroupPayload:g}=Ws(n.name,n.description,n.mappingsSSO,n.users,n.rootRole);u.useEffect(()=>{d(n.users)},[n.users,t,d]);const x=async b=>{b.preventDefault();try{await i(n.id,g()),o(),a(),s(!1),c({text:"Group users saved successfully",type:"success"})}catch(y){l(V(y))}},j=()=>`curl --location --request PUT '${m.unleashUrl}/api/admin/groups/${n.id}' \\
    --header 'Authorization: INSERT_API_KEY' \\
    --header 'Content-Type: application/json' \\
    --data-raw '${JSON.stringify(g(),void 0,2)}'`;return e.jsx(qt,{open:t,onClose:()=>{s(!1)},label:"Edit users",children:e.jsx(ke,{loading:r,modal:!0,title:"Edit users",description:"Groups is the best and easiest way to organize users and then use them in projects to assign a specific role in one go to all the users in a group.",documentationLink:"https://docs.getunleash.io/reference/rbac#user-groups",documentationLinkLabel:"Groups documentation",formatApiCode:j,children:e.jsxs(rc,{onSubmit:x,children:[e.jsxs("div",{children:[e.jsx(lc,{children:"Edit users in this group"}),e.jsx(Jo,{users:p,setUsers:d}),e.jsx(Ko,{users:p,setUsers:d})]}),e.jsx(cc,{children:e.jsxs(uc,{children:[e.jsx(q,{type:"submit",variant:"contained",color:"primary","data-testid":po,children:"Save"}),e.jsx(dc,{onClick:()=>{s(!1)},children:"Cancel"})]})})]})})})},Qo=({open:t,setOpen:s,group:n})=>{const{refetchGroups:o}=We(),{removeGroup:a}=st(),{setToastData:i,setToastApiError:r}=K(),c=Ce(),l=async()=>{try{await a(n.id),o(),s(!1),c("/admin/groups"),i({text:"Group removed successfully",type:"success"})}catch(m){r(V(m))}};return e.jsx(Q,{open:t,primaryButtonText:"Delete group",secondaryButtonText:"Cancel",onClick:l,onClose:()=>{s(!1)},title:"Delete group?",children:e.jsxs(D,{children:["Do you really want to delete ",e.jsx("strong",{children:n.name}),"? Users who are granted access to projects only via this group will lose access to those projects."]})})},hc=h("div")(({theme:t})=>({display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:t.spacing(2),gridAutoRows:"1fr"})),pc=(t,s)=>{var a,i,r,c,l,m,p;const n=s.toLowerCase(),o={names:(a=t.users)==null?void 0:a.map(d=>{var g;return((g=d.name)==null?void 0:g.toLowerCase())||""}),usernames:(i=t.users)==null?void 0:i.map(d=>{var g;return((g=d.username)==null?void 0:g.toLowerCase())||""}),emails:(r=t.users)==null?void 0:r.map(d=>{var g;return((g=d.email)==null?void 0:g.toLowerCase())||""})};return t.name.toLowerCase().includes(n)||((c=t.description)==null?void 0:c.toLowerCase().includes(n))||((l=o.names)==null?void 0:l.some(d=>d.includes(n)))||((m=o.usernames)==null?void 0:m.some(d=>d.includes(n)))||((p=o.emails)==null?void 0:p.some(d=>d.includes(n)))},mc=()=>{const t=Ce(),[s,n]=u.useState(!1),[o,a]=u.useState(!1),[i,r]=u.useState(void 0),{groups:c=[],loading:l}=We(),[m,p]=mo(),[d,g]=u.useState(m.get("search")||""),x=me(Be.breakpoints.down("md"));u.useEffect(()=>{const S={};d&&(S.search=d),p(S,{replace:!0})},[d,p]);const j=u.useMemo(()=>{const S=c.sort((k,E)=>k.name.localeCompare(E.name));return d?S.filter(k=>pc(k,d)):S},[c,d]),b=S=>{r(S),n(!0)},y=S=>{r(S),a(!0)};return e.jsxs(te,{isLoading:l,header:e.jsx(se,{title:`Groups (${j.length})`,actions:e.jsxs(e.Fragment,{children:[e.jsx(w,{condition:!x,show:e.jsxs(e.Fragment,{children:[e.jsx(ce,{initialValue:d,onChange:g}),e.jsx(se.Divider,{})]})}),e.jsx(Ps,{onClick:()=>t("/admin/groups/create-group"),maxWidth:"700px",Icon:Ht,permission:ee,"data-testid":Qa,children:"New group"})]}),children:e.jsx(w,{condition:x,show:e.jsx(ce,{initialValue:d,onChange:g})})}),children:[e.jsx(Ne,{value:d,children:e.jsx(hc,{children:j.map(S=>e.jsx(Xl,{group:S,onEditUsers:b,onRemoveGroup:y},S.id))})}),e.jsx(w,{condition:!l&&j.length===0,show:e.jsx(w,{condition:(d==null?void 0:d.length)>0,show:e.jsxs(de,{children:["No groups found matching “",d,"”"]}),elseShow:e.jsx(ec,{})})}),e.jsx(w,{condition:!!i,show:e.jsx(Zo,{open:s,setOpen:n,group:i})}),e.jsx(w,{condition:!!i,show:e.jsx(Qo,{open:o,setOpen:a,group:i})})]})},xc=h("div")(({theme:t})=>({display:"flex",marginBottom:t.spacing(1),"& > div:first-of-type":{width:"100%",marginRight:t.spacing(1),"& > div:first-of-type":{width:"100%"}}})),gc=({label:t,value:s,onChange:n,...o})=>{const[a,i]=u.useState(""),r=()=>{n(l=>[...l,a]),i("")},c=l=>{n(m=>m.filter(p=>p!==l))};return e.jsxs("div",{...o,children:[e.jsxs(xc,{children:[e.jsx(qe,{label:t,value:a,onChange:l=>i(l.target.value),onKeyPress:l=>{l.key==="Enter"&&r()}}),e.jsx(q,{startIcon:e.jsx(Ht,{}),onClick:r,variant:"outlined",color:"primary",disabled:!a.trim()||s.includes(a),children:"Add"})]}),e.jsx(Xa,{flexDirection:"row",flexWrap:"wrap",gap:1,children:s==null?void 0:s.map((l,m)=>e.jsx(ei,{label:l,onDelete:()=>c(l)},m))})]})},jc=h("form")(()=>({display:"flex",flexDirection:"column",height:"100%"})),it=h("p")(({theme:t})=>({color:t.palette.text.secondary,marginBottom:t.spacing(1)})),mn=h(qe)(({theme:t})=>({width:"100%",maxWidth:t.spacing(60),marginBottom:t.spacing(2)})),fc=h(gc)(({theme:t})=>({width:"100%",maxWidth:t.spacing(60),marginBottom:t.spacing(2)})),yc=h("div")(({theme:t})=>({marginBottom:t.spacing(6)})),bc=h("div")(()=>({marginTop:"auto",display:"flex",justifyContent:"flex-end"})),Sc=h(q)(({theme:t})=>({marginLeft:t.spacing(3)})),vc=h("div")(({theme:t})=>({width:"100%",maxWidth:t.spacing(60),padding:t.spacing(3),backgroundColor:t.palette.neutral.light,color:t.palette.text.primary,fontSize:t.fontSizes.smallBody,borderRadius:t.shape.borderRadiusMedium,marginBottom:t.spacing(2),a:{color:t.palette.links}})),Cc=h("div")(({theme:t})=>({"& > div:first-of-type":{width:"100%",maxWidth:t.spacing(50),marginBottom:t.spacing(2)}})),Xo=({name:t,description:s,mappingsSSO:n,users:o,rootRole:a,isScimGroup:i,setName:r,setDescription:c,setMappingsSSO:l,setUsers:m,handleSubmit:p,handleCancel:d,setRootRole:g,errors:x,mode:j,children:b})=>{const{config:y}=Ke("oidc"),{config:S}=Ke("saml"),{roles:k}=be(),E=(y==null?void 0:y.enabled)&&y.enableGroupSyncing||(S==null?void 0:S.enabled)&&S.enableGroupSyncing,A=v=>k.find(B=>B.id===v)||null;return e.jsxs(jc,{onSubmit:p,children:[e.jsxs("div",{children:[e.jsx(it,{children:"What would you like to call your group?"}),e.jsx(mn,{autoFocus:!0,label:"Name",id:"group-name",error:!!x.name,errorText:x.name,value:t,onChange:v=>r(v.target.value),"data-testid":ti,required:!0,disabled:i}),e.jsx(it,{children:"How would you describe your group?"}),e.jsx(mn,{multiline:!0,rows:4,label:"Description",placeholder:"A short description of the group",value:s,onChange:v=>c(v.target.value),"data-testid":si}),e.jsx(w,{condition:E&&!i,show:e.jsxs(e.Fragment,{children:[e.jsx(it,{children:"Is this group associated with SSO groups?"}),e.jsx(fc,{label:"SSO group ID / name",value:n,onChange:l})]}),elseShow:()=>e.jsxs(vc,{children:[e.jsxs(F,{sx:{display:"flex"},children:["You can enable SSO groups synchronization if needed",e.jsx(Ye,{tooltip:"SSO groups synchronization allows SSO groups to be mapped to Unleash groups, so that user group membership is properly synchronized."})]}),e.jsx(ae,{"data-loading":!0,to:"/admin/auth",children:e.jsx("span",{"data-loading":!0,children:"View SSO configuration"})})]})}),e.jsx(it,{children:e.jsxs(F,{sx:{display:"flex"},children:["Do you want to associate a root role with this group?",e.jsx(Ye,{tooltip:"When you associate a root role with this group, users in this group will automatically inherit the role globally."})]})}),e.jsx(Cc,{children:e.jsx(Xt,{"data-testid":"GROUP_ROOT_ROLE",roles:k,value:A(a),setValue:v=>g((v==null?void 0:v.id)||null)})}),e.jsx(w,{condition:j==="Create",show:e.jsxs(e.Fragment,{children:[e.jsx(it,{children:"Add users to this group"}),e.jsx(Jo,{users:o,setUsers:m}),e.jsx(yc,{children:e.jsx(Ko,{users:o,setUsers:m})})]})})]}),e.jsxs(bc,{children:[b,e.jsx(Sc,{onClick:d,children:"Cancel"})]})]})},wc=()=>{const{setToastData:t,setToastApiError:s}=K(),{uiConfig:n}=H(),o=Ce(),{name:a,setName:i,description:r,setDescription:c,mappingsSSO:l,setMappingsSSO:m,users:p,setUsers:d,rootRole:g,setRootRole:x,getGroupPayload:j,clearErrors:b,errors:y,setErrors:S}=Ws(),{groups:k}=We(),{createGroup:E,loading:A}=st(),v=async T=>{if(T.preventDefault(),b(),!P)return;const R=j();try{const I=await E(R);o(`/admin/groups/${I.id}`),t({text:"Group created successfully",type:"success"})}catch(I){s(V(I))}},B=()=>`curl --location --request POST '${n.unleashUrl}/api/admin/groups' \\
    --header 'Authorization: INSERT_API_KEY' \\
    --header 'Content-Type: application/json' \\
    --data-raw '${JSON.stringify(j(),void 0,2)}'`,L=()=>{o(Ie)},C=T=>T.length,W=T=>!(k!=null&&k.filter(R=>R.name===T).length),P=C(a)&&W(a),O=T=>{b(),W(T)||S({name:"A group with that name already exists."}),i(T)};return e.jsx(ke,{loading:A,title:"Create group",description:"Groups is the best and easiest way to organize users and then use them in projects to assign a specific role in one go to all the users in a group.",documentationLink:"https://docs.getunleash.io/reference/rbac#user-groups",documentationLinkLabel:"Groups documentation",formatApiCode:B,children:e.jsx(Xo,{name:a,description:r,mappingsSSO:l,rootRole:g,users:p,setName:O,setDescription:c,setMappingsSSO:m,setRootRole:x,setUsers:d,errors:y,handleSubmit:v,handleCancel:L,mode:ni,isScimGroup:!1,children:e.jsx(q,{type:"submit",variant:"contained",color:"primary",disabled:!P,"data-testid":oi,children:"Create group"})})})},Tc=()=>{const t=Number(Vt("groupId")),{group:s,refetchGroup:n}=Zt(t);return s?e.jsx(kc,{group:s,groupId:t,refetchGroup:n}):null},kc=({group:t,groupId:s,refetchGroup:n})=>{const{refetchGroups:o}=We(),{setToastData:a,setToastApiError:i}=K(),{uiConfig:r}=H(),c=Ce(),{settings:{enabled:l}}=wt(),m=l&&!!(t!=null&&t.scimId),{name:p,setName:d,description:g,setDescription:x,mappingsSSO:j,setMappingsSSO:b,users:y,setUsers:S,rootRole:k,setRootRole:E,getGroupPayload:A,clearErrors:v,errors:B,setErrors:L}=Ws(t==null?void 0:t.name,t==null?void 0:t.description,t==null?void 0:t.mappingsSSO,t==null?void 0:t.users,t==null?void 0:t.rootRole),{groups:C}=We(),{updateGroup:W,loading:P}=st(),O=async _=>{_.preventDefault(),v();const M=A();try{await W(s,M),n(),o(),c(Ie),a({text:"Group updated successfully",type:"success"})}catch(he){i(V(he))}},T=()=>`curl --location --request PUT '${r.unleashUrl}/api/admin/groups/${s}' \\
    --header 'Authorization: INSERT_API_KEY' \\
    --header 'Content-Type: application/json' \\
    --data-raw '${JSON.stringify(A(),void 0,2)}'`,R=()=>{c(Ie)},I=_=>_.length,$=_=>!(C!=null&&C.filter(M=>M.name===_&&M.id!==s).length),Y=I(p)&&$(p),U=_=>{v(),$(_)||L({name:"A group with that name already exists."}),d(_)};return e.jsx(ke,{loading:P,title:"Edit group",description:"Groups is the best and easiest way to organize users and then use them in projects to assign a specific role in one go to all the users in a group.",documentationLink:"https://docs.getunleash.io/reference/rbac#user-groups",documentationLinkLabel:"Groups documentation",formatApiCode:T,children:e.jsx(Xo,{name:p,description:g,mappingsSSO:j,users:y,rootRole:k,setName:U,setDescription:x,setMappingsSSO:b,setUsers:S,setRootRole:E,errors:B,handleSubmit:O,handleCancel:R,mode:Bs,isScimGroup:m,children:e.jsx(we,{title:m?mt:"",arrow:!0,children:e.jsx("div",{children:e.jsx(q,{type:"submit",variant:"contained",color:"primary",disabled:!Y,"data-testid":po,children:"Save"})})})})})},Ec=h(Ls)(({theme:t})=>({borderRadius:t.shape.borderRadiusLarge,padding:t.spacing(2.5,4),boxShadow:"none",marginBottom:t.spacing(2),fontSize:t.fontSizes.smallBody})),Rc=h("div")(({theme:t})=>({display:"flex",alignItems:"center",justifyContent:"space-between"})),Dc=h("h1")(({theme:t})=>({fontSize:t.fontSizes.mainHeader})),Ac=h("div")(({theme:t})=>({display:"flex"})),Ic=h("span")(({theme:t})=>({color:t.palette.text.secondary,fontSize:t.fontSizes.smallBody,marginLeft:t.spacing(1)})),Pc=({title:t,description:s,actions:n})=>($t(t),e.jsxs(Ec,{children:[e.jsxs(Rc,{children:[e.jsx(Dc,{children:t}),e.jsx(Ac,{children:n})]}),e.jsx(w,{condition:!!(s!=null&&s.length),show:e.jsxs(e.Fragment,{children:["Description:",e.jsx(Ic,{children:s})]})})]})),Bc=({open:t,setOpen:s,user:n,group:o})=>{const{refetchGroup:a}=Zt(o.id),{updateGroup:i}=st(),{setToastData:r,setToastApiError:c}=K(),l=async()=>{try{const p={...o,users:o.users.filter(({id:d})=>d!==(n==null?void 0:n.id)).map(({id:d})=>({user:{id:d}}))};await i(o.id,p),a(),s(!1),r({text:"User removed from group successfully",type:"success"})}catch(p){c(V(p))}},m=(n==null?void 0:n.name)||(n==null?void 0:n.username)||(n==null?void 0:n.email);return e.jsx(Q,{open:t&&!!n,primaryButtonText:"Remove user",secondaryButtonText:"Cancel",onClick:l,onClose:()=>{s(!1)},title:"Remove user from group?",children:e.jsxs(D,{children:["Do you really want to remove ",e.jsx("strong",{children:m})," from"," ",e.jsx("strong",{children:o.name}),"? ",e.jsx("strong",{children:m})," will lose all access rights granted by this group."]})})},Lc=Array(15).fill({name:"Name of the user",username:"Username of the user"}),Uc={id:"joinedAt",desc:!0},{value:xn,setValue:Oc}=ai("Group:v1",Uc),$c=()=>{const t=Number(Vt("groupId")),s=bt(),n=me(s.breakpoints.down("md")),{group:o,loading:a}=Zt(t),[i,r]=u.useState(!1),[c,l]=u.useState(!1),[m,p]=u.useState(!1),[d,g]=u.useState(),{settings:{enabled:x}}=wt(),j=x&&!!(o!=null&&o.scimId),b=u.useMemo(()=>[{Header:"Avatar",accessor:"imageUrl",Cell:({row:{original:R}})=>e.jsx(oe,{children:e.jsx(ze,{user:R})}),maxWidth:85,disableSortBy:!0},{id:"name",Header:"Name",accessor:R=>R.name||"",Cell:({value:R,row:{original:I}})=>e.jsx(Se,{value:R,subtitle:I.email||I.username}),minWidth:100,searchable:!0},{Header:"Joined",accessor:"joinedAt",Cell:je,maxWidth:150},{id:"createdBy",Header:"Added by",accessor:"createdBy",Cell:Se,minWidth:90,searchable:!0},{Header:"Last login",accessor:R=>R.seenAt||"",Cell:({row:{original:R}})=>e.jsx(_e,{value:R.seenAt,emptyText:"Never",title:I=>`Last login: ${I}`}),maxWidth:150},{Header:"Actions",id:"Actions",align:"center",Cell:({row:{original:R}})=>e.jsx(Ot,{children:e.jsx(we,{title:j?mt:"Remove user from group",arrow:!0,describeChild:!0,children:e.jsx("span",{children:e.jsx(Oe,{"data-testid":`${ii}-${R.id}`,onClick:()=>{g(R),p(!0)},disabled:j,children:e.jsx(Pe,{})})})})}),maxWidth:100,disableSortBy:!0},{accessor:R=>R.username||"",Header:"Username",searchable:!0},{accessor:R=>R.email||"",Header:"Email",searchable:!0}],[g,p]),[y,S]=mo(),[k]=u.useState(()=>({sortBy:[{id:y.get("sort")||xn.id,desc:y.has("order")?y.get("order")==="desc":xn.desc}],hiddenColumns:["Username","Email"],globalFilter:y.get("search")||""})),[E,A]=u.useState(k.globalFilter),{data:v,getSearchText:B,getSearchContext:L}=et(b,E,(o==null?void 0:o.users)??[]),C=u.useMemo(()=>(v==null?void 0:v.length)===0&&a?Lc:v,[v,a]),{headerGroups:W,rows:P,prepareRow:O,state:{sortBy:T}}=G.useTable({columns:b,data:C,initialState:k,sortTypes:fe,autoResetSortBy:!1,disableSortRemove:!0,disableMultiSort:!0},G.useSortBy,G.useFlexLayout);return u.useEffect(()=>{const R={};R.sort=T[0].id,T[0].desc&&(R.order="desc"),E&&(R.search=E),S(R,{replace:!0}),Oc({id:T[0].id,desc:T[0].desc||!1})},[T,E,S]),e.jsx(w,{condition:!!o,show:e.jsxs(e.Fragment,{children:[e.jsx(Pc,{title:o==null?void 0:o.name,description:o==null?void 0:o.description,actions:e.jsxs(e.Fragment,{children:[e.jsx(Le,{"data-testid":ri,to:`/admin/groups/${t}/edit`,component:ae,"data-loading":!0,permission:ee,tooltipProps:{title:j?mt:"Edit group"},children:e.jsx(yt,{})}),e.jsx(Le,{"data-testid":li,"data-loading":!0,onClick:()=>r(!0),permission:ee,tooltipProps:{title:"Delete group"},children:e.jsx(Pe,{})})]})}),e.jsxs(te,{isLoading:a,header:e.jsx(se,{secondary:!0,title:`Users (${P.length<C.length?`${P.length} of ${C.length}`:C.length})`,actions:e.jsxs(e.Fragment,{children:[e.jsx(w,{condition:!n,show:e.jsxs(e.Fragment,{children:[e.jsx(ce,{initialValue:E,onChange:A,hasFilters:!0,getSearchContext:L}),e.jsx(se.Divider,{})]})}),e.jsx(Ps,{"data-testid":ci,onClick:()=>{l(!0)},maxWidth:"700px",Icon:Ht,permission:ee,disabled:j,tooltipProps:{title:j?mt:""},children:"Edit users"})]}),children:e.jsx(w,{condition:n,show:e.jsx(ce,{initialValue:E,onChange:A,hasFilters:!0,getSearchContext:L})})}),children:[e.jsx(Ne,{value:B(E),children:e.jsx(ye,{rows:P,headerGroups:W,prepareRow:O})}),e.jsx(w,{condition:P.length===0,show:e.jsx(w,{condition:(E==null?void 0:E.length)>0,show:e.jsxs(de,{children:["No users found matching “",E,"” in this group."]}),elseShow:e.jsx(de,{children:"This group is empty. Get started by adding a user to the group."})})}),e.jsx(Qo,{open:i,setOpen:r,group:o}),e.jsx(Zo,{open:c,setOpen:l,group:o}),e.jsx(Bc,{open:m,setOpen:p,user:d,group:o})]})]})})},_c=()=>{const{uiConfig:t,isEnterprise:s}=H();return s()||t.flags[di]===!0?e.jsx("div",{children:e.jsx(ve,{permissions:Ae,children:e.jsxs(Qe,{children:[e.jsx(N,{index:!0,element:e.jsx(mc,{})}),e.jsx(N,{path:"create-group",element:e.jsx(wc,{})}),e.jsx(N,{path:":groupId/edit",element:e.jsx(Tc,{})}),e.jsx(N,{path:":groupId",element:e.jsx($c,{})})]})})}):e.jsx(Ze,{feature:"groups",page:!0})},ea=()=>{const{data:t,error:s,mutate:n}=Ee(ne("api/admin/instance-admin/statistics"),Nc);return u.useMemo(()=>({stats:t,loading:!s&&!t,refetchGroup:()=>n(),error:s}),[t,s,n])},Nc=t=>fetch(t).then(ue("Instance Stats")).then(s=>s.json()),Mc=()=>{var i,r,c;const{stats:t}=ea();let s,n;t!=null&&t.versionEnterprise?(s="Unleash Enterprise version",n=t.versionEnterprise):(s="Unleash OSS version",n=t==null?void 0:t.versionOSS);const o=Object.values((t==null?void 0:t.apiTokens)??{}).reduce((l,m)=>l+m,0),a=[{title:"Instance Id",value:t==null?void 0:t.instanceId,offset:!1},{title:s,value:n},{title:"Users",value:t==null?void 0:t.users},{title:"Feature flags",value:t==null?void 0:t.featureToggles},{title:"Projects",value:t==null?void 0:t.projects},{title:"Environments",value:t==null?void 0:t.environments},{title:"Roles",value:t==null?void 0:t.roles},{title:"Groups",value:t==null?void 0:t.groups},{title:"Context fields",value:t==null?void 0:t.contextFields},{title:"Strategies",value:t==null?void 0:t.strategies},{title:"Feature exports",value:t==null?void 0:t.featureExports},{title:"Feature imports",value:t==null?void 0:t.featureImports},{title:"Admin API tokens",value:(i=t==null?void 0:t.apiTokens)==null?void 0:i.admin},{title:"Client API tokens",value:(r=t==null?void 0:t.apiTokens)==null?void 0:r.client},{title:"Frontend API tokens",value:(c=t==null?void 0:t.apiTokens)==null?void 0:c.frontend},{title:"API tokens total",value:o},{title:"Segments",value:t==null?void 0:t.segments},{title:"Highest number of strategies used for a single flag in a single environment",value:t==null?void 0:t.maxEnvironmentStrategies},{title:"Highest number of constraints used on a single strategy",value:t==null?void 0:t.maxConstraints},{title:"Highest number of values used for a single constraint",value:t==null?void 0:t.maxConstraintValues}];return t!=null&&t.versionEnterprise&&a.push({title:"SAML enabled",value:t!=null&&t.SAMLenabled?"Yes":"No"},{title:"OIDC enabled",value:t!=null&&t.OIDCenabled?"Yes":"No"}),e.jsx(te,{header:e.jsx(se,{title:"Instance Statistics"}),children:e.jsxs(Qs,{sx:{display:"grid",gap:4},children:[e.jsxs(no,{"aria-label":"Instance statistics",children:[e.jsx(oo,{children:e.jsxs(jt,{children:[e.jsx(le,{children:"Field"}),e.jsx(le,{align:"right",children:"Value"})]})}),e.jsx(As,{children:a.map(l=>e.jsxs(jt,{children:[e.jsx(le,{component:"th",scope:"row",children:e.jsx(Qs,{component:"span",sx:m=>({marginLeft:l.offset?m.spacing(2):0}),children:l.title})}),e.jsx(le,{align:"right",children:l.value})]},l.title))})]}),e.jsx("span",{style:{textAlign:"center"},children:e.jsx(q,{startIcon:e.jsx(xo,{}),"aria-label":"Download instance statistics",color:"primary",variant:"contained",target:"_blank",rel:"noreferrer",href:ne("/api/admin/instance-admin/statistics/csv"),children:"Download"})})]})})},Fc=()=>e.jsx("div",{children:e.jsx(Mc,{})}),Gc=h("div")(({theme:t})=>({display:"flex",flexDirection:"column",padding:t.spacing(3),border:`1px solid ${t.palette.divider}`,borderRadius:t.shape.borderRadiusLarge})),Wc=h(F)(()=>({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center"})),zc=h(F)(({theme:t})=>({color:t.palette.text.secondary,fontSize:t.fontSizes.smallBody,marginTop:t.spacing(2)})),qc=h("p")(({theme:t})=>({display:"table-cell",fontWeight:t.fontWeight.bold,paddingTop:t.spacing(2)})),Hc=h("p")(({theme:t})=>({display:"table-cell",paddingTop:t.spacing(2),paddingLeft:t.spacing(4)})),Vc=h("div")(({theme:t})=>({display:"table-cell",width:"75%",paddingTop:t.spacing(2),paddingBottom:t.spacing(2)})),Yc=h("div")(({theme:t})=>({display:"table-cell"})),Jc=h("span")(({theme:t})=>({display:"block",textAlign:"right",color:t.palette.neutral.dark})),Kc=h("div")(({theme:t})=>({maxWidth:t.spacing(50),color:t.palette.text.secondary,fontSize:t.fontSizes.smallBody})),Zc=h("div")(()=>({display:"table-row"})),gn=h("div")(()=>({display:"table"})),Qc=h("div")(()=>({display:"table-cell"})),Xc=({changeInfoText:t,variablesText:s,dependsOnText:n})=>e.jsxs(Kc,{children:[e.jsx(jn,{children:t}),e.jsx(ed,{children:e.jsx("div",{children:s})}),e.jsx(w,{condition:!!n,show:e.jsx(jn,{children:n})})]}),ed=h("code")(({theme:t})=>({display:"block",color:t.palette.text.primary,backgroundColor:t.palette.background.application,fontSize:t.fontSizes.smallerBody,marginTop:t.spacing(1),padding:t.spacing(1),border:`1px solid ${t.palette.divider}`,borderRadius:t.shape.borderRadius,borderWidth:1,wordWrap:"break-word",whiteSpace:"pre-wrap",fontFamily:"monospace",lineHeight:1.5})),jn=h("p")(({theme:t})=>({color:t.palette.text.primary,fontSize:t.fontSizes.smallBody,marginTop:t.spacing(1)})),fn=({title:t,infoText:s,concreteDetails:n,enabled:o,changeInfoText:a,variablesText:i,dependsOnText:r})=>e.jsxs(Gc,{children:[e.jsxs(Wc,{children:[e.jsx("b",{children:t}),e.jsx(Yc,{children:e.jsx(w,{condition:o,show:e.jsx(gt,{color:"success",icon:e.jsx(Rs,{}),children:"Data is collected"}),elseShow:e.jsx(gt,{color:"neutral",icon:e.jsx(ui,{}),children:"No data is collected"})})})]}),e.jsxs(zc,{children:[e.jsxs(gn,{children:[e.jsx(Vc,{children:s}),e.jsx(Qc,{children:e.jsx(Jc,{children:e.jsx(Wt,{tooltip:e.jsx(Xc,{changeInfoText:a,variablesText:i,dependsOnText:r}),children:o?"How to disable collecting data?":"How to enable collecting data?"})})})]}),e.jsx(gn,{children:Object.entries(n).map(([c,l])=>e.jsxs(Zc,{children:[e.jsx(qc,{children:c}),e.jsx(Hc,{children:l})]},c))})]})]}),td=()=>{const{data:t,error:s,mutate:n}=Ee(ne("api/admin/telemetry/settings"),sd);return u.useMemo(()=>({settings:t,loading:!s&&!t,refetchGroup:()=>n(),error:s}),[t,s,n])},sd=t=>fetch(t).then(ue("Telemetry Settings")).then(s=>s.json()),nd=h(F)(({theme:t})=>({display:"grid",gap:t.spacing(4)})),ms={title:"Version data collection",infoText:"We collect the version of Unleash that you're using. We use this information to inform your Unleash instance of latest updates and critical security patches.",concreteDetails:{"Instance ID":"A unique ID generated for your instance",Version:"The version of Unleash that you're using"}},xs={title:"Feature data collection",infoText:"We collect data about your instance to improve the Unleash product user experience. We may also use the data in case you need help from our support team. Data collection is for internal use only and is not shared with third parties outside Unleash. As we want you to be in control of your data, we will leave it up to you to allow us to collect your data.",concreteDetails:{"Feature flags":"The number of feature flags in your instance",Users:"The number of users registered in your instance",Projects:"The number of projects in your instance","Context Fields":"The number of custom context fields in use",Groups:"The number of groups present in your instance",Roles:"The number of custom roles defined in your instance","Custom Root Roles":"The number of custom root roles defined in your instance","Custom Root Roles In Use":"The number of custom root roles that are in use by entities (users, groups, service accounts)",Environments:"The number of environments in your instance",Segments:"The number of segments defined in your instance",Strategies:"The number of strategies defined in your instance","Feature Exports":"The number of feature exports performed","Feature Imports":"The number of feature imports performed","Custom Strategies":"The number of custom strategies defined in your instance","Custom Strategies In Use":"The number of custom strategies that are in use by feature flags"}},yn={enabled:{environmentVariables:"CHECK_VERSION=false",changeInfoText:"Version info collection can be disabled by setting the environment variable `CHECK_VERSION` to `false` and restarting Unleash."},disabled:{environmentVariables:"CHECK_VERSION=true",changeInfoText:"Version info collection can be enabled by setting the environment variable to true and restarting Unleash."}},bn={enabled:{environmentVariables:"SEND_TELEMETRY=false",changeInfoText:"Feature usage collection can be disabled by setting the environment variable to false and restarting Unleash."},disabled:{environmentVariables:"SEND_TELEMETRY=true",changeInfoText:"To enable feature usage collection set the environment variable to true and restart Unleash."}},od=()=>{const{settings:t}=td(),{loading:s}=H();if(s)return null;const n=t!=null&&t.versionInfoCollectionEnabled?yn.enabled:yn.disabled,o=t!=null&&t.featureInfoCollectionEnabled?bn.enabled:bn.disabled;let a;return t!=null&&t.versionInfoCollectionEnabled||(a=t!=null&&t.featureInfoCollectionEnabled?"Note: Feature usage collection is enabled, but for it to be active you must also enable version info collection":"When you enable feature usage collection you must also enable version info collection"),e.jsx(te,{header:e.jsx(se,{title:"Instance Privacy"}),children:e.jsxs(nd,{children:[e.jsx(fn,{title:ms.title,infoText:ms.infoText,concreteDetails:ms.concreteDetails,enabled:t==null?void 0:t.versionInfoCollectionEnabled,changeInfoText:n.changeInfoText,variablesText:n.environmentVariables}),e.jsx(fn,{title:xs.title,infoText:xs.infoText,concreteDetails:xs.concreteDetails,enabled:(t==null?void 0:t.featureInfoCollectionEnabled)&&(t==null?void 0:t.versionInfoCollectionEnabled),changeInfoText:o.changeInfoText,variablesText:o.environmentVariables,dependsOnText:a})]})})},ad=()=>e.jsx(J,{severity:"warning",children:e.jsxs("p",{children:[e.jsx("b",{children:"Heads up!"})," If you enable maintenance mode, edit access in the entire system will be disabled for all the users (admins, editors, custom roles, etc). During this time nobody will be able to do changes or to make new configurations."]})}),id=()=>{const{data:t,error:s,mutate:n}=Ee(ne("api/admin/maintenance"),rd);return u.useMemo(()=>({enabled:!!(t!=null&&t.enabled),loading:!s&&!t,refetchMaintenance:n,error:s}),[t,s,n])},rd=t=>fetch(t).then(ue("Maintenance")).then(s=>s.json()),ld=()=>{const{makeRequest:t,createRequest:s,errors:n,loading:o}=xe({propagateErrors:!0});return{toggleMaintenance:async i=>{const c=s("api/admin/maintenance",{method:"POST",body:JSON.stringify(i)});await t(c.caller,c.id)},errors:n,loading:o}},cd=h("div")(({theme:t})=>({display:"flex",flexDirection:"column",padding:t.spacing(3),border:`1px solid ${t.palette.divider}`,borderRadius:t.shape.borderRadiusLarge})),dd=h(F)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center"}),ud=h(F)(({theme:t})=>({color:t.palette.text.secondary,fontSize:t.fontSizes.smallBody,marginTop:t.spacing(2)})),hd=h(D)(({theme:t})=>({fontSize:t.fontSizes.smallBody})),pd=()=>{const{enabled:t,refetchMaintenance:s}=id(),{refetch:n}=H(),{toggleMaintenance:o}=ld(),{trackEvent:a}=Us(),{setToastData:i}=K(),r=async()=>{i({type:"success",text:`Maintenance mode has been successfully ${t?"disabled":"enabled"}`}),a("maintenance",{props:{eventType:`maintenance ${t?"de":""}activated`}}),await o({enabled:!t}),s(),n()};return e.jsxs(cd,{children:[e.jsxs(dd,{children:[e.jsx("b",{children:"Maintenance Mode"}),e.jsx(re,{sx:{margin:0},control:e.jsx(ge,{onChange:r,value:t,name:"enabled",checked:t}),label:e.jsx(hd,{children:t?"Enabled":"Disabled"})})]}),e.jsx(ud,{children:"Maintenance Mode is useful when you want to freeze your system so nobody can do any changes during this time. When enabled it will show a banner at the top of the applications and only an admin can enable it or disable it."})]})},md=()=>e.jsx("div",{children:e.jsx(ve,{permissions:[ee,hi],children:e.jsx(gd,{})})}),xd=h(F)(({theme:t})=>({display:"grid",gap:t.spacing(4)})),gd=()=>{const{loading:t}=H();return t?null:e.jsx(te,{header:e.jsx(se,{title:"Maintenance"}),children:e.jsxs(xd,{children:[e.jsx(ad,{}),e.jsx(pd,{})]})})},jd=h(ae)(({theme:t})=>({display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",textDecoration:"none",color:"inherit",padding:t.spacing(0,5),"&.active":{fontWeight:"bold"}})),ta=({to:t,children:s})=>e.jsx(jd,{to:t,children:s}),fd=u.lazy(()=>tt(()=>import("./NetworkOverview-D8AnghGS.js"),[])),yd=u.lazy(()=>tt(()=>import("./NetworkConnectedEdges-B9eD1vcM.js"),[])),bd=u.lazy(()=>tt(()=>import("./NetworkTraffic-DMs5zzJP.js"),[])),Sd=u.lazy(()=>tt(()=>import("./NetworkTrafficUsage-CBqsbLjy.js"),[])),vd=u.lazy(()=>tt(()=>import("./BackendConnections-Bc1IXLRP.js"),[])),Cd=u.lazy(()=>tt(()=>import("./FrontendNetworkTrafficUsage-BB_PtRBn.js"),[])),Sn=[{label:"Overview",path:"/admin/network"},{label:"Traffic",path:"/admin/network/traffic"},{label:"Connected Edges",path:"/admin/network/connected-edges"}],wd=[{label:"Data Usage",path:"/admin/network/data-usage"}],Td=[{label:"Backend Connections",path:"/admin/network/backend-connections"},{label:"Frontend Traffic",path:"/admin/network/frontend-data-usage"}],kd=()=>{const{pathname:t}=Es(),s=xt("edgeObservability"),a=(xt("consumptionModel")?[...Sn,...Td]:[...Sn,...wd]).filter(({label:i})=>i!=="Connected Edges"||s);return e.jsx("div",{children:e.jsx(te,{withTabs:!0,header:e.jsx(go,{value:t,indicatorColor:"primary",textColor:"primary",variant:"scrollable",allowScrollButtonsMobile:!0,children:a.map(({label:i,path:r})=>e.jsx(jo,{value:r,label:e.jsx(ta,{to:r,children:e.jsx("span",{children:i})}),sx:{padding:0}},i))}),children:e.jsxs(Qe,{children:[e.jsx(N,{path:"*",element:e.jsx(fd,{})}),e.jsx(N,{path:"traffic",element:e.jsx(bd,{})}),s&&e.jsx(N,{path:"connected-edges",element:e.jsx(yd,{})}),e.jsx(N,{path:"data-usage",element:e.jsx(Sd,{})}),e.jsx(N,{path:"backend-connections",element:e.jsx(vd,{})}),e.jsx(N,{path:"frontend-data-usage",element:e.jsx(Cd,{})})]})})})},Ed=h(F)(()=>({display:"flex",justifyContent:"center"})),Rd=({role:t,onEdit:s,onDelete:n})=>{const o=Fe.includes(t.type);return e.jsxs(Ed,{children:[e.jsx(Le,{"data-loading":!0,onClick:s,permission:ee,disabled:o,tooltipProps:{title:o?"You cannot edit a predefined role":"Edit role"},children:e.jsx(yt,{})}),e.jsx(Le,{"data-loading":!0,onClick:n,permission:ee,disabled:o,tooltipProps:{title:o?"You cannot remove a predefined role":"Remove role"},children:e.jsx(Pe,{})})]})},Dd=h(gt)(({theme:t})=>({marginLeft:t.spacing(1)})),Ad=({role:t})=>e.jsx(Se,{value:t.name,subtitle:t.description,afterTitle:e.jsx(w,{condition:Fe.includes(t.type),show:e.jsx(Dd,{color:"success",children:"Predefined"})})}),Id=({users:t})=>{const[s]=u.useState(()=>({sortBy:[{id:"last-login",desc:!0}]})),n=u.useMemo(()=>[{id:"name",Header:"Name",accessor:r=>r.name||"",minWidth:200,Cell:({row:{original:r}})=>e.jsx(Se,{value:r.name,subtitle:r.email||r.username})},{Header:"Created",accessor:"createdAt",Cell:je,width:120,maxWidth:120},{id:"last-login",Header:"Last login",accessor:r=>r.seenAt||"",Cell:({row:{original:r}})=>e.jsx(_e,{value:r.seenAt,emptyText:"Never",title:c=>`Last login: ${c}`}),maxWidth:150}],[]),{headerGroups:o,rows:a,prepareRow:i}=G.useTable({columns:n,data:t,initialState:s,sortTypes:fe,autoResetHiddenColumns:!1,autoResetSortBy:!1,disableSortRemove:!0,disableMultiSort:!0},G.useSortBy,G.useFlexLayout);return e.jsx(ye,{rows:a,headerGroups:o,prepareRow:i})},Pd=h(D)(({theme:t})=>({fontSize:t.fontSizes.smallerBody})),sa=({serviceAccount:t,value:s,onCreateToken:n})=>{var a,i,r;const{searchQuery:o}=Is();return!t.tokens||t.tokens.length===0?n?e.jsx(fo,{title:"Create token",onClick:n}):e.jsx(oe,{children:"0 tokens"}):e.jsx(oe,{children:e.jsx(Wt,{tooltip:e.jsx(e.Fragment,{children:(a=t.tokens)==null?void 0:a.map(({id:c,description:l})=>e.jsx(Pd,{children:e.jsx(Bt,{search:o,children:l})},c))}),highlighted:o.length>0&&s.toLowerCase().includes(o.toLowerCase()),children:((i=t.tokens)==null?void 0:i.length)===1?"1 token":`${(r=t.tokens)==null?void 0:r.length} tokens`})})},Bd=({serviceAccounts:t})=>{const[s]=u.useState(()=>({sortBy:[{id:"seenAt",desc:!0}]})),n=u.useMemo(()=>[{id:"name",Header:"Name",accessor:r=>r.name||"",minWidth:200,Cell:({row:{original:r}})=>e.jsx(Se,{value:r.name,subtitle:r.username})},{id:"tokens",Header:"Tokens",accessor:r=>{var c;return((c=r.tokens)==null?void 0:c.map(({description:l})=>l).join(`
`))||""},Cell:({row:{original:r},value:c})=>e.jsx(sa,{serviceAccount:r,value:c}),maxWidth:100},{Header:"Created",accessor:"createdAt",Cell:je,width:120,maxWidth:120},{id:"seenAt",Header:"Last seen",accessor:r=>{var c;return(c=r.tokens.sort((l,m)=>{const p=new Date(l.seenAt||0),d=new Date(m.seenAt||0);return(d==null?void 0:d.getTime())-(p==null?void 0:p.getTime())})[0])==null?void 0:c.seenAt},Cell:_e,maxWidth:150}],[]),{headerGroups:o,rows:a,prepareRow:i}=G.useTable({columns:n,data:t,initialState:s,sortTypes:fe,autoResetHiddenColumns:!1,autoResetSortBy:!1,disableSortRemove:!0,disableMultiSort:!0},G.useSortBy,G.useFlexLayout);return e.jsx(ye,{rows:a,headerGroups:o,prepareRow:i})},Ld=({groups:t})=>{const[s]=u.useState(()=>({sortBy:[{id:"createdAt",desc:!0}]})),n=u.useMemo(()=>[{id:"name",Header:"Name",accessor:r=>r.name||"",minWidth:200,Cell:({row:{original:r}})=>e.jsx(Se,{value:r.name,subtitle:r.description})},{Header:"Created",accessor:"createdAt",Cell:je,width:120,maxWidth:120},{id:"users",Header:"Users",accessor:r=>r.users.length===1?"1 user":`${r.users.length} users`,Cell:oe,maxWidth:150}],[]),{headerGroups:o,rows:a,prepareRow:i}=G.useTable({columns:n,data:t,initialState:s,sortTypes:fe,autoResetHiddenColumns:!1,autoResetSortBy:!1,disableSortRemove:!0,disableMultiSort:!0},G.useSortBy,G.useFlexLayout);return e.jsx(ye,{rows:a,headerGroups:o,prepareRow:i})},gs=h("div")(({theme:t})=>({marginTop:t.spacing(1.5)})),js=h("p")(({theme:t})=>({marginTop:t.spacing(3)})),Ud=({role:t,open:s,setOpen:n,onConfirm:o})=>{const{users:a}=be(),{serviceAccounts:i}=vt(),{groups:r}=We(),c=a.filter(({rootRole:d})=>d===(t==null?void 0:t.id)),l=i.filter(({rootRole:d})=>d===(t==null?void 0:t.id)),m=r==null?void 0:r.filter(({rootRole:d})=>d===(t==null?void 0:t.id)),p=!!(c.length||l.length||m!=null&&m.length);return e.jsx(Q,{title:"Delete root role?",open:s,primaryButtonText:"Delete role",secondaryButtonText:"Cancel",disabledPrimaryButton:p,onClick:()=>o(t),onClose:()=>{n(!1)},children:e.jsx(w,{condition:p,show:e.jsxs(e.Fragment,{children:[e.jsx(J,{severity:"error",children:"You are not allowed to delete a role that is currently in use. Please change the role of the following entities first:"}),e.jsx(w,{condition:!!c.length,show:e.jsxs(e.Fragment,{children:[e.jsxs(js,{children:["Users (",c.length,"):"]}),e.jsx(gs,{children:e.jsx(Id,{users:c})})]})}),e.jsx(w,{condition:!!l.length,show:e.jsxs(e.Fragment,{children:[e.jsxs(js,{children:["Service accounts (",l.length,"):"]}),e.jsx(gs,{children:e.jsx(Bd,{serviceAccounts:l})})]})}),e.jsx(w,{condition:!!(m!=null&&m.length),show:e.jsxs(e.Fragment,{children:[e.jsxs(js,{children:["Groups (",m==null?void 0:m.length,"):"]}),e.jsx(gs,{children:e.jsx(Ld,{groups:m})})]})})]}),elseShow:e.jsxs("p",{children:["You are about to delete role:"," ",e.jsx("strong",{children:t==null?void 0:t.name})]})})})},Od=t=>{const{isEnterprise:s}=H(),{data:n,error:o,mutate:a}=_t(s()&&t,{projects:[]},ne(`api/admin/projects/roles/${t}/access`),$d);return u.useMemo(()=>({projects:(n==null?void 0:n.projects)??[],loading:!o&&!n,refetch:()=>a(),error:o}),[n,o,a])},$d=t=>fetch(t).then(ue("Project role usage")).then(s=>s.json()),_d=({projects:t})=>{const[s]=u.useState(()=>({sortBy:[{id:"name"}]})),n=u.useMemo(()=>[{id:"name",Header:"Project name",accessor:r=>r.project||"",minWidth:200,Cell:({row:{original:r}})=>e.jsx(fo,{title:r.project,to:`/projects/${r.project}`})},{id:"users",Header:"Assigned users",accessor:r=>r.userCount===1?"1 user":`${r.userCount} users`,Cell:oe,maxWidth:150},{id:"serviceAccounts",Header:"Service accounts",accessor:r=>r.serviceAccountCount===1?"1 account":`${r.serviceAccountCount} accounts`,Cell:oe,maxWidth:150},{id:"groups",Header:"Assigned groups",accessor:r=>r.groupCount===1?"1 group":`${r.groupCount} groups`,Cell:oe,maxWidth:150}],[]),{headerGroups:o,rows:a,prepareRow:i}=G.useTable({columns:n,data:t,initialState:s,sortTypes:fe,autoResetHiddenColumns:!1,autoResetSortBy:!1,disableSortRemove:!0,disableMultiSort:!0},G.useSortBy,G.useFlexLayout);return e.jsx(ye,{rows:a,headerGroups:o,prepareRow:i})},Nd=h("div")(({theme:t})=>({marginTop:t.spacing(1.5)})),Md=h("p")(({theme:t})=>({marginTop:t.spacing(3)})),Fd=({role:t,open:s,setOpen:n,onConfirm:o})=>{const{projects:a}=Od(t==null?void 0:t.id),i=!!(a!=null&&a.length);return e.jsx(Q,{title:"Delete project role?",open:s,primaryButtonText:"Delete role",secondaryButtonText:"Cancel",disabledPrimaryButton:i,onClick:()=>o(t),onClose:()=>{n(!1)},maxWidth:"md",children:e.jsx(w,{condition:i,show:e.jsxs(e.Fragment,{children:[e.jsx(J,{severity:"error",children:"You are not allowed to delete a role that is currently in use. Please change the role of the following entities first:"}),e.jsx(w,{condition:!!(a!=null&&a.length),show:e.jsxs(e.Fragment,{children:[e.jsxs(Md,{children:["Role assigned in ",a==null?void 0:a.length," ","projects:"]}),e.jsx(Nd,{children:e.jsx(_d,{projects:a})})]})})]}),elseShow:e.jsxs("p",{children:["You are about to delete role:"," ",e.jsx("strong",{children:t==null?void 0:t.name})]})})})},Gd="custom",Wd=({role:t,open:s,setOpen:n,onConfirm:o})=>(t==null?void 0:t.type)===Gd?e.jsx(Fd,{role:t,open:s,setOpen:n,onConfirm:o}):e.jsx(Ud,{role:t,open:s,setOpen:n,onConfirm:o}),na=()=>{const{loading:t,makeRequest:s,createRequest:n,errors:o}=xe({propagateErrors:!0});return{addRole:async l=>{const p=n("api/admin/roles",{method:"POST",body:JSON.stringify(l)},"addRole");return(await s(p.caller,p.id)).json()},updateRole:async(l,m)=>{const d=n(`api/admin/roles/${l}`,{method:"PUT",body:JSON.stringify(m)},"updateRole");await s(d.caller,d.id)},removeRole:async l=>{const p=n(`api/admin/roles/${l}`,{method:"DELETE"},"removeRole");await s(p.caller,p.id)},validateRole:async l=>{const p=n("api/admin/roles/validate",{method:"POST",body:JSON.stringify(l)},"validateRole");await s(p.caller,p.id)},errors:o,loading:t}},vn={name:void 0,description:void 0,permissions:void 0},zd=(t="",s="",n=[])=>{const{roles:o,projectRoles:a}=Ct(),[i,r]=u.useState(t),c=T=>r(T.trim()),[l,m]=u.useState(s),[p,d]=u.useState({}),[g,x]=u.useState(vn),[j,b]=u.useState(!1);u.useEffect(()=>{r(t)},[t]),u.useEffect(()=>{m(s)},[s]),u.useEffect(()=>{const T=Xs(n);d(T)},[n.length]);const y=(T=Ue)=>({name:i,description:l,type:T===Ue?"root-custom":"custom",permissions:Object.values(p).map(({name:R,environment:I})=>({name:R,environment:I}))}),S=T=>![...o,...a].some(R=>R.name!==t&&R.name.toLowerCase()===T.toLowerCase()),k=T=>T.length,E=T=>Object.keys(T).length>0,A=T=>{x(R=>({...R,[T]:void 0}))},v=(T,R)=>{x(I=>({...I,[T]:R}))},B=T=>{const R=T.trim();return k(R)?S(R)?(A("name"),!0):(v("name","Name must be unique."),!1):(v("name","Name is required."),!1)},L=T=>{const R=T.trim();return k(R)?(A("description"),!0):(v("description","Description is required."),!1)},C=T=>E(T)?(A("permissions"),!0):(v("permissions","You must select at least one permission."),!1),W=()=>{const T=B(i),R=L(l),I=C(p);return b(!0),T&&R&&I},P=j&&Object.values(g).some(Boolean);return{name:i,setName:c,validateName:B,description:l,setDescription:m,validateDescription:L,checkedPermissions:p,setCheckedPermissions:d,validatePermissions:C,getRolePayload:y,errors:g,showErrors:P,validate:W,reload:()=>{r(t),m(s),d(Xs(n)),b(!1),x(vn)}}};var zs={},qd=Gt;Object.defineProperty(zs,"__esModule",{value:!0});var oa=zs.default=void 0,Hd=qd(Ft()),Vd=e,Yd=(0,Hd.default)((0,Vd.jsx)("path",{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-6 10H6v-2h8v2zm4-4H6v-2h12v2z"}),"Topic");oa=zs.default=Yd;const Jd=({permissions:t,checkedPermissions:s,onPermissionChange:n})=>e.jsx(F,{display:"grid",gridTemplateColumns:{sm:"1fr 1fr",xs:"1fr"},children:t==null?void 0:t.map(o=>e.jsx(re,{"data-testid":Je(o),control:e.jsx(zt,{checked:!!s[Je(o)],onChange:()=>n(o),color:"primary"}),label:o.displayName},Je(o)))}),aa=t=>{const s=(t==null?void 0:t.map(i=>Je(i)).sort())||[],n=en.flatMap(i=>i.permissions.map(([r])=>r)).sort(),o=s.filter(i=>!n.includes(i));return[...en,{label:"Other",permissions:o.map(i=>[i])}].map(i=>({label:i.label,permissions:i.permissions.filter(([r])=>s.includes(r)).map(([r,c])=>[t.find(l=>Je(l)===r),c])})).filter(i=>i.permissions.length>0)},Kd=({permission:t,onChange:s,isChecked:n,hasParentPermission:o,isParentPermissionChecked:a})=>e.jsx(F,{sx:i=>({marginLeft:o?i.spacing(1.5):0}),children:e.jsx(re,{"data-testid":t,control:e.jsx(zt,{checked:!!(n||a),onChange:s,color:"primary",disabled:a}),label:t.displayName},t.name)}),Zd=h("div")(({theme:t})=>({display:"grid",gridTemplateColumns:"1fr 1fr",gap:t.spacing(1),[t.breakpoints.down("md")]:{gridTemplateColumns:"1fr"}})),Qd=h(D)(({theme:t})=>({fontWeight:t.typography.fontWeightBold,marginTop:t.spacing(2),marginBottom:t.spacing(1)})),Xd=({permissions:t,checkedPermissions:s,onPermissionChange:n})=>{const o=u.useMemo(()=>aa(t),[t]);return e.jsx(Zd,{children:o.map(a=>e.jsxs("div",{children:[e.jsx(Qd,{children:a.label}),e.jsx("div",{children:a.permissions.map(([i,r])=>e.jsx(Kd,{permission:i,onChange:()=>n(i),isChecked:!!s[i.name],hasParentPermission:!!r,isParentPermissionChecked:!!(r&&s[r])}))})]}))})},eu=h(F)(({theme:t})=>({display:"flex",alignItems:"center",[t.breakpoints.down(500)]:{flexDirection:"column",alignItems:"flex-start"}})),tu=h(pi)(({theme:t})=>({fontWeight:t.typography.fontWeightBold,marginRight:t.spacing(1)})),su=({title:t,permissions:s,checkedPermissions:n,Icon:o,isInitiallyExpanded:a=!1,context:i,children:r,onCheckAll:c})=>{const[l,m]=u.useState(a),p=u.useMemo(()=>(s==null?void 0:s.reduce((x,j)=>(x[Je(j)]=!0,x),{}))||{},[s]),d=u.useMemo(()=>Object.keys(n).filter(x=>p[x]).length||0,[n,p]),g=u.useMemo(()=>d===(s==null?void 0:s.length),[d,s]);return e.jsx(F,{sx:{my:2,pb:1},children:e.jsxs(yo,{expanded:l,onChange:()=>m(!l),sx:{boxShadow:"none",px:3,py:1,border:x=>`1px solid ${x.palette.divider}`,borderRadius:x=>`${x.shape.borderRadiusLarge}px`},children:[e.jsx(bo,{expandIcon:e.jsx(Oe,{children:e.jsx(So,{titleAccess:"Toggle"})}),sx:{boxShadow:"none",padding:"0"},children:e.jsxs(eu,{children:[o,e.jsx(tu,{text:t,maxWidth:"120",maxLength:25})," ",e.jsxs(D,{variant:"body2",color:"text.secondary",children:["(",d," / ",s==null?void 0:s.length," ","permissions)"]})]})}),e.jsxs(vo,{sx:{px:0,py:1,flexWrap:"wrap"},children:[e.jsx(Mt,{sx:{mb:1}}),e.jsxs(q,{variant:"text",size:"small",onClick:c,sx:{fontWeight:x=>x.typography.fontWeightRegular},children:[g?"Unselect ":"Select ","all ",i," permissions"]}),r]})]})})},nu=({type:t,checkedPermissions:s,setCheckedPermissions:n,validatePermissions:o})=>{const{permissions:a}=mi({revalidateIfStale:!1,revalidateOnReconnect:!1,revalidateOnFocus:!1}),i=xt("releasePlans"),r=Kn.includes(t),c=u.useMemo(()=>r?Co(xi(a.project,a.environments)):wo(a.root),[a,r]),l=p=>{const d=bi(s,p);o(d),n(d)},m=p=>{const d=Si(s,p);o(d),n(d)};return u.useMemo(()=>e.jsx(e.Fragment,{children:c.filter(({label:p})=>i||p!=="Release plan templates").map(({label:p,type:d,permissions:g})=>e.jsx(su,{title:p,context:p.toLowerCase(),Icon:d===gi?e.jsx(oa,{color:"disabled",sx:{mr:1}}):d===ji?e.jsx(fi,{color:"disabled",sx:{mr:1}}):e.jsx(yi,{color:"disabled",sx:{mr:1}}),permissions:g,checkedPermissions:s,onCheckAll:()=>m(g),children:d==="project"?e.jsx(Xd,{permissions:g,checkedPermissions:s,onPermissionChange:l}):e.jsx(Jd,{permissions:g,checkedPermissions:s,onPermissionChange:l})},p))}),[c,s])},fs=h("p")(({theme:t})=>({display:"flex",color:t.palette.text.primary,marginBottom:t.spacing(1),"&:not(:first-of-type)":{marginTop:t.spacing(4)}})),ou=h(qe)(({theme:t})=>({width:"100%",maxWidth:t.spacing(50)})),au=h(qe)({width:"100%"}),iu=({type:t=Ue,name:s,setName:n,description:o,setDescription:a,checkedPermissions:i,setCheckedPermissions:r,errors:c,showErrors:l,validateName:m,validateDescription:p,validatePermissions:d})=>{const g=x=>{setTimeout(()=>x(),300)};return e.jsxs("div",{children:[e.jsx(fs,{children:"What is your new role name?"}),e.jsx(ou,{autoFocus:!0,label:"Role name *",error:!!c.name,errorText:c.name,value:s,onChange:x=>{m(x.target.value),n(x.target.value)},onBlur:x=>g(()=>m(x.target.value)),autoComplete:"off"}),e.jsx(fs,{children:"What is your new role description?"}),e.jsx(au,{label:"Role description *",error:!!c.description,errorText:c.description,value:o,onChange:x=>{p(x.target.value),a(x.target.value)},onBlur:x=>g(()=>p(x.target.value)),autoComplete:"off"}),e.jsx(fs,{children:"What is your role allowed to do?"}),e.jsx(J,{severity:"info",children:"You must select at least one permission."}),e.jsx(nu,{type:t,checkedPermissions:i,setCheckedPermissions:r,validatePermissions:d}),e.jsx(w,{condition:l,show:()=>e.jsx(J,{severity:"error",icon:!1,children:e.jsx("ul",{children:Object.values(c).filter(Boolean).map(x=>e.jsx("li",{children:x},x))})})})]})},ru=h("form")(()=>({display:"flex",flexDirection:"column",height:"100%"})),lu=h("div")(({theme:t})=>({marginTop:"auto",display:"flex",justifyContent:"flex-end",paddingTop:t.spacing(4)})),cu=h(q)(({theme:t})=>({marginLeft:t.spacing(3)})),du=({type:t=Ue,roleId:s,open:n,setOpen:o})=>{const{role:a,refetch:i}=To(s==null?void 0:s.toString()),{name:r,setName:c,validateName:l,description:m,setDescription:p,validateDescription:d,checkedPermissions:g,setCheckedPermissions:x,validatePermissions:j,getRolePayload:b,errors:y,showErrors:S,validate:k,reload:E}=zd(a==null?void 0:a.name,a==null?void 0:a.description,a==null?void 0:a.permissions),{refetch:A}=Ct(),{addRole:v,updateRole:B,loading:L}=na(),{setToastData:C,setToastApiError:W}=K(),{uiConfig:P}=H(),O=a!==void 0,T=b(t),R=()=>`curl --location --request ${O?"PUT":"POST"} '${P.unleashUrl}/api/admin/roles${O?`/${a.id}`:""}' \\
    --header 'Authorization: INSERT_API_KEY' \\
    --header 'Content-Type: application/json' \\
    --data-raw '${JSON.stringify(T,void 0,2)}'`,I=()=>{A(),i()},$=async U=>{if(U.preventDefault(),!!k())try{O?await B(a.id,T):await v(T),C({text:`Role ${O?"updated":"added"} successfully`,type:"success"}),I(),o(!1)}catch(_){W(V(_))}};u.useEffect(()=>{E()},[n]);const Y=t[0].toUpperCase()+t.slice(1);return e.jsx(qt,{open:n,onClose:()=>{o(!1)},label:O?`Edit ${t} role`:`New ${t} role`,children:e.jsx(ke,{loading:L,modal:!0,title:O?`Edit ${t} role`:`New ${t} role`,description:`${Y} roles allow you to control access to ${t} resources. Besides the built-in ${t} roles, you can create and manage custom ${t} roles to fit your needs.`,documentationLink:`https://docs.getunleash.io/reference/rbac${t===Ue?"#custom-root-roles":"#custom-project-roles"}`,documentationLinkLabel:"Roles documentation",formatApiCode:R,children:e.jsxs(ru,{onSubmit:$,children:[e.jsx(iu,{type:t,name:r,setName:c,validateName:l,description:m,setDescription:p,validateDescription:d,checkedPermissions:g,setCheckedPermissions:x,validatePermissions:j,errors:y,showErrors:S}),e.jsxs(lu,{children:[e.jsxs(q,{type:"submit",variant:"contained",color:"primary",children:[O?"Save":"Add"," role"]}),e.jsx(cu,{onClick:()=>{o(!1)},children:"Cancel"})]})]})})})},uu=({row:t})=>{var o,a;const{original:s}=t,{role:n}=To(s.id.toString());return!n||Fe.includes(n.type)?null:e.jsx(oe,{children:e.jsx(Wt,{tooltip:e.jsx(Jn,{roleId:s.id,tooltip:!0}),children:((o=n.permissions)==null?void 0:o.length)===1?"1 permission":`${(a=n.permissions)==null?void 0:a.length} permissions`})})},Cn=({type:t=Ue,searchValue:s="",modalOpen:n,setModalOpen:o,selectedRole:a,setSelectedRole:i})=>{const{setToastData:r,setToastApiError:c}=K(),l=bt(),{roles:m,projectRoles:p,refetch:d,loading:g}=Ct(),{removeRole:x}=na(),[j,b]=u.useState(!1),y=async P=>{try{await x(P.id),r({text:`${P.name} has been deleted`,type:"success"}),d(),b(!1)}catch(O){c(V(O))}},S=me(l.breakpoints.down("md")),k=u.useMemo(()=>[{id:"Icon",Cell:()=>e.jsx(ko,{icon:e.jsx(vi,{color:"disabled"})}),disableGlobalFilter:!0,maxWidth:50},{Header:"Role",accessor:"name",Cell:({row:{original:P}})=>e.jsx(Ad,{role:P}),searchable:!0,minWidth:100},{id:"permissions",Header:"Permissions",Cell:uu,maxWidth:140},{Header:"Actions",id:"Actions",align:"center",Cell:({row:{original:P}})=>e.jsx(Rd,{role:P,onEdit:()=>{i(P),o(!0)},onDelete:()=>{i(P),b(!0)}}),width:150,disableSortBy:!0},{accessor:"description",Header:"Description",searchable:!0}],[]),[E]=u.useState({sortBy:[{id:"name"}],hiddenColumns:["description"]}),{data:A,getSearchText:v}=et(k,s,t===Ue?m:p),{headerGroups:B,rows:L,prepareRow:C,setHiddenColumns:W}=G.useTable({columns:k,data:A,initialState:E,sortTypes:fe,autoResetHiddenColumns:!1,autoResetSortBy:!1,disableSortRemove:!0,disableMultiSort:!0,defaultColumn:{Cell:oe}},G.useSortBy,G.useFlexLayout);return St([{condition:S,columns:["Icon"]}],W,k),e.jsxs(te,{isLoading:g,children:[e.jsx(Ne,{value:v(s),children:e.jsx(ye,{rows:L,headerGroups:B,prepareRow:C})}),e.jsx(w,{condition:L.length===0,show:e.jsx(w,{condition:(s==null?void 0:s.length)>0,show:e.jsxs(de,{children:["No ",t," roles found matching “",s,"”"]}),elseShow:e.jsxs(de,{children:["No ",t," roles available. Get started by adding one."]})})}),e.jsx(du,{type:t,roleId:a==null?void 0:a.id,open:n,setOpen:o}),e.jsx(Wd,{role:a,open:j,setOpen:b,onConfirm:y})]})},hu=h("div")(()=>({display:"flex",justifyContent:"space-between",alignItems:"center"})),pu=h("div")({flex:1}),mu=h("div")({display:"flex",alignItems:"center"}),xu=()=>{$t("Roles");const{pathname:t}=Es(),{roles:s,projectRoles:n,loading:o}=Ct(),[a,i]=u.useState(""),[r,c]=u.useState(!1),[l,m]=u.useState(),p=[{label:"Root roles",path:"/admin/roles",total:s.length},{label:"Project roles",path:"/admin/roles/project-roles",total:n.length}],d=me(Be.breakpoints.down("md")),g=t.includes("project-roles")?tn:Ue;return e.jsx(te,{withTabs:!0,bodyClass:"page-body",isLoading:o,header:e.jsxs(e.Fragment,{children:[e.jsxs(hu,{children:[e.jsx(pu,{children:e.jsx(go,{value:t,indicatorColor:"primary",textColor:"primary",variant:"scrollable",allowScrollButtonsMobile:!0,children:p.map(({label:x,path:j,total:b})=>e.jsx(jo,{value:j,label:e.jsxs(ta,{to:j,children:[x," (",b,")"]}),sx:{padding:0}},x))})}),e.jsxs(mu,{children:[e.jsx(w,{condition:!d,show:e.jsxs(e.Fragment,{children:[e.jsx(ce,{initialValue:a,onChange:i}),e.jsx(se.Divider,{})]})}),e.jsxs(Ps,{onClick:()=>{m(void 0),c(!0)},maxWidth:`${Be.breakpoints.values.sm}px`,Icon:Ht,permission:ee,children:["New ",g," role"]})]})]}),e.jsx(w,{condition:d,show:e.jsx(ce,{initialValue:a,onChange:i})})]}),children:e.jsxs(Qe,{children:[e.jsx(N,{path:"project-roles",element:e.jsx(Cn,{type:tn,searchValue:a,modalOpen:r,setModalOpen:c,selectedRole:l,setSelectedRole:m})}),e.jsx(N,{path:"*",element:e.jsx(Cn,{type:Ue,searchValue:a,modalOpen:r,setModalOpen:c,selectedRole:l,setSelectedRole:m})})]})})},gu=()=>{const{isEnterprise:t}=H();return t()?e.jsx("div",{children:e.jsx(ve,{permissions:[Ci,ee],children:e.jsx(xu,{})})}):e.jsx(Ze,{feature:"project-roles",page:!0})},ia=()=>{const{loading:t,makeRequest:s,createRequest:n,errors:o}=xe({propagateErrors:!0});return{addServiceAccount:async c=>{const m=n("api/admin/service-account",{method:"POST",body:JSON.stringify(c)},"addServiceAccount");return(await s(m.caller,m.id)).json()},updateServiceAccount:async(c,l)=>{const p=n(`api/admin/service-account/${c}`,{method:"PUT",body:JSON.stringify(l)},"updateServiceAccount");await s(p.caller,p.id)},removeServiceAccount:async c=>{const m=n(`api/admin/service-account/${c}`,{method:"DELETE"},"removeServiceAccount");await s(m.caller,m.id)},errors:o,loading:t}},ra=()=>{const{makeRequest:t,createRequest:s,errors:n,loading:o}=xe({propagateErrors:!0});return{createServiceAccountToken:async(r,c)=>{const l=s(`api/admin/service-account/${r}/token`,{method:"POST",body:JSON.stringify(c)});return(await t(l.caller,l.id)).json()},deleteServiceAccountToken:async(r,c)=>{const l=s(`api/admin/service-account/${r}/token/${c}`,{method:"DELETE"});await t(l.caller,l.id)},errors:n,loading:o}},ju=t=>{const{isEnterprise:s}=H(),{data:n,error:o,mutate:a}=_t(s(),{pats:[]},ne(`api/admin/service-account/${t}/token`),fu);return{tokens:n?n.pats:void 0,loading:!o&&!n,refetchTokens:()=>a(),error:o}},fu=t=>fetch(t).then(ue("Service Account Tokens")).then(s=>s.json()),kt=Eo["30DAYS"],yu=({open:t,setOpen:s,tokens:n,onCreateClick:o})=>{const[a,i]=u.useState(""),[r,c]=u.useState(kt),[l,m]=u.useState(Lt(kt)),[p,d]=u.useState({});u.useEffect(()=>{i(""),c(kt),m(Lt(kt)),d({})},[t]);const g=j=>!(n!=null&&n.some(b=>b.description===j)),x=a.length&&g(a)&&l>new Date;return e.jsx(Q,{open:t,primaryButtonText:"Create token",secondaryButtonText:"Cancel",onClick:()=>o({description:a,expiresAt:l}),disabledPrimaryButton:!x,onClose:()=>{s(!1)},title:"New token",children:e.jsx(Ro,{description:a,setDescription:i,isDescriptionUnique:g,expiration:r,setExpiration:c,expiresAt:l,setExpiresAt:m,errors:p,setErrors:d})})},bu=h(J)(({theme:t})=>({marginBottom:t.spacing(3)})),la=({open:t,setOpen:s,token:n})=>e.jsxs(Q,{open:t,secondaryButtonText:"Close",onClose:(o,a)=>{a||s(!1)},title:"Service account token created",children:[e.jsx(bu,{severity:"info",children:"Make sure to copy your service account API token now. You won't be able to see it again!"}),e.jsx(D,{variant:"body1",children:"Your token:"}),e.jsx(Zn,{token:(n==null?void 0:n.secret)||""})]}),Su=h("div")(({theme:t})=>({display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:t.spacing(2),gap:t.spacing(2),"& > div":{[t.breakpoints.down("md")]:{marginTop:0}}})),vu=h("div")(({theme:t})=>({display:"flex",flexDirection:"column",alignItems:"center",padding:t.spacing(3)})),Cu=h(D)(({theme:t})=>({fontSize:t.fontSizes.bodySize,marginBottom:t.spacing(.5)})),wu=h(D)(({theme:t})=>({fontSize:t.fontSizes.smallBody,color:t.palette.text.secondary,marginBottom:t.spacing(1.5)})),Tu={id:"createdAt",desc:!0},ca=({serviceAccount:t,readOnly:s})=>{const n=bt(),{setToastData:o,setToastApiError:a}=K(),i=me(n.breakpoints.down("md")),r=me(n.breakpoints.down("sm")),{tokens:c=[],refetchTokens:l}=ju(t.id),{refetch:m}=vt(),{createServiceAccountToken:p,deleteServiceAccountToken:d}=ra(),[g]=u.useState(()=>({sortBy:s?[{id:"seenAt"}]:[Tu]})),[x,j]=u.useState(""),[b,y]=u.useState(!1),[S,k]=u.useState(!1),[E,A]=u.useState(!1),[v,B]=u.useState(),[L,C]=u.useState(),W=async M=>{try{const he=await p(t.id,M);m(),l(),y(!1),B(he),k(!0),o({text:"Token created successfully",type:"success"})}catch(he){a(V(he))}},P=async()=>{if(L)try{await d(t.id,L==null?void 0:L.id),m(),l(),A(!1),o({text:"Token deleted successfully",type:"success"})}catch(M){a(V(M))}},O=u.useMemo(()=>[{Header:"Description",accessor:"description",Cell:Se,minWidth:100,searchable:!0},{Header:"Expires",accessor:"expiresAt",Cell:({value:M})=>new Date(M).getFullYear()>new Date().getFullYear()+100?e.jsx(oe,{children:"Never"}):e.jsx(je,{value:M}),maxWidth:150},{Header:"Created",accessor:"createdAt",Cell:je,maxWidth:150},{Header:"Last seen",accessor:"seenAt",Cell:_e,maxWidth:150},{Header:"Actions",id:"Actions",align:"center",Cell:({row:{original:M}})=>e.jsx(Ot,{children:e.jsx(we,{title:"Delete token",arrow:!0,describeChild:!0,children:e.jsx("span",{children:e.jsx(Oe,{onClick:()=>{C(M),A(!0)},children:e.jsx(Pe,{})})})})}),maxWidth:100,disableSortBy:!0}],[C,A]),{data:T,getSearchText:R,getSearchContext:I}=et(O,x,c),{headerGroups:$,rows:Y,prepareRow:U,setHiddenColumns:_}=G.useTable({columns:O,data:T,initialState:g,sortTypes:fe,autoResetHiddenColumns:!1,autoResetSortBy:!1,disableSortRemove:!0,disableMultiSort:!0},G.useSortBy,G.useFlexLayout);return St([{condition:r,columns:["expiresAt"]},{condition:i,columns:["createdAt"]},{condition:!!s,columns:["Actions","expiresAt","createdAt"]}],_,O),e.jsxs(e.Fragment,{children:[e.jsx(w,{condition:!s,show:e.jsxs(Su,{children:[e.jsx(ce,{initialValue:x,onChange:j,getSearchContext:I}),e.jsx(q,{variant:"contained",color:"primary",disabled:c.length>=wi,onClick:()=>y(!0),children:"New token"})]})}),e.jsx(Ne,{value:R(x),children:e.jsx(ye,{rows:Y,headerGroups:$,prepareRow:U})}),e.jsx(w,{condition:Y.length===0,show:e.jsx(w,{condition:(x==null?void 0:x.length)>0,show:e.jsxs(de,{children:["No tokens found matching “",x,"”"]}),elseShow:e.jsxs(vu,{children:[e.jsx(Cu,{children:"You have no tokens for this service account yet."}),e.jsx(wu,{children:"Create a service account token for access to the Unleash API."}),e.jsx(q,{variant:"outlined",onClick:()=>y(!0),children:"Create new service account token"})]})})}),e.jsx(yu,{open:b,setOpen:y,tokens:c,onCreateClick:W}),e.jsx(la,{open:S,setOpen:k,token:v}),e.jsx(Q,{open:E,primaryButtonText:"Delete token",secondaryButtonText:"Cancel",onClick:P,onClose:()=>{A(!1)},title:"Delete token?",children:e.jsxs(D,{children:['Any applications or scripts using this token "',e.jsx("strong",{children:L==null?void 0:L.description}),'" will no longer be able to access the Unleash API. You cannot undo this action.']})})]})},ku=h("form")(()=>({display:"flex",flexDirection:"column",height:"100%"})),rt=h("p")(({theme:t})=>({display:"flex",color:t.palette.text.primary,marginBottom:t.spacing(1),"&:not(:first-of-type)":{marginTop:t.spacing(4)}})),wn=h("p")(({theme:t})=>({color:t.palette.text.secondary,marginBottom:t.spacing(1)})),Tn=h(qe)(({theme:t})=>({width:"100%",maxWidth:t.spacing(50)})),Eu=h(Xt)(({theme:t})=>({width:"100%",maxWidth:t.spacing(50)})),Ru=h("div")(({theme:t})=>({padding:t.spacing(3),backgroundColor:t.palette.background.elevation2,borderRadius:t.shape.borderRadiusMedium,marginTop:t.spacing(4),marginBottom:t.spacing(2)})),Du=h("div")(({theme:t})=>({padding:t.spacing(0,4),"& > p:not(:first-of-type)":{marginTop:t.spacing(2)}})),Au=h("div")(({theme:t})=>({marginTop:"auto",display:"flex",justifyContent:"flex-end",paddingTop:t.spacing(4)})),Iu=h(q)(({theme:t})=>({marginLeft:t.spacing(3)})),Et=Eo["30DAYS"],Pu=({serviceAccount:t,open:s,setOpen:n,newToken:o})=>{const{users:a}=be(),{serviceAccounts:i,roles:r,refetch:c}=vt(),{addServiceAccount:l,updateServiceAccount:m,loading:p}=ia(),{createServiceAccountToken:d}=ra(),{setToastData:g,setToastApiError:x}=K(),{uiConfig:j}=H(),[b,y]=u.useState(""),[S,k]=u.useState(""),[E,A]=u.useState(null),[v,B]=u.useState("later"),[L,C]=u.useState({}),W=Z=>{C(pe=>({...pe,[Z]:void 0}))},P=(Z,pe)=>{C(at=>({...at,[Z]:pe}))},[O,T]=u.useState(""),[R,I]=u.useState(Et),[$,Y]=u.useState(Lt(Et)),[U,_]=u.useState({}),M=t!==void 0;u.useEffect(()=>{y((t==null?void 0:t.name)||""),k((t==null?void 0:t.username)||""),A(r.find(({id:Z})=>Z===(t==null?void 0:t.rootRole))||null),B("later"),C({}),T(""),I(Et),Y(Lt(Et)),_({})},[s,t]);const he=()=>({name:b,username:S,rootRole:(E==null?void 0:E.id)||0}),ts=async Z=>{Z.preventDefault();try{if(M)await m(t.id,he());else{const{id:pe}=await l(he());if(v==="now"){const at=await d(pe,{description:O,expiresAt:$});o(at)}}g({text:`Service account ${M?"updated":"added"} successfully`,type:"success"}),c(),n(!1)}catch(pe){x(V(pe))}},ss=()=>`curl --location --request ${M?"PUT":"POST"} '${j.unleashUrl}/api/admin/service-account${M?`/${t.id}`:""}' \\
    --header 'Authorization: INSERT_API_KEY' \\
    --header 'Content-Type: application/json' \\
    --data-raw '${JSON.stringify(he(),void 0,2)}'`,Me=Z=>Z.length,nt=Z=>!(a!=null&&a.some(pe=>pe.username===Z))&&!(i!=null&&i.some(pe=>pe.username===Z)),ns=E!==null,os=v==="later"||Me(O)&&$>new Date,as=Me(b)&&Me(S)&&(M||nt(S))&&ns&&os,ot=()=>{if(Me(b)&&!Me(S)){const Z=`service-${b.toLowerCase().replace(/ /g,"-").replace(/[^\w_-]/g,"")}`;nt(Z)&&k(Z)}},is=Z=>{W("username"),nt(Z)||P("username","A service account or user with that username already exists."),k(Z)};return e.jsx(qt,{open:s,onClose:()=>{n(!1)},label:M?"Edit service account":"New service account",children:e.jsx(ke,{loading:p,modal:!0,title:M?"Edit service account":"New service account",description:"A service account is a special type of account that can only be used to authenticate with the Unleash API. Service accounts can be used to automate tasks.",documentationLink:"https://docs.getunleash.io/reference/service-accounts",documentationLinkLabel:"Service accounts documentation",formatApiCode:ss,children:e.jsxs(ku,{onSubmit:ts,children:[e.jsxs("div",{children:[e.jsx(rt,{children:"What is your new service account name?"}),e.jsx(Tn,{autoFocus:!0,label:"Service account name",value:b,onChange:Z=>y(Z.target.value),onBlur:ot,autoComplete:"off",required:!0}),e.jsx(rt,{children:"What is your new service account username?"}),e.jsx(Tn,{label:"Service account username",error:!!L.username,errorText:L.username,value:S,onChange:Z=>is(Z.target.value),autoComplete:"off",required:!0,disabled:M}),e.jsx(rt,{children:"What is your service account allowed to do?"}),e.jsx(Eu,{roles:r,value:E,setValue:A,required:!0}),e.jsx(w,{condition:!M,show:e.jsxs(Ru,{children:[e.jsx(rt,{children:"Token"}),e.jsxs(wn,{children:["In order to connect your newly created service account, you will also need a token."," ",e.jsx(Os,{href:"https://docs.getunleash.io/reference/api-tokens-and-client-keys",target:"_blank",rel:"noreferrer",children:"Read more about API tokens"}),"."]}),e.jsx(Nt,{children:e.jsxs(Ti,{value:v,onChange:Z=>B(Z.target.value),name:"token-generation",children:[e.jsx(re,{value:"later",control:e.jsx(sn,{}),label:"I want to generate a token later"}),e.jsx(re,{value:"now",control:e.jsx(sn,{}),label:"Generate a token now"})]})}),e.jsxs(Du,{children:[e.jsx(wn,{children:"A new personal access token (PAT) will be generated for the service account, so you can get started right away."}),e.jsx(w,{condition:v==="now",show:e.jsx(Ro,{description:O,setDescription:T,expiration:R,setExpiration:I,expiresAt:$,setExpiresAt:Y,errors:U,setErrors:_})})]})]}),elseShow:e.jsxs(e.Fragment,{children:[e.jsx(rt,{children:"Service account tokens"}),e.jsx(ca,{serviceAccount:t})]})})]}),e.jsxs(Au,{children:[e.jsxs(q,{type:"submit",variant:"contained",color:"primary",disabled:!as,children:[M?"Save":"Add"," service account"]}),e.jsx(Iu,{onClick:()=>{n(!1)},children:"Cancel"})]})]})})})},Bu=h("div")(({theme:t})=>({marginTop:t.spacing(1.5)})),kn=h("p")(({theme:t})=>({marginTop:t.spacing(3)})),Lu=({serviceAccount:t,open:s,setOpen:n,onConfirm:o})=>{const a=e.jsxs(e.Fragment,{children:["You are about to delete service account:"," ",e.jsx("strong",{children:t==null?void 0:t.name})]});return e.jsx(Q,{title:"Delete service account?",open:s,primaryButtonText:"Delete service account",secondaryButtonText:"Cancel",onClick:()=>o(t),onClose:()=>{n(!1)},children:e.jsx(w,{condition:!!(t!=null&&t.tokens.length),show:e.jsxs(e.Fragment,{children:[e.jsx(J,{severity:"error",children:"Deleting this service account may break any existing implementations currently using it."}),e.jsx(kn,{children:a}),e.jsx(kn,{children:"Service account tokens:"}),e.jsx(Bu,{children:e.jsx(ca,{serviceAccount:t,readOnly:!0})})]}),elseShow:e.jsx("p",{children:a})})})},Uu=h(F)(()=>({display:"flex",justifyContent:"center"})),Ou=({onEdit:t,onDelete:s})=>e.jsxs(Uu,{children:[e.jsx(Le,{"data-loading":!0,onClick:t,permission:ee,tooltipProps:{title:"Edit service account"},children:e.jsx(yt,{})}),e.jsx(Le,{"data-loading":!0,onClick:s,permission:ee,tooltipProps:{title:"Remove service account"},children:e.jsx(Pe,{})})]}),$u=()=>{const{setToastData:t,setToastApiError:s}=K(),{serviceAccounts:n,roles:o,refetch:a,loading:i}=vt(),{removeServiceAccount:r}=ia(),[c,l]=u.useState(""),[m,p]=u.useState(!1),[d,g]=u.useState(!1),[x,j]=u.useState(),[b,y]=u.useState(!1),[S,k]=u.useState(),E=async I=>{try{await r(I.id),t({text:`${I.name} has been deleted`,type:"success"}),a(),y(!1)}catch($){s(V($))}},A=me(Be.breakpoints.down("sm")),v=me(Be.breakpoints.down("md")),B=u.useMemo(()=>[{Header:"Avatar",accessor:"imageUrl",Cell:({row:{original:I}})=>e.jsx(oe,{children:e.jsx(ze,{user:I})}),disableSortBy:!0,maxWidth:80},{id:"name",Header:"Name",accessor:I=>I.name||"",minWidth:200,Cell:({row:{original:I}})=>e.jsx(Se,{value:I.name,subtitle:I.username}),searchable:!0},{id:"role",Header:"Role",accessor:I=>{var $;return(($=o.find(Y=>Y.id===I.rootRole))==null?void 0:$.name)||""},Cell:({row:{original:I},value:$})=>e.jsx($s,{value:$,role:I.rootRole}),maxWidth:120},{id:"tokens",Header:"Tokens",accessor:I=>{var $;return(($=I.tokens)==null?void 0:$.map(({description:Y})=>Y).join(`
`))||""},Cell:({row:{original:I},value:$})=>e.jsx(sa,{serviceAccount:I,value:$,onCreateToken:()=>{k(I),p(!0)}}),searchable:!0},{Header:"Created",accessor:"createdAt",Cell:je,width:120,maxWidth:120},{id:"seenAt",Header:"Last seen",accessor:I=>{var $;return($=I.tokens.sort((Y,U)=>{const _=new Date(Y.seenAt||0),M=new Date(U.seenAt||0);return(M==null?void 0:M.getTime())-(_==null?void 0:_.getTime())})[0])==null?void 0:$.seenAt},Cell:_e,maxWidth:150},{Header:"Actions",id:"Actions",align:"center",Cell:({row:{original:I}})=>e.jsx(Ou,{onEdit:()=>{k(I),p(!0)},onDelete:()=>{k(I),y(!0)}}),width:150,disableSortBy:!0},{accessor:"username",Header:"Username",searchable:!0}],[o]),[L]=u.useState({sortBy:[{id:"createdAt",desc:!0}],hiddenColumns:["username"]}),{data:C,getSearchText:W}=et(B,c,n),{headerGroups:P,rows:O,prepareRow:T,setHiddenColumns:R}=G.useTable({columns:B,data:C,initialState:L,sortTypes:fe,autoResetHiddenColumns:!1,autoResetSortBy:!1,disableSortRemove:!0,disableMultiSort:!0,defaultColumn:{Cell:oe}},G.useSortBy,G.useFlexLayout);return St([{condition:A,columns:["role","seenAt"]},{condition:v,columns:["imageUrl","tokens","createdAt"]}],R,B),e.jsxs(te,{isLoading:i,header:e.jsx(se,{title:`Service Accounts (${O.length})`,actions:e.jsxs(e.Fragment,{children:[e.jsx(w,{condition:!v,show:e.jsxs(e.Fragment,{children:[e.jsx(ce,{initialValue:c,onChange:l}),e.jsx(se.Divider,{})]})}),e.jsx(q,{variant:"contained",color:"primary",onClick:()=>{k(void 0),p(!0)},children:"New service account"})]}),children:e.jsx(w,{condition:v,show:e.jsx(ce,{initialValue:c,onChange:l})})}),children:[e.jsx(Ne,{value:W(c),children:e.jsx(ye,{rows:O,headerGroups:P,prepareRow:T})}),e.jsx(w,{condition:O.length===0,show:e.jsx(w,{condition:(c==null?void 0:c.length)>0,show:e.jsxs(de,{children:["No service accounts found matching “",c,"”"]}),elseShow:e.jsx(de,{children:"No service accounts available. Get started by adding one."})})}),e.jsx(Pu,{serviceAccount:S,open:m,setOpen:p,newToken:I=>{j(I),g(!0)}}),e.jsx(la,{open:d,setOpen:g,token:x}),e.jsx(Lu,{serviceAccount:S,open:b,setOpen:y,onConfirm:E})]})},_u=()=>{const{isEnterprise:t}=H();return e.jsx("div",{children:e.jsx(w,{condition:t(),show:e.jsx(ve,{permissions:ee,children:e.jsx($u,{})}),elseShow:e.jsx(Ze,{feature:"service-accounts",page:!0})})})},Nu=h("form")(()=>({display:"flex",flexDirection:"column",height:"100%"})),Mu=h("div")(({theme:t})=>({maxWidth:t.spacing(50)})),Fu=h("p")(({theme:t})=>({marginBottom:t.spacing(1)})),En=h(qe)(({theme:t})=>({width:"100%",marginBottom:t.spacing(2)})),Rn=h(D)(({theme:t})=>({margin:t.spacing(1,0)})),Gu=h("div")(()=>({display:"flex",alignItems:"center"})),Wu=h("div")(()=>({marginTop:"auto",display:"flex",justifyContent:"flex-end"})),zu=h(q)(({theme:t})=>({marginLeft:t.spacing(3)})),da=({children:t,email:s,name:n,rootRole:o,sendEmail:a,setEmail:i,setName:r,setSendEmail:c,setRootRole:l,handleSubmit:m,handleCancel:p,errors:d,clearErrors:g,mode:x})=>{const{uiConfig:j}=H(),{roles:b}=be();return e.jsxs(Nu,{onSubmit:m,children:[e.jsxs(Mu,{children:[e.jsx(Fu,{children:"Who is the new Unleash user?"}),e.jsx(En,{label:"Full name",value:n,onChange:y=>r(y.target.value),error:!!d.name,errorText:d.name,onFocus:()=>g(),autoFocus:!0}),e.jsx(En,{label:"Email",type:"email",value:s,onChange:y=>i(y.target.value),error:!!d.email,errorText:d.email,onFocus:()=>g()}),e.jsx(Rn,{variant:"subtitle1","data-loading":!0,children:"What is your team member allowed to do?"}),e.jsx(Xt,{roles:b,value:o,setValue:l,required:!0}),e.jsx(w,{condition:x!==Bs&&!!(j!=null&&j.emailEnabled),show:e.jsxs(Nt,{children:[e.jsx(Rn,{variant:"subtitle1","data-loading":!0,children:"Should we send an email to your new team member"}),e.jsxs(Gu,{children:[e.jsx(ge,{name:"sendEmail",onChange:()=>c(!a),checked:a}),e.jsx(D,{children:a?"Yes":"No"})]})]})})]}),e.jsxs(Wu,{children:[t,e.jsx(zu,{onClick:p,children:"Cancel"})]})]})},ua=(t="",s="",n=null)=>{const{uiConfig:o}=H(),{users:a,roles:i}=be(),[r,c]=u.useState(t),[l,m]=u.useState(s),[p,d]=u.useState(!1),[g,x]=u.useState(i.find(({id:A})=>A===n)||null),[j,b]=u.useState({});return u.useEffect(()=>{c(t)},[t]),u.useEffect(()=>{m(s)},[s]),u.useEffect(()=>{d((o==null?void 0:o.emailEnabled)||!1)},[o==null?void 0:o.emailEnabled]),u.useEffect(()=>{x(i.find(({id:A})=>A===n)||null)},[n]),{name:r,setName:c,email:l,setEmail:m,sendEmail:p,setSendEmail:d,rootRole:g,setRootRole:x,getAddUserPayload:()=>({name:r,email:l,sendEmail:p,rootRole:(g==null?void 0:g.id)||0}),validateName:()=>r.length===0?(b(A=>({...A,name:"Name can not be empty."})),!1):l.length===0?(b(A=>({...A,email:"Email can not be empty."})),!1):!0,validateEmail:()=>a.some(A=>A.email===l)?(b(A=>({...A,email:"Email already exists"})),!1):!0,clearErrors:()=>{b({})},errors:j}},qu=t=>u.createElement("svg",{width:197,height:177,viewBox:"0 0 197 177",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},u.createElement("g",{clipPath:"url(#clip0)"},u.createElement("path",{d:"M195.272 67.6884C195.201 67.6884 195.132 67.6668 195.074 67.6264L99.4918 1.00044C99.2009 0.798626 98.8553 0.690774 98.5013 0.691378C98.1474 0.691982 97.8021 0.801012 97.5119 1.00382L2.61779 67.6257C2.54273 67.6784 2.44984 67.6991 2.35954 67.6832C2.26924 67.6674 2.18893 67.6163 2.13629 67.5411C2.08364 67.466 2.06297 67.373 2.07881 67.2826C2.09466 67.1923 2.14573 67.1119 2.22079 67.0592L97.115 0.437299C97.5213 0.153417 98.0047 0.000817369 98.5002 2.3283e-06C98.9957 -0.000812712 99.4796 0.150195 99.8868 0.432738L195.469 67.0585C195.53 67.1006 195.575 67.1609 195.599 67.2306C195.623 67.3004 195.624 67.3758 195.602 67.4461C195.58 67.5164 195.536 67.5778 195.476 67.6214C195.417 67.6649 195.345 67.6884 195.272 67.6884L195.272 67.6884Z",fill:"#3F3D56"}),u.createElement("path",{d:"M8.04028 70.0501L98.5953 2.87773L189.837 74.8297L103.261 126.199L56.2576 115.476L8.04028 70.0501Z",fill:"#E6E6E6"}),u.createElement("path",{d:"M60.2251 157.928H15.4887C15.214 157.928 14.942 157.875 14.6881 157.77C14.4342 157.665 14.2035 157.511 14.0091 157.316C13.8147 157.122 13.6606 156.891 13.5554 156.637C13.4502 156.383 13.396 156.111 13.396 155.836C13.396 155.561 13.4502 155.289 13.5554 155.035C13.6606 154.781 13.8147 154.55 14.0091 154.356C14.2035 154.162 14.4342 154.008 14.6881 153.903C14.942 153.798 15.214 153.744 15.4887 153.744H60.2251C60.4998 153.744 60.7719 153.798 61.0258 153.903C61.2797 154.008 61.5104 154.162 61.7048 154.356C61.8991 154.55 62.0533 154.781 62.1585 155.035C62.2637 155.289 62.3179 155.561 62.3179 155.836C62.3179 156.111 62.2637 156.383 62.1585 156.637C62.0533 156.891 61.8991 157.122 61.7048 157.316C61.5104 157.511 61.2797 157.665 61.0258 157.77C60.7719 157.875 60.4998 157.928 60.2251 157.928Z",fill:"#607D8B"}),u.createElement("path",{d:"M31.5392 148.934H15.4887C15.214 148.934 14.942 148.88 14.6881 148.776C14.4342 148.671 14.2035 148.516 14.0091 148.322C13.8147 148.128 13.6606 147.897 13.5554 147.643C13.4502 147.389 13.396 147.117 13.396 146.842C13.396 146.567 13.4502 146.295 13.5554 146.041C13.6606 145.787 13.8147 145.556 14.0091 145.362C14.2035 145.168 14.4342 145.014 14.6881 144.909C14.942 144.804 15.214 144.75 15.4887 144.75H31.5392C31.8139 144.75 32.0859 144.804 32.3398 144.909C32.5937 145.014 32.8244 145.168 33.0188 145.362C33.2132 145.556 33.3674 145.787 33.4726 146.041C33.5778 146.295 33.6319 146.567 33.6319 146.842C33.6319 147.117 33.5778 147.389 33.4726 147.643C33.3674 147.897 33.2132 148.128 33.0188 148.322C32.8244 148.516 32.5937 148.671 32.3398 148.776C32.0859 148.88 31.8139 148.934 31.5392 148.934Z",fill:"#607D8B"}),u.createElement("path",{d:"M99.8687 107.464C99.5287 107.465 99.1918 107.399 98.8771 107.27L43.0291 84.0761V11.4759C43.0298 10.8339 43.2849 10.2184 43.7385 9.76446C44.192 9.31051 44.8069 9.05515 45.4484 9.0544H152.589C153.23 9.05515 153.845 9.31051 154.299 9.76446C154.752 10.2184 155.007 10.8339 155.008 11.4759V84.1267L154.903 84.1717L100.89 107.258C100.567 107.394 100.22 107.464 99.8687 107.464Z",fill:"white"}),u.createElement("path",{d:"M99.8687 107.637C99.5061 107.637 99.1469 107.567 98.8112 107.43L42.8562 84.1916V11.4759C42.857 10.788 43.1303 10.1286 43.6163 9.64218C44.1022 9.1558 44.7611 8.88221 45.4483 8.88143H152.589C153.276 8.88221 153.935 9.1558 154.421 9.64218C154.907 10.1286 155.18 10.788 155.181 11.4759V84.2409L100.958 107.417C100.613 107.563 100.243 107.637 99.8687 107.637ZM43.5474 83.7295L99.0748 106.79C99.5928 107.001 100.173 106.997 100.688 106.781L154.49 83.7842V11.4759C154.489 10.9714 154.288 10.4879 153.932 10.1312C153.576 9.77452 153.093 9.57387 152.589 9.57328H45.4483C44.9444 9.57387 44.4612 9.77452 44.1049 10.1312C43.7485 10.4879 43.548 10.9714 43.5474 11.4759L43.5474 83.7295Z",fill:"#3F3D56"}),u.createElement("path",{d:"M194.581 66.9965H194.512L154.835 83.9537L100.55 107.155C100.337 107.244 100.11 107.291 99.8797 107.292C99.6496 107.293 99.4215 107.249 99.2084 107.162L43.2018 83.9052L2.55059 67.0242L2.48849 66.9965H2.4193C1.77788 66.9972 1.16293 67.2526 0.70938 67.7066C0.255828 68.1605 0.000711706 68.776 0 69.418V174.579C0.000712619 175.221 0.255828 175.836 0.70938 176.29C1.16293 176.744 1.77788 176.999 2.4193 177H194.581C195.222 176.999 195.837 176.744 196.291 176.29C196.744 175.836 196.999 175.221 197 174.579V69.418C196.999 68.776 196.744 68.1605 196.291 67.7066C195.837 67.2526 195.222 66.9972 194.581 66.9965ZM196.309 174.579C196.309 175.037 196.126 175.477 195.802 175.801C195.478 176.126 195.039 176.308 194.581 176.308H2.4193C1.96104 176.308 1.52161 176.126 1.19757 175.801C0.873536 175.477 0.691411 175.037 0.691228 174.579V69.418C0.691855 68.9707 0.865197 68.541 1.17501 68.2187C1.48483 67.8963 1.90713 67.7063 2.35365 67.6884L43.2018 84.6524L98.9425 107.802C99.5459 108.047 100.222 108.044 100.823 107.791L154.835 84.7043L194.65 67.6884C195.096 67.7076 195.517 67.8982 195.826 68.2203C196.135 68.5425 196.308 68.9714 196.309 69.418V174.579Z",fill:"#3F3D56"}),u.createElement("path",{d:"M99.3104 86.8775C97.2487 86.8813 95.2416 86.214 93.5919 84.9762L93.4896 84.8994L71.9541 68.3963C70.9567 67.6314 70.1197 66.6774 69.4907 65.5888C68.8617 64.5001 68.4531 63.2981 68.2882 62.0514C68.1233 60.8047 68.2054 59.5377 68.5297 58.3228C68.8541 57.1078 69.4143 55.9687 70.1785 54.9704C70.9426 53.9722 71.8958 53.1344 72.9835 52.5048C74.0711 51.8753 75.2721 51.4663 76.5177 51.3013C77.7632 51.1362 79.0291 51.2184 80.243 51.543C81.4569 51.8676 82.595 52.4284 83.5923 53.1932L97.5414 63.8988L130.505 20.8706C131.27 19.8726 132.223 19.0351 133.311 18.4059C134.399 17.7767 135.6 17.3682 136.846 17.2036C138.091 17.039 139.357 17.1216 140.571 17.4467C141.785 17.7718 142.923 18.333 143.92 19.0982L143.715 19.3767L143.925 19.1023C145.936 20.6494 147.252 22.9319 147.584 25.449C147.916 27.9661 147.237 30.5122 145.696 32.5287L106.922 83.1402C106.026 84.3065 104.872 85.2503 103.552 85.8984C102.232 86.5466 100.781 86.8816 99.3104 86.8775Z",fill:"#607D8B"})),u.createElement("defs",null,u.createElement("clipPath",{id:"clip0"},u.createElement("rect",{width:197,height:177,fill:"white"})))),Hu=({open:t,closeConfirm:s,inviteLink:n})=>e.jsxs(Q,{open:t,title:"Team member added",primaryButtonText:"Close",onClick:s,children:[e.jsx(D,{children:"A new team member has been added. We’ve sent an email on your behalf to inform them of their new account and role. No further steps are required."}),e.jsx(F,{sx:{width:"100%",textAlign:"center",px:"auto",py:4},children:e.jsx(qu,{})}),e.jsx(D,{style:{fontWeight:"bold"},variant:"subtitle1",children:"In a rush?"}),e.jsx(D,{children:"You may also copy the invite link and send it to the user."}),e.jsx(Yt,{inviteLink:n})]}),Vu=({open:t,closeConfirm:s,inviteLink:n})=>e.jsxs(Q,{open:t,onClick:s,primaryButtonText:"Close",title:"Team member added",children:[e.jsx(D,{variant:"body1",sx:{mb:2},children:"A new team member has been added."}),e.jsx(D,{variant:"body1",children:"Please provide them with the following link. This will allow them to set up their password and get started with their Unleash account."}),e.jsx(Yt,{inviteLink:n}),e.jsx(J,{severity:"info",sx:{mt:2},children:e.jsxs(D,{variant:"body2",children:["Want to avoid this step in the future?"," ",e.jsx("a",{href:"https://docs.getunleash.io/docs/deploy/email",target:"_blank",rel:"noopener noreferrer",children:"If you configure an email server for Unleash"})," ","we'll automatically send informational getting started emails to new users once you add them."]})})]}),ha=({open:t,closeConfirm:s,emailSent:n,inviteLink:o})=>n?e.jsx(Hu,{open:t,closeConfirm:s,inviteLink:o}):e.jsx(Vu,{open:t,closeConfirm:s,inviteLink:o}),qs=t=>{const{instanceStatus:s}=Xe(),n=(s==null?void 0:s.plan)===Ds.PRO,o=qo,a=u.useMemo(()=>Yu(t,n,o),[t,n,o]),i=a.filter(r=>r.paid).length;return{seats:o,extraSeats:i,planUsers:a,isBillingUsers:n}},Yu=(t,s,n=0)=>(!s||!n||t.sort((o,a)=>o.createdAt.localeCompare(a.createdAt)).forEach((o,a)=>{o.paid=!1,a>=n&&(o.paid=!0)}),t),Ju=()=>{var r,c;const{users:t}=be(),{isBillingUsers:s,seats:n,planUsers:o}=qs(t),{instanceStatus:a}=Xe(),i=((c=(r=a==null?void 0:a.prices)==null?void 0:r.pro)==null?void 0:c.seat)??zo;return!s||o.length<n?null:e.jsx(J,{severity:"info",sx:{marginBottom:l=>l.spacing(3)},children:e.jsxs("p",{children:[e.jsx("strong",{children:"Heads up!"})," You are exceeding your allocated free members included in your plan (",o.length," of ",n,"). Creating this user will add ",e.jsxs("strong",{children:["$",i,"/month"]})," ","to your invoice, starting with your next payment."]})})},Ku=()=>{const{setToastApiError:t}=K(),{uiConfig:s}=H(),n=Ce(),o=ho(),a=o.get("name")||"",i=o.get("email")||"",{name:r,setName:c,email:l,setEmail:m,sendEmail:p,setSendEmail:d,rootRole:g,setRootRole:x,getAddUserPayload:j,validateName:b,validateEmail:y,errors:S,clearErrors:k}=ua(a,i),[E,A]=u.useState(!1),[v,B]=u.useState(""),{addUser:L,userLoading:C}=He(),W=async R=>{R.preventDefault(),k();const I=b(),$=y();if(I&&$){const Y=j();try{await L(Y).then(U=>U.json()).then(U=>{ks(),B(U.inviteLink),A(!0)})}catch(U){t(V(U))}}},P=()=>{A(!1),n("/admin/users")},O=()=>`curl --location --request POST '${s.unleashUrl}/api/admin/user-admin' \\
--header 'Authorization: INSERT_API_KEY' \\
--header 'Content-Type: application/json' \\
--data-raw '${JSON.stringify(j(),void 0,2)}'`,T=()=>{n(Ie)};return e.jsxs(ke,{loading:C,title:"Create Unleash user",description:"In order for a user to get access to Unleash, they need to be assigned a root role, such as Viewer, Editor, or Admin.",documentationLink:"https://docs.getunleash.io/reference/rbac#predefined-roles",documentationLinkLabel:"User management documentation",formatApiCode:O,children:[e.jsx(Ju,{}),e.jsx(da,{errors:S,handleSubmit:W,handleCancel:T,name:r,setName:c,email:l,setEmail:m,sendEmail:p,setSendEmail:d,rootRole:g,setRootRole:x,clearErrors:k,children:e.jsx(Vn,{name:"user",permission:ee})}),e.jsx(ha,{open:E,closeConfirm:P,emailSent:p,inviteLink:v})]})},Dn=[{key:ds(new Date,{hours:48}).toISOString(),label:"48 hours"},{key:ds(new Date,{weeks:1}).toISOString(),label:"1 week"},{key:ds(new Date,{months:1}).toISOString(),label:"1 month"}],Zu=(t,s)=>{const{uiConfig:n}=H();return t?()=>`curl --location --request PUT '${n.unleashUrl}/api/admin/invite-link/tokens/default' \\
--header 'Authorization: INSERT_API_KEY' \\
--header 'Content-Type: application/json' \\
--data-raw '${JSON.stringify({expiresAt:s},void 0,2)}'`:()=>`curl --location --request POST '${n.unleashUrl}/api/admin/invite-link/tokens' \\
--header 'Authorization: INSERT_API_KEY' \\
--header 'Content-Type: application/json' \\
--data-raw '${JSON.stringify({name:"default",expiresAt:s},void 0,2)}'`},Qu=()=>{var L;const t=Ce(),{data:s,loading:n}=ki(),[o,a]=u.useState(""),{mutate:i}=Ei(),{trackEvent:r}=Us(),[c,l]=u.useState(Dn[0].key),[m,p]=u.useState(!1),d=(L=s==null?void 0:s.tokens)==null?void 0:L.find(C=>C.name==="default"),g=!!d,x=Zu(g,c),[j,b]=u.useState(!1),{setToastApiError:y}=K(),{createToken:S,updateToken:k}=Ri(),E=async C=>{C.preventDefault(),b(!0),r("invite",{props:{eventType:g?"link update submitted":"link created"}});try{if(g)await k(d.secret,{expiresAt:c}),a(d.url);else{const P=await(await S({name:"default",expiresAt:c})).json();a(P.url)}}catch(W){y(V(W))}finally{b(!1),i(Ai)}},A=async()=>{b(!0);try{await k(d.secret,{enabled:!1}),t(Ie)}catch(C){y(V(C))}finally{b(!1)}},v=async()=>{p(!0)},B=()=>{a(""),t("/admin/users")};return e.jsxs(ke,{loading:n||j,title:g?"Update invite link":"Create invite link",description:"When you send an invite link to someone, they will be able to create an account and get access to Unleash. This new user will only have read access, until you change their assigned role.",documentationLink:"https://docs.getunleash.io/reference/public-signup",documentationLinkLabel:"Invite link documentation",formatApiCode:x,children:[e.jsxs(F,{component:"form",onSubmit:E,sx:{display:"flex",flexDirection:"column",flexGrow:1},"data-testid":"create-invite-link-form",children:[e.jsxs(F,{sx:{maxWidth:"400px"},children:[e.jsxs(F,{sx:{mb:2},children:[e.jsx(D,{sx:{mb:1},children:"Expiration period for the invite link"}),e.jsx(Do,{label:"Link will expire in",name:"type",options:Dn,value:c,onChange:l,fullWidth:!0})]}),e.jsx(D,{sx:{mb:1},children:"People using this link will be invited as:"}),e.jsxs(F,{sx:{p:2,borderRadius:C=>`${C.shape.borderRadiusMedium}px`,backgroundColor:C=>C.palette.background.elevation2},children:[e.jsx(D,{variant:"body2",fontWeight:"bold",children:"Viewer"}),e.jsx(D,{variant:"body2",color:"text.secondary",children:"Users with this role can only read root resources in Unleash. The viewer can be added to specific projects as project member. Viewers may not view API tokens."})]})]}),e.jsxs(F,{sx:{display:"flex",justifyContent:"flex-end",mt:"auto"},children:[e.jsx(Di,{type:"submit",permission:ee,disabled:j,children:g?"Update invite link":"Create invite link"}),e.jsx(w,{condition:g,show:e.jsx(q,{sx:{ml:2},onClick:v,color:"error",children:"Delete link"})}),e.jsx(q,{sx:{ml:2},onClick:()=>{t(Ie)},children:"Cancel"})]})]}),e.jsx(Q,{open:!!o,onClick:B,primaryButtonText:"Close",title:"Invite link created",children:e.jsxs(F,{children:[e.jsx(D,{variant:"body1",sx:{mb:2},children:"Using this link, new team members can now sign-up to Unleash."}),e.jsx(D,{variant:"body1",children:"Please provide them with the following link to get started. This will allow them to set up their password and get started with their Unleash account."}),e.jsx(Yt,{inviteLink:o})]})}),e.jsx(Q,{open:m,onClose:()=>p(!1),onClick:A,title:"Are you sure you want to delete your invite link?"})]})},pa={overlay:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.25)",zIndex:5},content:{width:"500px",maxWidth:"90%",margin:"0",top:"50%",left:"50%",right:"auto",bottom:"auto",transform:"translate(-50%, -50%)"}},Xu=h(ze)(({theme:t})=>({width:t.spacing(5),height:t.spacing(5),margin:0})),eh=({showDialog:t,closeDialog:s,user:n})=>{const[o,a]=u.useState({}),[i,r]=u.useState(),[c,l]=u.useState(!1),{classes:m}=Jt(),{changePassword:p}=He(),{setToastData:d,setToastApiError:g}=K(),x=y=>{r(void 0),a({...o,[y.target.name]:Bi(y.target.value)})},j=async y=>{if(y.preventDefault(),o.password===o.confirm){if(!c){r(Li);return}try{await p(n.id,o.password),a({}),s(),d({text:"Password changed successfully",type:"success"})}catch(S){const k=V(S);r(k),g(k)}}},b=y=>{y.preventDefault(),a({}),r(void 0),s()};return e.jsx(Q,{open:t,onClick:j,style:pa,onClose:b,primaryButtonText:"Save",title:"Update password",secondaryButtonText:"Cancel",maxWidth:"xs",children:e.jsxs("form",{onSubmit:j,className:Ao(m.contentSpacingY,m.flexColumn),children:[e.jsx(D,{variant:"subtitle1",children:"Changing password for user"}),e.jsxs("div",{className:m.flexRow,children:[e.jsx(Xu,{user:n,variant:"rounded"}),e.jsx(D,{variant:"subtitle1",style:{marginLeft:"1rem"},children:n.username||n.email})]}),e.jsx(Ii,{password:o.password,callback:l}),e.jsx(X,{label:"New password",name:"password",type:"password",value:o.password,error:!!i,helperText:i,onChange:x,variant:"outlined",size:"small"}),e.jsx(X,{label:"Confirm password",name:"confirm",type:"password",value:o.confirm,onChange:x,variant:"outlined",size:"small"}),e.jsx(Pi,{started:!!(o.password&&o.confirm),passwordsDoNotMatch:o.password!==o.confirm})]})})},th=h(ze)(({theme:t})=>({width:t.spacing(5),height:t.spacing(5),margin:0})),sh=({showDialog:t,closeDialog:s,user:n})=>{const{classes:o}=Jt(),{resetPassword:a}=He(),{setToastApiError:i}=K(),[r,c]=u.useState(""),l=async d=>{if(d.preventDefault(),!n.email){i("You can't reset the password of a user who doesn't have an email address.");return}try{const g=await a(n.email).then(x=>x.ok?x.json():void 0);g?c(g.resetPasswordUrl):i("Could not reset password. This may be to prevent too many resets. Try again in a minute.")}catch(g){i(V(g))}},m=d=>{d.preventDefault(),s()},p=()=>{c(""),s()};return e.jsxs(Q,{open:t,onClick:l,style:pa,onClose:m,primaryButtonText:"Generate Link",title:"Reset password",secondaryButtonText:"Cancel",maxWidth:"xs",children:[e.jsxs("form",{onSubmit:l,className:Ao(o.contentSpacingY,o.flexColumn),children:[e.jsx(D,{variant:"subtitle1",children:"Resetting password for user"}),e.jsxs("div",{className:o.flexRow,children:[e.jsx(th,{user:n,variant:"rounded"}),e.jsx(D,{variant:"subtitle1",style:{marginLeft:"1rem"},children:n.username||n.email})]})]}),e.jsx(Q,{open:!!r,onClick:p,primaryButtonText:"Close",title:"Reset password link created",children:e.jsxs(F,{children:[e.jsx(D,{variant:"body1",children:"The user can use this link to reset their password. You should not share this link with anyone but the user in question."}),e.jsx(Yt,{inviteLink:r})]})})]})},nh=h(ze)(({theme:t})=>({width:t.spacing(5),height:t.spacing(5),margin:0})),oh=({showDialog:t,closeDialog:s,user:n,userLoading:o,removeUser:a,userApiErrors:i})=>{const r=Kt(o),{classes:c}=Jt();return e.jsx(Q,{open:t,title:"Really delete user?",onClose:s,onClick:a,primaryButtonText:"Delete user",secondaryButtonText:"Cancel",children:e.jsxs("div",{ref:r,children:[e.jsx(w,{condition:!!i[Ut],show:e.jsx(J,{"data-loading":!0,severity:"error",style:{margin:"1rem 0"},children:i[Ut]})}),e.jsxs("div",{"data-loading":!0,className:c.flexRow,children:[e.jsx(nh,{user:n,variant:"rounded"}),e.jsx(D,{variant:"subtitle1",style:{marginLeft:"1rem"},children:n.username||n.email})]}),e.jsxs(D,{"data-loading":!0,variant:"body1",style:{marginTop:"1rem"},children:["Are you sure you want to delete"," ",n?`${n.name||"user"} (${n.email||n.username})`:"","?",n.scimId?" This user is currently managed by SCIM and may be re-added by your SCIM provider.":""]})]})})},ah=()=>{const{loading:t,makeRequest:s,createRequest:n,errors:o}=xe({propagateErrors:!0});return{downloadCSV:async()=>{const r=n("api/admin/access/overview",{method:"GET",responseType:"blob",headers:{Accept:"text/csv"}},"downloadCSV"),c=await(await s(r.caller,r.id)).blob(),l=window.URL.createObjectURL(c);window.location.assign(l)},errors:o,loading:t}};var Hs={},ih=Gt;Object.defineProperty(Hs,"__esModule",{value:!0});var ma=Hs.default=void 0,rh=ih(Ft()),lh=e,ch=(0,rh.default)((0,lh.jsx)("path",{d:"M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.42 0 2.13.54 2.39 1.4.12.4.45.7.87.7h.3c.66 0 1.13-.65.9-1.27-.42-1.18-1.4-2.16-2.96-2.54V4.5c0-.83-.67-1.5-1.5-1.5S10 3.67 10 4.5v.66c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-1.65 0-2.5-.59-2.83-1.43-.15-.39-.49-.67-.9-.67h-.28c-.67 0-1.14.68-.89 1.3.57 1.39 1.9 2.21 3.4 2.53v.67c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5v-.65c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"}),"AttachMoneyRounded");ma=Hs.default=ch;const dh=h(ma)(({theme:t})=>({color:t.palette.primary.light,fontSize:"1.5rem",backgroundColor:"#F1F0FC",borderRadius:t.shape.borderRadiusLarge})),uh=({value:t})=>e.jsx(oe,{children:e.jsx(w,{condition:t,show:e.jsx(we,{title:"Paid user",arrow:!0,children:e.jsx(dh,{})}),elseShow:"Included"})}),hh=h("div")(({theme:t})=>({display:"flex",justifyContent:"center",alignItems:"center",margin:t.spacing(-1),marginLeft:t.spacing(-.5)})),ph=h(lo)(({theme:t})=>({borderRadius:t.shape.borderRadiusLarge,padding:t.spacing(1,1.5)})),mh=({onEdit:t,onViewAccess:s,onChangePassword:n,onResetPassword:o,onDelete:a,isScimUser:i,userId:r})=>{const[c,l]=u.useState(null),m=!!c,p=j=>{l(j.currentTarget)},d=()=>{l(null)},g=`user-${r}-actions`,x=`${g}-menu`;return e.jsxs(hh,{children:[e.jsx(we,{title:"User actions",arrow:!0,describeChild:!0,children:e.jsx(Oe,{id:g,"aria-controls":m?"actions-menu":void 0,"aria-haspopup":"true","aria-expanded":m?"true":void 0,onClick:p,type:"button",size:"small",children:e.jsx(co,{})})}),e.jsx(ph,{id:x,anchorEl:c,open:m,onClose:d,transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},disableScrollLock:!0,children:e.jsxs(uo,{"aria-labelledby":g,children:[e.jsx(lt,{onClick:t,isScimUser:i,children:"Edit user"}),s&&e.jsx(lt,{onClick:s,children:"Access overview"}),e.jsx(lt,{onClick:()=>{n(),d()},isScimUser:i,children:"Change password"}),e.jsx(lt,{onClick:()=>{o(),d()},isScimUser:i,children:"Reset password"}),e.jsx(lt,{onClick:()=>{a(),d()},children:"Remove user"})]})})]})},lt=({onClick:t,isScimUser:s,children:n})=>e.jsx(we,{title:s?"This user is managed by your SCIM provider and cannot be changed manually":"",arrow:!0,placement:"left",children:e.jsx("div",{children:e.jsx(Ge,{onClick:t,disabled:s,children:e.jsx(Pt,{children:e.jsx(D,{variant:"body2",children:n})})})})}),An=20,xh=()=>{const{users:t}=be(),{isBillingUsers:s,planUsers:n}=qs(t);return!s||(n==null?void 0:n.length)<An?null:e.jsx(J,{severity:"info",sx:{marginBottom:o=>o.spacing(3)},children:e.jsxs("p",{children:[e.jsx("strong",{children:"Heads up!"})," You have reached your maximum number of registered users for you PRO account (up to max ",An," ","users). If you need more users please"," ",e.jsx(Os,{component:ae,to:"https://www.getunleash.io/signup-enterprise",children:"get in touch with us"}),"."]})})},xa=h("div")(({theme:t})=>({marginTop:t.spacing(-2),paddingBottom:t.spacing(2)})),gh=({count:t})=>!t||t<4?null:e.jsx(ko,{icon:e.jsx(e.Fragment,{children:e.jsx(we,{title:`Multiple parallel browser sessions (${t})`,children:e.jsx(Ui,{"aria-label":"Multiple parallel browser sessions",color:"warning"})})})}),jh=h("article")(({theme:t})=>({display:"flex",flexFlow:"row wrap",gap:t.spacing(2),justifyContent:"space-between",alignItems:"center"})),fh=()=>{const{trackEvent:t}=Us(),s=n=>{t("invite",{props:{eventType:n?"link bar action: edit":"link bar action: create"}})};return e.jsx(jh,{children:e.jsx(Oi,{onActionClick:s})})},yh=({licensedUsers:t})=>{const s=bt(),n={datasets:[{label:"Seats used",data:t,borderColor:s.palette.primary.main,backgroundColor:s.palette.primary.main,fill:!1}]};return e.jsx($i,{data:n,overrideOptions:{parsing:{yAxisKey:"count",xAxisKey:"date"},plugins:{legend:{display:!1}},scales:{x:{time:{unit:"month",tooltipFormat:"MMM yyyy",displayFormats:{month:"MMM"}}}}}})},In="api/admin/licensed-users",bh={seatCount:0,licensedUsers:{current:0,history:[]}},ga=()=>{const{data:t,refetch:s,loading:n,error:o}=_i(ne(In),()=>Ni(ne(In),"Seats used"));return{data:t||bh,refetch:s,loading:n,error:o}},Sh=h("section")(({theme:t})=>({minHeight:"100vh",maxWidth:700,width:"95vw",backgroundColor:t.palette.background.default,display:"flex",flexFlow:"column",gap:t.spacing(4),paddingInline:t.spacing(4),paddingBlock:t.spacing(3.75)})),vh=h("div")(({theme:t})=>({display:"flex",flexDirection:"column",gap:t.spacing(9)})),Ch=h("div")(({theme:t})=>({display:"flex",alignItems:"center",gap:t.spacing(1.5)})),wh=h("h3")(({theme:t})=>({fontSize:t.typography.h2.fontSize,margin:0,fontWeight:t.typography.h4.fontWeight})),Pn=h("h4")(({theme:t})=>({margin:0,fontWeight:t.typography.h4.fontWeight,fontSize:t.spacing(1.75)})),Bn=h("div")(({theme:t})=>({display:"flex",flexDirection:"column",gap:t.spacing(2)})),Th=h("div")(({theme:t})=>({display:"flex",justifyContent:"flex-end",marginBlockStart:"auto",gap:t.spacing(4)})),kh=h("div")(({theme:t})=>({display:"flex",gap:t.spacing(2),width:"100%"})),Eh=h("div")(({theme:t})=>({display:"flex",flexDirection:"column",width:"100%",background:t.palette.background.elevation1,padding:t.spacing(3,2,3,2),borderRadius:t.shape.borderRadiusLarge})),Rh=({open:t,close:s})=>{const{data:n}=ga();return e.jsx(Mi,{open:t,onClose:s,label:"Project status",onClick:o=>{o.target instanceof HTMLAnchorElement&&s()},children:e.jsxs(Sh,{children:[e.jsx(Ch,{children:e.jsx(wh,{children:"Seats used"})}),e.jsxs(vh,{children:[e.jsxs(Bn,{children:[e.jsx(Pn,{children:"Last 30 days"}),e.jsxs(kh,{children:[e.jsxs(Eh,{children:[e.jsxs(D,{fontWeight:"bold",children:[n.licensedUsers.current,"/",n.seatCount]}),e.jsx(D,{variant:"body2",children:"Seats used over the last 30 days"})]}),e.jsx(J,{severity:"info",children:"A licensed seat is a unique user that had access to your Unleash instance within the last 30 days, and thereby occupied a seat."})]})]}),e.jsxs(Bn,{children:[e.jsx(Pn,{children:"Last year"}),e.jsx(yh,{licensedUsers:n.licensedUsers.history})]})]}),e.jsx(Th,{children:e.jsx(q,{variant:"outlined",onClick:s,children:"Close"})})]})})},Dh=h("button")(({theme:t})=>({background:"none",border:"none",fontSize:"inherit",textDecoration:"underline",color:t.palette.primary.main,cursor:"pointer",padding:0,textAlign:"left"})),Ah=h("div")(({theme:t})=>({display:"flex",justifyContent:"space-between",gap:t.spacing(2)})),Ih=h("figcaption")(({theme:t})=>({fontSize:t.typography.body2.fontSize,display:"flex",flexFlow:"row wrap",gap:t.spacing(1),justifyContent:"space-between"})),Ph=h("figure")(({theme:t})=>({margin:0,display:"flex",flexFlow:"column",justifyContent:"center"})),Bh=h("span")(({theme:t})=>({fontSize:t.typography.body1.fontSize,fontWeight:"bold"})),Lh=()=>{const[t,s]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(Dh,{onClick:()=>{s(!0)},children:"View graph over time"}),e.jsx(Rh,{open:t,close:()=>s(!1)})]})},Uh=()=>{const{data:t,loading:s}=ga(),n=Kt(s,"[data-loading-licensed-users=true]");return e.jsxs(Ph,{ref:n,children:[e.jsxs(Ah,{children:[e.jsxs(Bh,{"data-loading-licensed-users":!0,children:[t.licensedUsers.current,"/",t.seatCount]}),e.jsx(Ye,{htmlTooltip:!0,tooltip:e.jsx(F,{children:"A licensed seat is a unique user that had access to your instance within the last 30 days, and thereby occupied a seat."})})]}),e.jsxs(Ih,{children:[e.jsx("span",{children:"Seats used over the last 30 days"}),e.jsx(Lh,{})]})]})},Oh=h(F)(({theme:t})=>({display:"flex",flexFlow:"row",gap:t.spacing(2),paddingBottom:t.spacing(3)})),Ln=h(F)(({theme:t})=>({backgroundColor:t.palette.background.paper,padding:t.spacing(2,3,2,2),borderRadius:`${t.shape.borderRadiusLarge}px`,border:"2px solid",borderColor:t.palette.divider,flex:"auto",display:"flex",flexFlow:"column",justifyContent:"center"})),$h=()=>{const{isEnterprise:t,uiConfig:{billing:s}}=H(),n=t()&&s!=="pay-as-you-go";return e.jsxs(Oh,{children:[e.jsx(Ln,{children:e.jsx(fh,{})}),n&&e.jsx(Ln,{children:e.jsx(Uh,{})})]})},_h="/static/upgradeSso-DCY0_83O.png",Nh=h(F)(({theme:t})=>({marginTop:t.spacing(10),width:"100%",backgroundColor:t.palette.background.elevation1,borderRadius:t.shape.borderRadiusMedium,padding:t.spacing(2),display:"flex",justifyContent:"center",position:"relative"})),Mh=h(Os)(({theme:t})=>({textDecoration:"none",fontWeight:t.typography.fontWeightBold})),Fh=h("img")(({theme:t})=>({width:t.spacing(14)})),Gh=h(Oe)(({theme:t})=>({position:"absolute",top:t.spacing(1.25),right:t.spacing(1.5)})),Wh=h(F)(({theme:t})=>({display:"flex",gap:t.spacing(3),marginTop:t.spacing(1),marginBottom:t.spacing(1)})),zh=h(F)(({theme:t})=>({display:"flex",flexDirection:"column",justifyContent:"center",gap:t.spacing(1),maxWidth:t.spacing(60)})),qh=()=>{const[t,s]=Fi("upgrade-sso:v1","open");return t==="closed"?null:e.jsxs(Nh,{children:[e.jsxs(Wh,{children:[e.jsx(Fh,{src:Io(_h),alt:"Single sign-on"}),e.jsxs(zh,{children:[e.jsxs("p",{children:["Streamline access and account management, reduce setup time and enhance security with ",e.jsx("b",{children:"Single Sign-On"})," and"," ",e.jsx("b",{children:"Automatic User Provisioning via SCIM"}),"."]}),e.jsx(Mh,{href:"https://www.getunleash.io/upgrade-unleash?utm_source=oss&utm_medium=feature&utm_content=sso",target:"_blank",children:"View our Enterprise offering"})]})]}),e.jsx(we,{title:"Dismiss",arrow:!0,children:e.jsx(Gh,{"aria-label":"dismiss",onClick:()=>{s("closed")},size:"small",children:e.jsx(Po,{fontSize:"inherit"})})})]})},Hh=()=>{const t=Ce(),{isEnterprise:s,isOss:n}=H(),{users:o,roles:a,refetch:i,loading:r}=be(),{setToastData:c,setToastApiError:l}=K(),{removeUser:m,userLoading:p,userApiErrors:d}=He(),{downloadCSV:g}=ah(),[x,j]=u.useState({open:!1}),[b,y]=u.useState({open:!1}),S=xt("showUserDeviceCount"),k=n()&&o.length>3,{settings:{enabled:E}}=wt(),[A,v]=u.useState(!1),[B,L]=u.useState(!1),[C,W]=u.useState(!1),[P,O]=u.useState(""),[T,R]=u.useState(),{planUsers:I,isBillingUsers:$}=qs(o),[Y,U]=u.useState(""),_=me(Be.breakpoints.down("sm")),M=me(Be.breakpoints.down("md")),he=()=>{v(!1),R(void 0)},ts=z=>()=>{v(!0),R(z)},ss=z=>()=>{j({open:!0,user:z})},Me=z=>()=>{y({open:!0,user:z})},nt=()=>{j({open:!1})},ns=()=>{y({open:!1})},os=async z=>{try{await m(z.id),c({text:`${z.name} has been deleted`,type:"success"}),i(),he()}catch($e){l(V($e))}},as=()=>{L(!1),W(!1),O("")},ot=u.useMemo(()=>[{Header:"Avatar",accessor:"imageUrl",Cell:({row:{original:z}})=>e.jsx(oe,{children:e.jsx(ze,{user:z})}),disableSortBy:!0,maxWidth:80},{id:"name",Header:"Name",accessor:z=>z.name||"",minWidth:180,Cell:({row:{original:z}})=>e.jsx(Se,{value:z.name,subtitle:z.email||z.username}),searchable:!0},...S?[{id:"warning",Header:" ",accessor:z=>z.name||"",maxWidth:40,Cell:({row:{original:z}})=>e.jsx(gh,{count:z.activeSessions}),searchable:!1,disableSortBy:!0}]:[],{id:"role",Header:"Role",accessor:z=>{var $e;return(($e=a.find(Sa=>Sa.id===z.rootRole))==null?void 0:$e.name)||""},Cell:({row:{original:z},value:$e})=>e.jsx($s,{value:$e,role:z.rootRole}),maxWidth:120},{Header:"Created",accessor:"createdAt",Cell:je,width:120,maxWidth:120},{id:"last-login",Header:"Last login",accessor:z=>z.seenAt||"",Cell:({row:{original:z}})=>e.jsx(_e,{value:z.seenAt,emptyText:"Never",title:$e=>`Last login: ${$e}`}),maxWidth:150},{id:"type",Header:"Type",accessor:"paid",maxWidth:100,Cell:({row:{original:z}})=>e.jsx(uh,{value:$&&z.paid}),sortType:"boolean"},{Header:"",id:"Actions",align:"center",Cell:({row:{original:z}})=>e.jsx(mh,{onEdit:()=>{t(`/admin/users/${z.id}/edit`)},onViewAccess:()=>{t(`/admin/users/${z.id}/access`)},onChangePassword:ss(z),onResetPassword:Me(z),onDelete:ts(z),isScimUser:E&&!!z.scimId,userId:z.id}),width:80,disableSortBy:!0},{accessor:"username",Header:"Username",searchable:!0},{accessor:"email",Header:"Email",searchable:!0}],[a,t,$]),is=u.useMemo(()=>({sortBy:[{id:"createdAt",desc:!0}],hiddenColumns:$?["username","email"]:["type","username","email"]}),[$]),{data:Z,getSearchText:pe}=et(ot,Y,$?I:o),{headerGroups:at,rows:rs,prepareRow:ya,setHiddenColumns:ba}=G.useTable({columns:ot,data:Z,initialState:is,sortTypes:fe,autoResetHiddenColumns:!1,autoResetSortBy:!1,disableSortRemove:!0,disableMultiSort:!0,defaultColumn:{Cell:oe}},G.useSortBy,G.useFlexLayout);return St([{condition:!$||M,columns:["type"]},{condition:_,columns:["imageUrl","role"]},{condition:M,columns:["createdAt","last-login","warning"]}],ba,ot),e.jsxs(te,{isLoading:r,header:e.jsx(se,{title:`Users (${rs.length})`,actions:e.jsxs(e.Fragment,{children:[e.jsx(ce,{initialValue:Y,onChange:U}),e.jsx(se.Divider,{}),e.jsx(we,{title:"Exports user access information",arrow:!0,describeChild:!0,children:e.jsx(Oe,{onClick:g,children:e.jsx(xo,{})})}),e.jsx(q,{variant:"contained",color:"primary",onClick:()=>t("/admin/create-user"),children:"Add new user"})]})}),children:[e.jsx(xh,{}),e.jsx(w,{condition:s(),show:e.jsx(xa,{children:e.jsx(ae,{to:"/admin/users/inactive",children:"View inactive users"})})}),e.jsx($h,{}),e.jsx(Ne,{value:pe(Y),children:e.jsx(ye,{rows:rs,headerGroups:at,prepareRow:ya})}),e.jsx(w,{condition:rs.length===0,show:e.jsx(w,{condition:(Y==null?void 0:Y.length)>0,show:e.jsxs(de,{children:["No users found matching “",Y,"”"]}),elseShow:e.jsx(de,{children:e.jsx("span",{"data-loading":!0,children:"No users available. Get started by adding one."})})})}),e.jsx(ha,{open:B,closeConfirm:as,emailSent:C,inviteLink:P}),e.jsx(w,{condition:!!x.user,show:()=>e.jsx(eh,{showDialog:x.open,closeDialog:nt,user:x.user})}),e.jsx(w,{condition:!!b.user,show:()=>e.jsx(sh,{showDialog:b.open,closeDialog:ns,user:b.user})}),e.jsx(w,{condition:!!T,show:e.jsx(oh,{showDialog:A,closeDialog:he,user:T,removeUser:()=>os(T),userLoading:p,userApiErrors:d})}),k?e.jsx(qh,{}):null]})},Vh=()=>{u.useEffect(()=>{ks()},[]);const{uiConfig:t}=H(),{setToastData:s,setToastApiError:n}=K(),o=Vt("id"),{user:a,refetch:i}=Bo(o),{updateUser:r,userLoading:c}=He(),l=Ce(),{name:m,setName:p,email:d,setEmail:g,sendEmail:x,setSendEmail:j,rootRole:b,setRootRole:y,getAddUserPayload:S,validateName:k,errors:E,clearErrors:A}=ua(a==null?void 0:a.name,a==null?void 0:a.email,a==null?void 0:a.rootRole),v=()=>`curl --location --request PUT '${t.unleashUrl}/api/admin/user-admin/${o}' \\
--header 'Authorization: INSERT_API_KEY' \\
--header 'Content-Type: application/json' \\
--data-raw '${JSON.stringify(S(),void 0,2)}'`,B=async C=>{C.preventDefault();const W=S();if(k())try{await r({...W,id:o}),i(),l("/admin/users"),s({text:"User information updated",type:"success"})}catch(O){n(V(O))}},L=()=>{l(Ie)};return e.jsx(ke,{loading:c,title:"Edit user",description:"In order for a user to get access to Unleash, they need to be assigned a root role, such as Viewer, Editor, or Admin.",documentationLink:"https://docs.getunleash.io/reference/rbac#predefined-roles",documentationLinkLabel:"User management documentation",formatApiCode:v,children:e.jsx(da,{errors:E,handleSubmit:B,handleCancel:L,name:m,setName:p,email:d,setEmail:g,sendEmail:x,setSendEmail:j,rootRole:b,setRootRole:y,clearErrors:A,mode:Bs,children:e.jsx(io,{permission:ee})})})},Yh=()=>{const{data:t,error:s,mutate:n}=Ee(ne("api/admin/user-admin/inactive"),Jh);return u.useMemo(()=>({inactiveUsers:(t==null?void 0:t.inactiveUsers)??[],error:s,refetchInactiveUsers:()=>n(),loading:!s&&!t}),[t,s,n])},Jh=t=>fetch(t).then(ue("User")).then(s=>s.json()),Un="delInactiveUsers",Kh=()=>{const{makeRequest:t,createRequest:s,errors:n,loading:o}=xe({propagateErrors:!0});return{deleteInactiveUsers:async i=>{const c=s("api/admin/user-admin/inactive/delete",{method:"POST",body:JSON.stringify({ids:i})});return t(c.caller,c.id)},errors:n,loading:o}},Zh=h(F)(()=>({display:"flex",justifyContent:"center"})),Qh=({onDelete:t})=>e.jsx(Zh,{children:e.jsx(Le,{"data-loading":!0,onClick:t,permission:ee,tooltipProps:{title:"Remove user"},children:e.jsx(Pe,{})})}),Xh=({showDialog:t,closeDialog:s,user:n,userLoading:o,removeUser:a,userApiErrors:i})=>{const r=Kt(o),{classes:c}=Jt();return e.jsx(Q,{open:t,title:"Really delete user?",onClose:s,onClick:a,primaryButtonText:"Delete user",secondaryButtonText:"Cancel",children:e.jsxs("div",{ref:r,children:[e.jsx(w,{condition:!!i[Ut],show:e.jsx(J,{"data-loading":!0,severity:"error",style:{margin:"1rem 0"},children:i[Ut]})}),e.jsx("div",{"data-loading":!0,className:c.flexRow,children:e.jsx(D,{variant:"subtitle1",style:{marginLeft:"1rem"},children:n.username||n.email})}),e.jsxs(D,{"data-loading":!0,variant:"body1",style:{marginTop:"1rem"},children:["Are you sure you want to delete"," ",`${n.name||"user"} (${n.email||n.username})`]})]})})},ep=({showDialog:t,closeDialog:s,inactiveUsersLoading:n,removeInactiveUsers:o,inactiveUserApiErrors:a,inactiveUsers:i})=>{const r=Kt(n);return e.jsx(Q,{open:t,title:"Really delete all inactive users?",onClose:s,onClick:o,primaryButtonText:"Delete all inactive users",secondaryButtonText:"Cancel",children:e.jsxs("div",{ref:r,children:[e.jsx(w,{condition:!!a[Un],show:e.jsx(J,{"data-loading":!0,severity:"error",style:{margin:"1rem 0"},children:a[Un]})}),e.jsx("div",{style:Gi,children:e.jsxs(D,{variant:"subtitle1",children:["You will be deleting"," ",i.length===1?"1 inactive user":`${i.length} inactive users`]})})]})})},tp=()=>{const{removeUser:t,userApiErrors:s}=He(),{deleteInactiveUsers:n,errors:o}=Kh(),{setToastData:a,setToastApiError:i}=K(),{inactiveUsers:r,refetchInactiveUsers:c,loading:l,error:m}=Yh(),{users:p,roles:d,loading:g,refetch:x,error:j}=be(),[b,y]=u.useState(!1),[S,k]=u.useState(),[E,A]=u.useState(!1),v=()=>{y(!1),k(void 0)},B=U=>_=>{_.preventDefault(),y(!0),k(U)},L=U=>{U.preventDefault(),A(!0)},C=()=>{A(!1)},W=async()=>{try{await n(r.map(U=>U.id)),a({text:"Inactive users has been deleted",type:"success"}),A(!1),c()}catch(U){i(V(U))}},P=async U=>{try{await t(U),a({text:"User has been deleted",type:"success"}),c(),v()}catch(_){i(V(_))}},O=u.useMemo(()=>r.map(U=>{const _=p.find(M=>M.id===U.id);return{...U,rootRole:_==null?void 0:_.rootRole}}),[r,p]),T=u.useMemo(()=>[{id:"name",Header:"Name",accessor:U=>U.name||"",minWidth:200,Cell:({row:{original:U}})=>e.jsx(Se,{value:U.name,subtitle:U.email||U.username}),searchable:!0},{id:"role",Header:"Role",accessor:U=>{var _;return((_=d.find(M=>M.id===U.rootRole))==null?void 0:_.name)||""},Cell:({row:{original:U},value:_})=>e.jsx($s,{value:_,role:U.rootRole}),maxWidth:120},{Header:"Created",accessor:"createdAt",Cell:je,width:120,maxWidth:120},{id:"last-login",Header:"Last login",accessor:U=>U.seenAt||"",Cell:({row:{original:U}})=>e.jsx(_e,{value:U.seenAt,emptyText:"Never",title:_=>`Last login: ${_}`}),maxWidth:150},{id:"pat-last-login",Header:"PAT last used",accessor:U=>U.patSeenAt||"",Cell:({row:{original:U}})=>e.jsx(_e,{value:U.patSeenAt,emptyText:"Never",title:_=>`Last used: ${_}`}),maxWidth:150},{id:"Actions",Header:"Actions",align:"center",Cell:({row:{original:U}})=>e.jsx(Qh,{onDelete:B(U)}),width:200,disableSortBy:!0}],[d]),R=u.useMemo(()=>({sortBy:[{id:"createdAt",desc:!0}],hiddenColumns:["username","email"]}),[]),{headerGroups:I,rows:$,prepareRow:Y}=G.useTable({columns:T,data:O,initialState:R,autoResetHiddenColumns:!1,autoResetSortBy:!1,disableSortRemove:!0,disableMultiSort:!0,defaultColumn:{Cell:oe}},G.useSortBy,G.useFlexLayout);return e.jsxs(te,{isLoading:l,header:e.jsx(se,{title:`Inactive users (${$.length})`,actions:e.jsx(e.Fragment,{children:e.jsx(q,{variant:"contained",color:"primary",onClick:L,disabled:r.length===0,children:"Delete all inactive users"})})}),children:[e.jsx(xa,{children:e.jsx(ae,{to:"/admin/users",children:"View all users"})}),e.jsx(ye,{rows:$,headerGroups:I,prepareRow:Y}),e.jsx(w,{condition:$.length===0,show:e.jsx(de,{children:"No inactive users found."})}),e.jsx(w,{condition:!!S,show:e.jsx(Xh,{showDialog:b,closeDialog:v,user:S,userLoading:g,removeUser:()=>P(S.id),userApiErrors:s})}),e.jsx(ep,{showDialog:E,closeDialog:C,inactiveUsersLoading:l,inactiveUserApiErrors:o,inactiveUsers:r,removeInactiveUsers:W})]})},On=({label:t,options:s,value:n,setValue:o,...a})=>e.jsx(Yn,{options:s,value:n,onChange:(i,r)=>o(r),renderInput:i=>e.jsx(X,{...i,label:t,fullWidth:!0}),size:"small",fullWidth:!0,...a}),sp=(t,s,n)=>{const o=`${s?`?project=${s}`:""}${n?`${s?"&":"?"}environment=${n}`:""}`,a=`api/admin/user-admin/${t}/permissions${o}`,{data:i,error:r,mutate:c}=Ee(ne(a),np);return u.useMemo(()=>({overview:i==null?void 0:i.overview,projectRoles:i==null?void 0:i.projectRoles,rootRole:i==null?void 0:i.rootRole,user:i==null?void 0:i.user,loading:!r&&!i,refetch:()=>c(),error:r}),[i,r,c])},np=t=>fetch(t).then(ue("User access matrix")).then(s=>s.json()),$n=h("ul")(({theme:t})=>({listStyle:"none",padding:0,margin:0,fontSize:t.fontSizes.smallBody,"& > li":{display:"flex",justifyContent:"space-between",padding:t.spacing(2),borderBottom:`1px solid ${t.palette.divider}`},"& ul li":{paddingLeft:t.spacing(4)},"& ul:last-of-type > li:last-child":{borderBottom:"none"}})),op=h("div",{shouldForwardProp:t=>t!=="hasPermission"})(({theme:t,hasPermission:s})=>({display:"flex",gap:t.spacing(1),alignItems:"center",width:t.spacing(17.5),color:s?t.palette.text.primary:t.palette.text.secondary,"& > svg":{color:s?t.palette.success.main:t.palette.error.main}})),ap=({categories:t})=>{const{searchQuery:s}=Is();return e.jsx(F,{sx:{maxHeight:500,overflow:"auto"},children:e.jsx($n,{children:t.map(n=>e.jsxs(e.Fragment,{children:[e.jsx("li",{children:e.jsx("strong",{children:n.label})},n.label),e.jsx($n,{children:n.permissions.map(o=>e.jsxs("li",{children:[e.jsx("div",{children:e.jsx(Bt,{search:s,children:o.displayName})}),e.jsx(ip,{hasPermission:o.hasPermission})]},o.name))})]}))})})},ip=({hasPermission:t})=>e.jsx(op,{hasPermission:t,children:t?e.jsxs(e.Fragment,{children:[e.jsx(Rs,{}),"Has permission"]}):e.jsxs(e.Fragment,{children:[e.jsx(Po,{}),"No permission"]})}),rp=h(yo)(({theme:t})=>({border:`1px solid ${t.palette.divider}`,borderRadius:t.shape.borderRadiusLarge,overflow:"hidden",boxShadow:"none",margin:0,"&:before":{display:"none"}})),lp=h(bo)(({theme:t})=>({backgroundColor:t.palette.background.elevation1,"& .MuiAccordionSummary-content":{justifyContent:"space-between",alignItems:"center",minHeight:"30px"}})),cp=h("div")(({theme:t})=>({display:"flex",alignItems:"start",flexDirection:"column",gap:t.spacing(.5)})),dp=h("span")(({theme:t})=>({fontWeight:t.fontWeight.bold})),up=h("span")(({theme:t})=>({color:t.palette.text.secondary,fontSize:t.fontSizes.smallBody,marginRight:t.spacing(1)})),hp=h(vo)(({theme:t})=>({padding:0})),ys=({categories:t,children:s})=>{const n=t.flatMap(({permissions:o})=>o);return e.jsxs(rp,{children:[e.jsxs(lp,{expandIcon:e.jsx(So,{}),children:[e.jsx(cp,{children:e.jsx(dp,{children:s})}),e.jsxs(up,{children:[n.filter(({hasPermission:o})=>o).length,"/",n.length," permissions"]})]}),e.jsx(hp,{children:e.jsx(ap,{categories:t})})]})},pp=h("div")(({theme:t})=>({display:"flex",flex:1,gap:t.spacing(1),maxWidth:800,[t.breakpoints.down("md")]:{flexDirection:"column",maxWidth:"100%"},"& > div":{width:"100%"}})),mp=h("div")(({theme:t})=>({display:"flex",flexDirection:"column",gap:t.spacing(2)})),bs=(t,s)=>{const n=s.toLowerCase(),o=t.permissions.filter(({displayName:a})=>a.toLowerCase().includes(n));if(o.length)return{...t,permissions:o}},xp=()=>{const t=Vt("id"),[s,n]=Wi({project:nn,environment:nn}),{projects:o}=Hn(),{environments:a}=zi(),{user:i,loading:r}=Bo(t),c=me(Be.breakpoints.down("md")),[l,m]=u.useState(""),[p,d]=u.useState(s.project??""),[g,x]=u.useState(s.environment??void 0),{overview:j,rootRole:b,projectRoles:y}=sp(t,p,g);u.useEffect(()=>{n({project:p||void 0,environment:g},"replace")},[p,g]);const S=e.jsxs(pp,{children:[e.jsx(ce,{initialValue:l,onChange:m}),e.jsx(On,{label:"Project",options:o,getOptionLabel:v=>(v==null?void 0:v.name)??"",value:o.find(({id:v})=>v===p),setValue:v=>d((v==null?void 0:v.id)??"")}),e.jsx(On,{label:"Environment",options:a,getOptionLabel:v=>(v==null?void 0:v.name.concat(v.enabled?"":" - deprecated"))??"",value:a.find(({name:v})=>v===g),setValue:v=>x(v==null?void 0:v.name)})]}),k=u.useMemo(()=>{const v=wo((j==null?void 0:j.root)??[]);return l?v.map(B=>bs(B,l)).filter(Boolean):v},[j==null?void 0:j.root,l]),E=u.useMemo(()=>aa((j==null?void 0:j.project)??[]).map(({label:B,permissions:L})=>({label:B,permissions:L.map(([C])=>C)})).map(B=>bs(B,l)).filter(Boolean),[j==null?void 0:j.project,l]),A=u.useMemo(()=>Co((j==null?void 0:j.environment)??[]).map(B=>bs(B,l)).filter(Boolean),[j==null?void 0:j.environment,l]);return e.jsx(te,{isLoading:r,header:e.jsx(se,{title:`Access overview for ${i.name||i.email||i.username}`,actions:e.jsx(w,{condition:!c,show:S}),children:e.jsx(w,{condition:c,show:S})}),children:e.jsx(mp,{children:e.jsxs(Ne,{value:l,children:[e.jsxs(ys,{categories:k,children:["Root permissions for role ",b==null?void 0:b.name]}),e.jsxs(ys,{categories:E,children:["Project permissions",p?` for project ${p}${y!=null&&y.length?` with project role${y.length!==1?"s":""} ${y==null?void 0:y.map(v=>v.name).join(", ")}`:""}`:""]}),g&&e.jsxs(ys,{categories:A,children:["Environment permissions for ",g]})]})})})},gp=()=>{const{isEnterprise:t}=H();return e.jsx("div",{children:e.jsx(ve,{permissions:ee,children:e.jsxs(Qe,{children:[e.jsx(N,{index:!0,element:e.jsx(e.Fragment,{children:e.jsx(Hh,{})})}),e.jsx(N,{path:":id/edit",element:e.jsx(Vh,{})}),e.jsx(N,{path:":id/access",element:e.jsx(xp,{})}),e.jsx(N,{path:"inactive",element:e.jsx(w,{condition:t(),show:e.jsx(tp,{}),elseShow:e.jsx(Ze,{feature:"inactive-users",page:!0})})}),e.jsx(N,{path:"*",element:e.jsx(Lo,{})})]})})})},ct="api/admin/banners",ja=()=>{const{loading:t,makeRequest:s,createRequest:n,errors:o}=xe({propagateErrors:!0}),a=async p=>{const g=n(ct,{method:"POST",body:JSON.stringify(p)},"addBanner");return(await s(g.caller,g.id)).json()},i=async(p,d)=>{const x=n(`${ct}/${p}`,{method:"PUT",body:JSON.stringify(d)},"updateBanner");await s(x.caller,x.id)},r=async p=>{const g=n(`${ct}/${p}/on`,{method:"POST"},"enableBanner");await s(g.caller,g.id)},c=async p=>{const g=n(`${ct}/${p}/off`,{method:"POST"},"disableBanner");await s(g.caller,g.id)};return{addBanner:a,updateBanner:i,removeBanner:async p=>{const g=n(`${ct}/${p}`,{method:"DELETE"},"removeBanner");await s(g.caller,g.id)},toggleBanner:async(p,d)=>{d?await r(p):await c(p)},errors:o,loading:t}},jp=h(F)(()=>({display:"flex",justifyContent:"center"})),fp=({onEdit:t,onDelete:s})=>e.jsxs(jp,{children:[e.jsx(Le,{"data-loading":!0,onClick:t,permission:ee,tooltipProps:{title:"Edit banner"},children:e.jsx(yt,{})}),e.jsx(Le,{"data-loading":!0,onClick:s,permission:ee,tooltipProps:{title:"Remove banner"},children:e.jsx(Pe,{})})]}),yp=({banner:t,open:s,setOpen:n,onConfirm:o})=>e.jsx(Q,{title:"Delete banner?",open:s,primaryButtonText:"Delete banner",secondaryButtonText:"Cancel",onClick:()=>o(t),onClose:()=>{n(!1)},children:e.jsxs("p",{children:["You are about to delete banner: ",e.jsx("strong",{children:t==null?void 0:t.message})]})}),bp=h("div")(({theme:t})=>({display:"flex",flexDirection:"column",gap:t.spacing(4)})),Sp=h("div")(({theme:t})=>({display:"flex",flexDirection:"column",alignItems:"center",padding:t.spacing(1.5),gap:t.spacing(1.5),border:`1px solid ${t.palette.divider}`,borderRadius:t.shape.borderRadiusMedium})),vp=h("p")(({theme:t})=>({fontSize:t.fontSizes.smallBody,color:t.palette.text.secondary})),Cp=h("div")(({theme:t})=>({background:t.palette.background.elevation1,padding:t.spacing(2,3),borderRadius:t.shape.borderRadiusLarge})),Ss=h("div")(({theme:t})=>({display:"flex",flexDirection:"column",gap:t.spacing(1.5)})),vs=h("p")(({theme:t})=>({fontWeight:t.fontWeight.bold})),Re=h("div")(({theme:t})=>({display:"flex",flexDirection:"column",gap:t.spacing(1)})),De=h("p")(({theme:t})=>({display:"flex",color:t.palette.text.primary})),Ve=h(qe)({width:"100%"}),Cs=h("div")(({theme:t})=>({display:"flex",flexDirection:"column",padding:t.spacing(.5),gap:t.spacing(.5)})),ws=h(Do)(({theme:t})=>({width:"100%",maxWidth:t.spacing(50)})),wp=h(q)(({theme:t})=>({marginRight:"auto"})),Tp=[{key:"info",label:"Information"},{key:"warning",label:"Warning"},{key:"error",label:"Error"},{key:"success",label:"Success"}],_n=t=>t===""?"Default":t==="none"?"None":"Custom",Nn=t=>t===""?"None":t==="dialog"?"Dialog":"Link",kp=({enabled:t,message:s,variant:n,sticky:o,icon:a,link:i,linkText:r,dialogTitle:c,dialog:l,setEnabled:m,setMessage:p,setVariant:d,setSticky:g,setIcon:x,setLink:j,setLinkText:b,setDialogTitle:y,setDialog:S})=>{const[k,E]=u.useState(!1),[A,v]=u.useState(()=>_n(a)),[B,L]=u.useState(()=>Nn(i));return u.useEffect(()=>{v(_n(a)),L(Nn(i))},[a,i]),e.jsxs(bp,{children:[e.jsxs(Sp,{children:[e.jsx(vp,{children:"Banner preview:"}),e.jsx(Uo,{banner:{message:s||"*No message set. Please enter a message below.*",variant:n,sticky:!1,icon:a,link:i,linkText:r,dialogTitle:c,dialog:l},inline:!0})]}),e.jsx(Cp,{children:e.jsx(qi,{checked:t,setChecked:m,children:"Banner status"})}),e.jsxs(Ss,{children:[e.jsx(vs,{children:"Configuration"}),e.jsxs(Re,{children:[e.jsx(De,{children:"What type of banner is it?"}),e.jsx(ws,{size:"small",value:n,onChange:C=>d(C),options:Tp})]}),e.jsxs(Re,{children:[e.jsx(De,{children:"What icon should be displayed on the banner?"}),e.jsx(ws,{size:"small",value:A,onChange:C=>{v(C),x(C==="None"?"none":"")},options:["Default","Custom","None"].map(C=>({key:C,label:C}))})]}),e.jsx(w,{condition:A==="Custom",show:e.jsxs(Re,{children:[e.jsxs(De,{children:["Which custom icon?",e.jsx(Ye,{htmlTooltip:!0,tooltip:e.jsxs(Cs,{children:[e.jsxs("p",{children:["Choose an icon from"," ",e.jsx("a",{href:"https://fonts.google.com/icons",target:"_blank",rel:"noreferrer",children:"Material Symbols"}),"."]}),e.jsx("p",{children:'For example, if you want to display the "Rocket Launch" icon, you can enter "rocket_launch" in the field below.'})]})})]}),e.jsx(Ve,{label:"Banner icon",value:a,onChange:C=>x(C.target.value),autoComplete:"off"})]})}),e.jsxs(Re,{children:[e.jsxs(De,{children:["What is your banner message?",e.jsx(Ye,{htmlTooltip:!0,tooltip:e.jsx(Cs,{children:e.jsxs("p",{children:[e.jsx("a",{href:"https://www.markdownguide.org/basic-syntax/",target:"_blank",rel:"noreferrer",children:"Markdown"})," ","is supported."]})})})]}),e.jsx(Ve,{autoFocus:!0,label:"Banner message",multiline:!0,minRows:2,maxRows:6,value:s,onChange:C=>p(C.target.value),autoComplete:"off",required:!0})]})]}),e.jsxs(Ss,{children:[e.jsx(vs,{children:"Banner action"}),e.jsxs(Re,{children:[e.jsx(De,{children:"What action should be available in the banner?"}),e.jsx(ws,{size:"small",value:B,onChange:C=>{L(C),j(C==="Dialog"?"dialog":""),b(""),y(""),S("")},options:["None","Link","Dialog"].map(C=>({key:C,label:C}))})]}),e.jsx(w,{condition:B==="Link",show:e.jsxs(Re,{children:[e.jsx(De,{children:"What URL should be opened?"}),e.jsx(Ve,{label:"URL",value:i,onChange:C=>j(C.target.value),onBlur:()=>{r||b(i)},autoComplete:"off"})]})}),e.jsx(w,{condition:B!=="None",show:e.jsxs(Re,{children:[e.jsx(De,{children:"What is the action text?"}),e.jsx(Ve,{label:"Action text",value:r,onChange:C=>b(C.target.value),autoComplete:"off"})]})}),e.jsx(w,{condition:B==="Dialog",show:e.jsxs(e.Fragment,{children:[e.jsxs(Re,{children:[e.jsx(De,{children:"What is the dialog title?"}),e.jsx(Ve,{label:"Dialog title",value:c,onChange:C=>y(C.target.value),autoComplete:"off"})]}),e.jsxs(Re,{children:[e.jsxs(De,{children:["What is the dialog content?",e.jsx(Ye,{htmlTooltip:!0,tooltip:e.jsx(Cs,{children:e.jsxs("p",{children:[e.jsx("a",{href:"https://www.markdownguide.org/basic-syntax/",target:"_blank",rel:"noreferrer",children:"Markdown"})," ","is supported."]})})})]}),e.jsx(Ve,{label:"Dialog content",multiline:!0,minRows:4,value:l,onChange:C=>S(C.target.value),autoComplete:"off"})]}),e.jsx(wp,{variant:"outlined",color:"primary",startIcon:e.jsx(Hi,{}),onClick:()=>E(!0),children:"Preview dialog"}),e.jsx(Vi,{open:k,setOpen:E,title:c||r,children:l})]})})]}),e.jsxs(Ss,{children:[e.jsx(vs,{children:"Sticky banner"}),e.jsx(re,{control:e.jsx(zt,{checked:o,onChange:C=>g(C.target.checked)}),label:"Make the banner sticky on the screen when scrolling"})]})]})},Ep=h("form")(()=>({display:"flex",flexDirection:"column",height:"100%"})),Rp=h("div")(({theme:t})=>({marginTop:"auto",display:"flex",justifyContent:"flex-end",paddingTop:t.spacing(4)})),Dp=h(q)(({theme:t})=>({marginLeft:t.spacing(3)})),Ap=({banner:t,open:s,setOpen:n})=>{const{refetch:o}=Oo(),{addBanner:a,updateBanner:i,loading:r}=ja(),{setToastData:c,setToastApiError:l}=K(),{uiConfig:m}=H(),[p,d]=u.useState(!0),[g,x]=u.useState(""),[j,b]=u.useState("info"),[y,S]=u.useState(!1),[k,E]=u.useState(""),[A,v]=u.useState(""),[B,L]=u.useState(""),[C,W]=u.useState(""),[P,O]=u.useState("");u.useEffect(()=>{d((t==null?void 0:t.enabled)??!0),x((t==null?void 0:t.message)||""),b((t==null?void 0:t.variant)||"info"),S((t==null?void 0:t.sticky)||!1),E((t==null?void 0:t.icon)||""),v((t==null?void 0:t.link)||""),L((t==null?void 0:t.linkText)||""),W((t==null?void 0:t.dialogTitle)||""),O(typeof(t==null?void 0:t.dialog)=="string"?t==null?void 0:t.dialog:"")},[s,t]);const T=t!==void 0,R=T?"Edit banner":"New banner",I=g.length,$={enabled:p,variant:j,icon:k,message:g,link:A,linkText:B,dialogTitle:C,dialog:P,sticky:y},Y=()=>`curl --location --request ${T?"PUT":"POST"} '${m.unleashUrl}/api/admin/banners${T?`/${t.id}`:""}' \\
    --header 'Authorization: INSERT_API_KEY' \\
    --header 'Content-Type: application/json' \\
    --data-raw '${JSON.stringify($,void 0,2)}'`,U=async _=>{if(_.preventDefault(),!!I)try{T?await i(t.id,$):await a($),c({text:`Banner ${T?"updated":"added"} successfully`,type:"success"}),o(),n(!1)}catch(M){l(V(M))}};return e.jsx(qt,{open:s,onClose:()=>{n(!1)},label:R,children:e.jsx(ke,{loading:r,modal:!0,title:R,description:"Banners allow you to display messages to other users inside your Unleash instance.",documentationLink:"https://docs.getunleash.io/reference/banners",documentationLinkLabel:"Banners documentation",formatApiCode:Y,children:e.jsxs(Ep,{onSubmit:U,children:[e.jsx(kp,{enabled:p,message:g,variant:j,sticky:y,icon:k,link:A,linkText:B,dialogTitle:C,dialog:P,setEnabled:d,setMessage:x,setVariant:b,setSticky:S,setIcon:E,setLink:v,setLinkText:L,setDialogTitle:W,setDialog:O}),e.jsxs(Rp,{children:[e.jsxs(q,{type:"submit",variant:"contained",color:"primary",disabled:!I,children:[T?"Save":"Add"," banner"]}),e.jsx(Dp,{onClick:()=>{n(!1)},children:"Cancel"})]})]})})})},Ip=()=>{const{setToastData:t,setToastApiError:s}=K(),{banners:n,refetch:o,loading:a}=Oo(),{toggleBanner:i,removeBanner:r}=ja(),[c,l]=u.useState(""),[m,p]=u.useState(!1),[d,g]=u.useState(!1),[x,j]=u.useState(),b=async(P,O)=>{try{await i(P.id,O),t({text:`"${P.message}" has been ${O?"enabled":"disabled"}`,type:"success"}),o()}catch(T){s(V(T))}},y=async P=>{try{await r(P.id),t({text:`"${P.message}" has been deleted`,type:"success"}),o(),g(!1)}catch(O){s(V(O))}},S=me(Be.breakpoints.down("md")),k=u.useMemo(()=>[{Header:"Banner",accessor:"message",Cell:({row:{original:P}})=>e.jsx(Uo,{banner:{...P,sticky:!1},inline:!0,maxHeight:42}),disableSortBy:!0,minWidth:200,searchable:!0},{Header:"Created",accessor:"createdAt",Cell:je,width:120,maxWidth:120},{Header:"Enabled",accessor:"enabled",Cell:({row:{original:P}})=>e.jsx(Yi,{checked:P.enabled,setChecked:O=>b(P,O)}),sortType:"boolean",width:90,maxWidth:90},{Header:"Actions",id:"Actions",align:"center",Cell:({row:{original:P}})=>e.jsx(fp,{onEdit:()=>{j(P),p(!0)},onDelete:()=>{j(P),g(!0)}}),width:100,disableSortBy:!0}],[]),[E]=u.useState({sortBy:[{id:"createdAt",desc:!0}]}),{data:A,getSearchText:v}=et(k,c,n),{headerGroups:B,rows:L,prepareRow:C,setHiddenColumns:W}=G.useTable({columns:k,data:A,initialState:E,sortTypes:fe,autoResetHiddenColumns:!1,autoResetSortBy:!1,disableSortRemove:!0,disableMultiSort:!0,defaultColumn:{Cell:oe}},G.useSortBy,G.useFlexLayout);return St([{condition:S,columns:["createdAt"]}],W,k),e.jsxs(te,{isLoading:a,header:e.jsx(se,{title:`Banners (${L.length})`,actions:e.jsxs(e.Fragment,{children:[e.jsx(w,{condition:!S,show:e.jsxs(e.Fragment,{children:[e.jsx(ce,{initialValue:c,onChange:l}),e.jsx(se.Divider,{})]})}),e.jsx(q,{variant:"contained",color:"primary",onClick:()=>{j(void 0),p(!0)},children:"New banner"})]}),children:e.jsx(w,{condition:S,show:e.jsx(ce,{initialValue:c,onChange:l})})}),children:[e.jsx(Ne,{value:v(c),children:e.jsx(ye,{rows:L,headerGroups:B,prepareRow:C})}),e.jsx(w,{condition:L.length===0,show:e.jsx(w,{condition:(c==null?void 0:c.length)>0,show:e.jsxs(de,{children:["No banners found matching “",c,"”"]}),elseShow:e.jsx(de,{children:"No banners available. Get started by adding one."})})}),e.jsx(Ap,{banner:x,open:m,setOpen:p}),e.jsx(yp,{banner:x,open:d,setOpen:g,onConfirm:y})]})},Pp=()=>{const{isEnterprise:t}=H();return t()?e.jsx("div",{children:e.jsx(ve,{permissions:[ee,Ji],children:e.jsx(Ip,{})})}):e.jsx(Ze,{feature:"banners",page:!0})},Bp=async(t,s)=>{if(t){if(s){const n=await s.json();throw t({message:n.message}),new Error(n.message)}throw new Error("Did not receive a response from the server.")}},Lp=()=>{const{makeRequest:t,createRequest:s,errors:n,loading:o}=xe({propagateErrors:!0,handleBadRequest:Bp});return{updateLicenseKey:async i=>{const c=s("api/admin/license",{method:"POST",body:JSON.stringify({token:i})});await t(c.caller,c.id)},errors:n,loading:o}},Up=h(F)(({theme:t})=>({display:"grid",gap:t.spacing(4)})),dt=h("div")(()=>({display:"table-row"})),ut=h("p")(({theme:t})=>({display:"table-cell",fontWeight:t.fontWeight.bold,paddingTop:t.spacing(2)})),ht=h("p")(({theme:t})=>({display:"table-cell",paddingTop:t.spacing(2),paddingLeft:t.spacing(4)})),Op=()=>{const{setToastData:t,setToastApiError:s}=K(),{license:n,error:o,refetchLicense:a}=Ki(),{reCheckLicense:i}=Zi(),{loading:r}=H(),{locationSettings:c}=so(),[l,m]=u.useState(""),{updateLicenseKey:p}=Lp(),d=x=>{m(x.target.value.trim())};if(r||!n)return null;const g=async x=>{x.preventDefault();try{await p(l),t({text:"License key updated",type:"success"}),a(),i()}catch(j){s(V(j))}};return e.jsx(te,{header:e.jsx(se,{title:"Unleash Enterprise License"}),children:e.jsxs(Up,{children:[e.jsx(w,{condition:!!n.token,show:e.jsxs("div",{children:[e.jsxs(dt,{children:[e.jsx(ut,{children:"Customer"}),e.jsx(ht,{children:n.customer})]}),e.jsxs(dt,{children:[e.jsx(ut,{children:"Instance Name"}),e.jsx(ht,{children:n.instanceName})]}),e.jsxs(dt,{children:[e.jsx(ut,{children:"Plan"}),e.jsx(ht,{children:n.plan})]}),e.jsxs(dt,{children:[e.jsx(ut,{children:"Seats"}),e.jsx(ht,{children:n.seats})]}),e.jsxs(dt,{children:[e.jsx(ut,{children:"Expire at"}),e.jsx(ht,{children:ao(n.expireAt,c.locale)})]})]}),elseShow:e.jsx("p",{children:"You do not have a registered Unleash Enterprise License."})}),e.jsxs("form",{onSubmit:g,children:[e.jsx(X,{onChange:d,label:"New license key",name:"licenseKey",value:l,style:{width:"100%"},variant:"outlined",size:"small",multiline:!0,rows:6,required:!0}),e.jsx(f,{container:!0,spacing:3,marginTop:2,children:e.jsxs(f,{item:!0,md:5,children:[e.jsx(q,{variant:"contained",color:"primary",type:"submit",disabled:r,children:"Update license key"})," ",e.jsx("p",{children:e.jsx("small",{style:{color:"red"},children:o==null?void 0:o.message})})]})})]})]})})};var Vs={},$p=Gt;Object.defineProperty(Vs,"__esModule",{value:!0});var fa=Vs.default=void 0,_p=$p(Ft()),Np=e,Mp=(0,_p.default)((0,Np.jsx)("path",{d:"M6 6v2h8.59L5 17.59 6.41 19 16 9.41V18h2V6z"}),"ArrowOutward");fa=Vs.default=Mp;const Fp="/static/easyToDeploy-rluTX8sF.png",Tt=1505,Gp=h(f)(({theme:t})=>({display:"flex",flexDirection:"column",gap:t.spacing(2)})),Wp=h(Ls)(({theme:t})=>({height:t.spacing(44),padding:t.spacing(3),borderRadius:`${t.shape.borderRadiusLarge}px`,boxShadow:"none",color:"white",backgroundColor:t.palette.web.main,overflow:"hidden",[t.breakpoints.down(Tt)]:{height:t.spacing(24)},[t.breakpoints.down(800)]:{height:t.spacing(30)}})),zp=h(Ls)(({theme:t})=>({minHeight:t.spacing(44),padding:t.spacing(3),borderRadius:`${t.shape.borderRadiusLarge}px`,boxShadow:"none",[t.breakpoints.up("md")]:{flexDirection:"row",flexWrap:"nowrap"}})),qp=h(D)(({theme:t})=>({width:"100%",fontSize:t.fontSizes.largeHeader,fontWeight:"bold",marginBottom:t.spacing(1)})),Hp=h("div")(({theme:t})=>({marginBottom:t.spacing(6),[t.breakpoints.down(Tt)]:{marginBottom:t.spacing(2)}})),Mn=h(D)(({theme:t})=>({fontSize:t.fontSizes.bodySize,marginTop:t.spacing(2),marginBottom:t.spacing(2),flexDirection:"row",display:"flex",gap:t.spacing(1),justifyContent:"space-between",[t.breakpoints.down(Tt)]:{maxWidth:t.spacing(65)},[t.breakpoints.down(800)]:{flexDirection:"column",justifyContent:"start"}})),Fn=h("div")(({theme:t})=>({fontSize:t.fontSizes.bodySize,fontWeight:"bold"})),Gn=h("div")(({theme:t})=>({color:"white"})),Vp=h(D)(({theme:t})=>({fontSize:t.fontSizes.mainHeader,marginTop:t.spacing(2),marginBottom:t.spacing(4)})),Yp=h(f)(({theme:t})=>({display:"flex",flexDirection:"row",gap:t.spacing(2),justifyContent:"space-between",marginBottom:t.spacing(7)})),Rt=h(f)(({theme:t})=>({width:t.spacing(16),aspectRatio:"1 / 1",padding:t.spacing(2),alignItems:"center",borderRadius:"50%",backgroundColor:t.mode==="light"?"#F1F0FC":"#302E42"})),Dt=h(F)(({theme:t})=>({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"})),At=h(D)(({theme:t})=>({color:t.palette.primary.main,fontSize:t.fontSizes.largeHeader,fontWeight:"bold",marginTop:t.spacing(1)})),It=h(D)(({theme:t})=>({color:t.palette.text.primary,fontSize:t.fontSizes.bodySize})),Jp=h("div")(({theme:t})=>({display:"flex",justifyContent:"flex-start",marginTop:t.spacing(3)})),Kp=h("div")(({theme:t})=>({display:"flex",justifyContent:"flex-end",marginTop:t.spacing(-6),marginRight:t.spacing(-10),[t.breakpoints.down(Tt)]:{marginTop:t.spacing(-22),marginRight:t.spacing(-12)}})),Zp=h("img")(({theme:t})=>({width:t.spacing(33),transform:"rotate(180deg)",clipPath:"polygon(21% 28%, 100% 28%, 21% 94%)"})),Qp=({plan:t,instanceId:s,version:n})=>e.jsxs(Wp,{children:[e.jsxs(Hp,{children:[e.jsx("div",{children:"Current plan"}),e.jsx(qp,{variant:"h3",children:t})]}),e.jsxs(Mn,{children:[e.jsx(Fn,{children:"Instance id"}),e.jsx(Gn,{children:s})]}),e.jsxs(Mn,{children:[e.jsx(Fn,{children:"Unleash version"}),e.jsx(Gn,{children:n})]}),e.jsx(Kp,{children:e.jsx(Zp,{src:Io(Fp)})})]}),Xp=({users:t,featureToggles:s,projects:n,environments:o})=>{const a=Ce();return e.jsxs(zp,{children:[e.jsx(Vp,{children:"Instance statistics"}),e.jsxs(Yp,{container:!0,children:[e.jsx(Rt,{item:!0,children:e.jsxs(Dt,{children:[e.jsx(At,{children:t}),e.jsx(It,{children:"Users"})]})}),e.jsx(Rt,{item:!0,children:e.jsxs(Dt,{children:[e.jsx(At,{children:s}),e.jsx(It,{children:"Feature flags"})]})}),e.jsx(Rt,{item:!0,children:e.jsxs(Dt,{children:[e.jsx(At,{children:n}),e.jsx(It,{children:"Projects"})]})}),e.jsx(Rt,{item:!0,children:e.jsxs(Dt,{children:[e.jsx(At,{children:o}),e.jsx(It,{children:"Environments"})]})})]}),e.jsx(Jp,{children:e.jsx(q,{rel:"noreferrer",endIcon:e.jsx(fa,{}),onClick:()=>{a("/admin/instance")},children:"View all instance statistics"})})]})},em=()=>{var m,p,d,g,x,j;const t=ea(),s=bt(),n=me(s.breakpoints.down(Tt)),o=n?12:7,a=n?12:5,{isOss:i,isPro:r,isEnterprise:c}=H(),l=i()?"Open source":r()?"Pro":c()?"Enterprise":"Unknown";return e.jsx(Gp,{children:t&&!t.loading&&e.jsxs(f,{container:!0,spacing:3,children:[e.jsx(f,{item:!0,md:a,sm:12,xs:12,children:e.jsx(Qp,{plan:l,instanceId:((m=t.stats)==null?void 0:m.instanceId)??"unknown",version:((p=t.stats)==null?void 0:p.versionEnterprise)??"unknown"})}),e.jsx(f,{item:!0,md:o,sm:12,xs:12,children:e.jsx(Xp,{environments:((d=t.stats)==null?void 0:d.environments)??0,featureToggles:((g=t.stats)==null?void 0:g.featureToggles)??0,projects:((x=t.stats)==null?void 0:x.projects)??0,users:((j=t.stats)==null?void 0:j.users)??0})})]})})},tm=()=>e.jsx(e.Fragment,{children:e.jsxs(Qe,{children:[e.jsx(N,{index:!0,element:e.jsx(em,{})}),e.jsx(N,{path:"users/*",element:e.jsx(gp,{})}),e.jsx(N,{path:"api",element:e.jsx(hr,{})}),e.jsx(N,{path:"api/create-token",element:e.jsx(gr,{})}),e.jsx(N,{path:"service-accounts",element:e.jsx(_u,{})}),e.jsx(N,{path:"create-user",element:e.jsx(Ku,{})}),e.jsx(N,{path:"invite-link",element:e.jsx(Qu,{})}),e.jsx(N,{path:"groups/*",element:e.jsx(_c,{})}),e.jsx(N,{path:"roles/*",element:e.jsx(gu,{})}),e.jsx(N,{path:"instance",element:e.jsx(Fc,{})}),e.jsx(N,{path:"network/*",element:e.jsx(kd,{})}),e.jsx(N,{path:"maintenance",element:e.jsx(md,{})}),e.jsx(N,{path:"banners",element:e.jsx(Pp,{})}),e.jsx(N,{path:"license",element:e.jsx(Op,{})}),e.jsx(N,{path:"cors",element:e.jsx($l,{})}),e.jsx(N,{path:"auth/*",element:e.jsx(Nr,{})}),e.jsx(N,{path:"admin-invoices",element:e.jsx(Il,{})}),e.jsx(N,{path:"billing",element:e.jsx(El,{})}),e.jsx(N,{path:"instance-privacy",element:e.jsx(od,{})}),e.jsx(N,{path:"*",element:e.jsx(Lo,{})})]})}),dm=Object.freeze(Object.defineProperty({__proto__:null,default:tm},Symbol.toStringTag,{value:"Module"}));export{Fs as B,dm as L,Zr as T,No as a,Kr as b,am as c,rm as d,tl as e,im as f,Fo as g,cm as h,lm as p,ol as u};
